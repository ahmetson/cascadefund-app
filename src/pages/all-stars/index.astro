---
import GalaxyLayout from "@/layouts/GalaxyLayout.astro";
import { MenuName } from "@/components/navbar/WorkNavbar.astro";

import UniverseHero from "@/components/all-stars/UniverseHero";
import AllStarsContestPanel from "@/components/all-stars/AllStarsContestPanel";
import AllStarsLeaderboardPanels from "@/components/all-stars/AllStarsLeaderboardPanels";
import UniverseResearchPanel from "@/components/all-stars/UniverseResearchPanel";
import GalaxyAutoZoom from "@/components/all-stars/GalaxyAutoZoom";
import BackButton from "@/components/custom-ui/BackButton";
import DemoCtaPanel from "@/components/project/DemoCtaPanel";
import { mockContestData } from "@/types/mock-data";
import { getAllGalaxies, getGalaxyById } from "@/server-side/galaxy";

// Start timing frontmatter execution
const frontmatterStartTime = performance.now();
console.log("[all-stars] Frontmatter execution started");

// Read galaxy query parameter
const galaxyId = Astro.url.searchParams.get("galaxy");
const queryParamTime = performance.now();
console.log(
  `[all-stars] Query param read: ${(queryParamTime - frontmatterStartTime).toFixed(2)}ms`,
);

// Get selected galaxy if galaxyId is provided
let selectedGalaxy = null;
if (galaxyId) {
  const getGalaxyStartTime = performance.now();
  selectedGalaxy = await getGalaxyById(galaxyId);
  const getGalaxyTime = performance.now();
  console.log(
    `[all-stars] getGalaxyById(${galaxyId}): ${(getGalaxyTime - getGalaxyStartTime).toFixed(2)}ms`,
  );
} else {
  console.log("[all-stars] No galaxyId provided, skipping getGalaxyById");
}

// Get all galaxies from database (only those in space: x > 0 and y > 0)
const getAllGalaxiesStartTime = performance.now();
const allGalaxiesData = await getAllGalaxies(true);
const getAllGalaxiesTime = performance.now();
console.log(
  `[all-stars] getAllGalaxies(true): ${(getAllGalaxiesTime - getAllGalaxiesStartTime).toFixed(2)}ms (found ${allGalaxiesData.length} galaxies)`,
);

// Get current user's starsunshines (for demo, using 0 to show locked state)
const currentStarsunshines = 0;

// Prepare all galaxies for display in the virtual screen
const mapStartTime = performance.now();
const allGalaxies = allGalaxiesData.map((galaxy, index) => ({
  x: galaxy.x,
  y: galaxy.y,
  projectName: galaxy.name,
  projectId: galaxy._id?.toString() || "",
  galaxyData: galaxy,
  tags: galaxy.tags,
  leaderboardPosition: index + 1,
}));
const mapTime = performance.now();
console.log(
  `[all-stars] Mapping galaxies: ${(mapTime - mapStartTime).toFixed(2)}ms`,
);

// Total frontmatter execution time
const frontmatterEndTime = performance.now();
const totalFrontmatterTime = frontmatterEndTime - frontmatterStartTime;
console.log(
  `[all-stars] Total frontmatter execution time: ${totalFrontmatterTime.toFixed(2)}ms`,
);
---

<GalaxyLayout
  active={MenuName.ProjectList}
  hideLinks={Object.keys(MenuName)}
  projectName="Ara Universe"
  projectX={0}
  projectY={0}
  projectGalaxies={allGalaxies}
  isStatic={true}
>
  <BackButton slot="left" client:load />

  <UniverseHero slot="center" client:only="react" />

  <UniverseResearchPanel
    slot="footer"
    client:only="react"
    starsunshines={currentStarsunshines}
  />

  <GalaxyAutoZoom
    client:only="react"
    galaxyX={selectedGalaxy?.x || 0}
    galaxyY={selectedGalaxy?.y || 0}
  />
</GalaxyLayout>

<style is:global>
  /* Hide scrollbars but allow scrolling */
  html,
  body {
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
  }

  html::-webkit-scrollbar,
  body::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
  }

  /* Hide scrollbars on all elements */
  * {
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
  }

  *::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
  }
</style>
