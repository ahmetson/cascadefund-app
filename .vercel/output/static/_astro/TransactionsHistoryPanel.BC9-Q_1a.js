import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as d}from"./index.DxhH1ShK.js";import{P as v}from"./PageLikePanel.C32EveG_.js";import{B as u}from"./Button.BGGO0Gl0.js";import{g as o}from"./index.B-oIZhPt.js";import{C as p}from"./Tooltip.Cp89g2lg.js";import{L as B}from"./List.CgTKD_hI.js";import{M as y}from"./MenuAvatar.DNnCbCL7.js";import{B as M}from"./Badge.CwoN8wRJ.js";import{N as l}from"./NumberFlow-client-48rw3j0J.DO-Ted3l.js";import{P as w,a as S,b as T,c as F,d as D,e as H,f as P}from"./PopoverDescription.BzDXuJpa.js";import{T as R}from"./timeago-react.CCkgRyVe.js";import{C as b}from"./Link.DQs8_5h1.js";import _ from"./BackButton.BJvyKTtM.js";import{a as z}from"./virtual.VUcB3V37.js";import{g as E}from"./user.BVCe9jQZ.js";import{g as N}from"./utils.BnlJtBIq.js";import{P as W}from"./PopoverTitle.BejME8Dy.js";import"./Panel.n1yQPIfZ.js";import"./eventTypes.CfSurkCl.js";import"./ripple.CLh-JuST.js";import"./slot.DPiB-jfz.js";import"./index.CqUFkXl9.js";import"./proxy.D4YeN7SK.js";import"./accordion.CeZr6L_N.js";import"./accordion.Drwdne5y.js";import"./use-controlled-state.FkpCVSoL.js";import"./index.VlIKThXs.js";import"./index.DpebaNh_.js";import"./index.CG_O7YBG.js";import"./createLucideIcon.C1tpinp8.js";import"./PanelAction.BT-fj3Wj.js";import"./ElectricBorder.DAWLx7iV.js";import"./browse-tracker.1pHqLWse.js";import"./client.B9YBqyHK.js";const J=({defaultShowCascaded:i=!1,showCascaded:t,onToggle:a})=>e.jsx("div",{className:"mb-4",children:e.jsx(u,{variant:"secondary",size:"sm",onClick:()=>a(!t),className:"w-full sm:w-auto",children:t?"show user donations":"show cascading donations"})}),O=({nickname:i,icon:t,isMaintainer:a,amount:m,sunshines:r,stars:n,receivers:c})=>e.jsx("div",{children:e.jsxs("div",{className:"flex items-center justify-between gap-2 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(y,{src:t,nickname:i,sunshines:r,stars:n,isMaintainer:a,className:"flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(M,{variant:a?"blue":"gray",static:!0,children:a?"Maintainer":"Donator"}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600 dark:text-gray-400",children:[o({iconType:"star",className:"w-3 h-3"}),e.jsx(l,{value:n,locales:"en-US",format:{style:"decimal",maximumFractionDigits:2}})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(l,{value:m,locales:"en-US",format:{style:"currency",currency:"USD",maximumFractionDigits:2},className:"text-sm font-medium text-gray-800 dark:text-gray-400"}),c&&c.length>0&&e.jsx(I,{receivers:c})]})]})}),I=({receivers:i=[]})=>e.jsxs(w,{children:[e.jsx(S,{className:"hyperlink flex items-center justify-center shadow-none",children:e.jsx(p,{content:e.jsx("div",{className:"text-sm",children:"View receivers"}),children:e.jsxs(u,{variant:"secondary",size:"sm",className:"flex items-center gap-1 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600",children:[o({iconType:"arrow-to-br-corner",className:"w-4 h-4"}),o({iconType:"multiple-users",className:"w-4 h-4"})]})})}),e.jsx(T,{children:e.jsx(F,{sideOffset:8,side:"bottom",className:"z-999!",children:e.jsxs(D,{className:"w-80 origin-[var(--transform-origin)] rounded-xs bg-[canvas] px-6 py-4 text-gray-900 shadow-sm shadow-gray-900 dark:text-slate-300 dark:shadow-slate-300 transition-[transform,scale,opacity] data-[ending-style]:scale-90 data-[ending-style]:opacity-0 data-[starting-style]:scale-90 data-[starting-style]:opacity-0",children:[e.jsx(H,{className:"data-[side=bottom]:top-[-8px] data-[side=left]:right-[-13px] data-[side=left]:rotate-90 data-[side=right]:left-[-13px] data-[side=right]:-rotate-90 data-[side=top]:bottom-[-8px] data-[side=top]:rotate-180"}),e.jsx(P,{className:"text-gray-600 dark:text-slate-400 text-sm mb-3",children:"Donation Receivers"}),e.jsx(B,{contentHeight:"h-64",children:i.length>0?i.map((t,a)=>e.jsx(O,{...t},a)):e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:"No receivers"})})]})})})]}),k=[[{nickname:"Emma Davis",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:450,sunshines:450,stars:1.25,receivers:[{nickname:"John Smith",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!0,amount:200,sunshines:200,stars:.56,receivers:[{nickname:"Alice Brown",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:100,sunshines:100,stars:.28}]},{nickname:"Robert Wilson",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:150,sunshines:150,stars:.42}]},{nickname:"Lisa Anderson",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!0,amount:500,sunshines:500,stars:1.39,receivers:[{nickname:"David Lee",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:300,sunshines:300,stars:.83}]},{nickname:"Chris Taylor",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:300,sunshines:300,stars:.83}],[{nickname:"Mark Thompson",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!0,amount:1500,sunshines:1500,stars:4.17,receivers:[{nickname:"Jennifer White",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:750,sunshines:750,stars:2.08},{nickname:"Kevin Martinez",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!0,amount:500,sunshines:500,stars:1.39,receivers:[{nickname:"Sophia Garcia",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:250,sunshines:250,stars:.69}]}]},{nickname:"Amanda Johnson",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:1e3,sunshines:1e3,stars:2.78}],[{nickname:"Oliver Martinez",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!0,amount:800,sunshines:800,stars:2.22,receivers:[{nickname:"Nina Patel",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:400,sunshines:400,stars:1.11}]},{nickname:"Ryan Cooper",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:600,sunshines:600,stars:1.67}]];async function G(i){try{const t=await z.getDonationsByGalaxyId({galaxyId:i});if(!t.data?.success||!t.data.data)return[];const a=t.data.data,m=[];for(const r of a){const n=await E(r.userId);if(!n)continue;const c=Math.floor(Math.random()*k.length),h=k[c],x={...r,amount:r.spendUsdAmount,date:r.createdAt?r.createdAt*1e3:Date.now(),blockchainTx:r.initiateTxId,user:{nickname:n.nickname||"Unknown",icon:n.src,sunshines:n.sunshines||0,stars:n.stars||0,isMaintainer:n.role==="maintainer"},receivers:h};m.push(x)}return m}catch(t){return console.error("Error getting donations:",t),[]}}const Te=({galaxyId:i,defaultShowCascaded:t=!1})=>{const[a,m]=d.useState(t),[r,n]=d.useState([]),[c,h]=d.useState(!0),[x,C]=d.useState(new Set),[g,L]=d.useState(new Set);d.useEffect(()=>{i&&(async()=>{h(!0);try{const j=await G(i);n(j)}catch(j){console.error("Error fetching donations:",j)}finally{h(!1)}})()},[i]);const U=s=>{C(new Set([...x,s])),alert("We sent email to the user notifying your feedback")},A=s=>{L(new Set([...g,s]))},f=a?r.filter(s=>s.maintainer):r;return c?e.jsx(v,{title:"Donation History",children:e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading donations..."})}):e.jsxs(v,{title:"Donation History",children:[e.jsx(J,{defaultShowCascaded:t,showCascaded:a,onToggle:m}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-2 text-sm font-medium text-gray-600",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-600",children:"#"}),"ID"]})}),e.jsx("th",{className:"text-left py-3 px-2 text-sm font-medium text-gray-600 text-blue-600",children:"Proof"}),e.jsx("th",{className:"text-left py-3 px-2 text-sm font-medium text-gray-600 text-blue-600",children:"Amount"}),e.jsx("th",{className:"text-left py-3 px-2 text-sm font-medium text-gray-600",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-2 text-sm font-medium text-gray-600",children:"User"}),!a&&e.jsx("th",{className:"text-left py-3 px-2 text-sm font-medium text-gray-600",children:"Memo"}),a&&e.jsx("th",{className:"text-left py-3 px-2 text-sm font-medium text-gray-600",children:"Cascade"})]})}),e.jsx("tbody",{children:f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-8 text-center text-gray-500",children:"No donations found"})}):f.map(s=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50 dark:hover:bg-teal-900/40",children:[e.jsx("td",{className:"py-4 px-2",children:e.jsx("div",{className:"flex items-center gap-1 text-sm text-gray-800 dark:text-gray-400 pl-3",children:s._id?s._id.substring(0,8):"N/A"})}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(b,{uri:N(s.initiateTxId),asNewTab:!0,className:"text-blue-600 hover:underline dark:text-blue-400 dark:hover:text-blue-300",children:"Deposit Tx"}),e.jsx("span",{className:"text-gray-400 dark:text-gray-600",children:"|"}),e.jsx(b,{uri:N(s.hyperpayTxId),asNewTab:!0,className:"text-blue-600 hover:underline dark:text-blue-400 dark:hover:text-blue-300",children:"Hyperpay Tx"})]})}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{content:e.jsx("div",{className:"text-sm",children:a&&s.maintainer?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"Maintainer who shared his donations with you"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:s.maintainer.icon||"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",alt:s.maintainer.nickname,className:"w-12 h-12 rounded-full"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:s.maintainer.nickname}),e.jsx("span",{className:"text-xs bg-blue-500 text-white px-1.5 py-0.5 rounded",children:"Maintainer"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[o({iconType:"sunshine",className:"w-4 h-4"}),e.jsx(l,{value:s.maintainer.sunshines,locales:"en-US",format:{style:"decimal",maximumFractionDigits:0},className:"text-xs"}),o({iconType:"star",className:"w-4 h-4"}),e.jsx(l,{value:s.maintainer.stars,locales:"en-US",format:{style:"decimal",maximumFractionDigits:2},className:"text-xs"})]})]})]})]}):"Amount user donated"}),children:e.jsx(l,{value:s.amount,locales:"en-US",format:{style:"currency",currency:"USD",maximumFractionDigits:2},className:"text-sm font-medium text-gray-800 dark:text-gray-400"})}),!a&&e.jsx(I,{receivers:s.receivers})]})}),e.jsx("td",{className:"py-4 px-2",children:e.jsx(R,{datetime:s.date,className:"text-sm text-gray-800 dark:text-gray-400"})}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{content:e.jsxs("div",{className:"text-sm",children:["Who donated",e.jsx("div",{className:"mt-2",children:e.jsx(y,{src:s.user.icon,nickname:s.user.nickname,sunshines:s.user.sunshines,stars:s.user.stars,role:s.user.isMaintainer?"maintainer":"user"})})]}),children:e.jsx(y,{src:s.user.icon,nickname:s.user.nickname,sunshines:s.user.sunshines,stars:s.user.stars,role:s.user.isMaintainer?"maintainer":"user"})}),e.jsx(p,{content:e.jsxs("div",{className:"text-sm",children:["Received ",s.user.sunshines," sunshines. ",o({iconType:"star",className:"w-4 h-4 inline"})," 1 = 360 sunshines"]}),children:e.jsxs("div",{className:"flex items-center gap-1",children:[o({iconType:"sunshine",className:"w-4 h-4"}),e.jsx(l,{value:s.user.sunshines,locales:"en-US",format:{style:"decimal",maximumFractionDigits:0},className:"text-sm text-gray-800 dark:text-gray-400"}),e.jsx("span",{className:"text-gray-500",children:"+"})]})})]})}),!a&&e.jsx("td",{className:"py-4 px-2",children:s.memo?e.jsxs(w,{children:[e.jsx(S,{className:"hyperlink flex items-center justify-center shadow-none",children:e.jsxs("div",{className:"text-sm text-gray-800 dark:text-gray-400 italic max-w-xs truncate",children:['"',s.memo.substring(0,64),s.memo.length>64?"...":"",'"']})}),e.jsx(T,{children:e.jsx(F,{sideOffset:8,side:"bottom",className:"z-999!",children:e.jsxs(D,{className:"w-96 origin-[var(--transform-origin)] rounded-xs bg-[canvas] px-6 py-4 text-gray-900 shadow-sm shadow-gray-900 dark:text-slate-300 dark:shadow-slate-300 transition-[transform,scale,opacity] data-[ending-style]:scale-90 data-[ending-style]:opacity-0 data-[starting-style]:scale-90 data-[starting-style]:opacity-0",children:[e.jsx(H,{className:"data-[side=bottom]:top-[-8px] data-[side=left]:right-[-13px] data-[side=left]:rotate-90 data-[side=right]:left-[-13px] data-[side=right]:-rotate-90 data-[side=top]:bottom-[-8px] data-[side=top]:rotate-180"}),e.jsx(W,{className:"text-gray-500 dark:text-gray-400 font-medium text-md mb-2",children:"Memo"}),e.jsx(P,{className:"text-gray-600 dark:text-slate-400 text-sm mb-4",children:s.memo}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:"secondary",size:"sm",onClick:()=>A(s._id||s.initiateTxId),disabled:g.has(s._id||s.initiateTxId),children:g.has(s._id||s.initiateTxId)?"Completed":"Complete"}),e.jsxs(u,{variant:"primary",size:"sm",onClick:()=>U(s._id||s.initiateTxId),disabled:x.has(s._id||s.initiateTxId),className:"flex items-center gap-1",children:[o({iconType:"likes",className:"w-4 h-4"}),x.has(s._id||s.initiateTxId)?"Liked":"Like"]})]})]})})})]}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),a&&e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{}),e.jsx(p,{content:e.jsxs("div",{className:"text-sm",children:["Shared at the ",s.cascadeLevel||3," level"]}),children:e.jsx(M,{variant:"info",static:!0,children:e.jsx(l,{value:s.cascadeLevel||3,locales:"en-US",format:{style:"decimal",maximumFractionDigits:0}})})})]})})]},s._id||s.initiateTxId))})]})})]})};export{Te as default};
