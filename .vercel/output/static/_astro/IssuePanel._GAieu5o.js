import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.DxhH1ShK.js";import{B as se}from"./Panel.n1yQPIfZ.js";import"./ripple.CLh-JuST.js";import"./accordion.Drwdne5y.js";import{g as j}from"./index.B-oIZhPt.js";import{P as ie}from"./PanelAction.BT-fj3Wj.js";import{B as f}from"./Badge.CwoN8wRJ.js";import{C as te}from"./Link.DQs8_5h1.js";import{B as n}from"./Button.BGGO0Gl0.js";import{u as ae,E}from"./Editable.MPzhcSg3.js";import{I as ne}from"./InfoPanel.CYfPf7Ka.js";import{C as u}from"./Tooltip.Cp89g2lg.js";import{T,g as re}from"./utils.6p6Hyl_a.js";import{P as le,F as ce}from"./PanelStat.t9y2r0gi.js";import{M as I}from"./MenuAvatar.DNnCbCL7.js";import{T as oe}from"./timeago-react.CCkgRyVe.js";import{S as de}from"./index.D4qZ0oW6.js";import{K as A}from"./Kbd.C4zmJFw1.js";import{a as H}from"./virtual.VUcB3V37.js";import{g as me}from"./demo.DsLEr97b.js";import{g as he}from"./user.BVCe9jQZ.js";import{I as O}from"./issue.CJErfNqu.js";import"./utils.BnlJtBIq.js";import"./eventTypes.CfSurkCl.js";import"./slot.DPiB-jfz.js";import"./index.CqUFkXl9.js";import"./proxy.D4YeN7SK.js";import"./use-controlled-state.FkpCVSoL.js";import"./index.VlIKThXs.js";import"./index.DpebaNh_.js";import"./index.CG_O7YBG.js";import"./ElectricBorder.DAWLx7iV.js";import"./accordion.CeZr6L_N.js";import"./createLucideIcon.C1tpinp8.js";import"./NumberFlow-client-48rw3j0J.DO-Ted3l.js";import"./client.B9YBqyHK.js";function ue({editor:t,className:o=""}){const a=ae({editor:t,selector:s=>({isBold:s.editor.isActive("bold")??!1,canBold:s.editor.can().chain().toggleBold().run()??!1,isItalic:s.editor.isActive("italic")??!1,canItalic:s.editor.can().chain().toggleItalic().run()??!1,isStrike:s.editor.isActive("strike")??!1,canStrike:s.editor.can().chain().toggleStrike().run()??!1,isCode:s.editor.isActive("code")??!1,canCode:s.editor.can().chain().toggleCode().run()??!1,canClearMarks:s.editor.can().chain().unsetAllMarks().run()??!1,isParagraph:s.editor.isActive("paragraph")??!1,isHeading1:s.editor.isActive("heading",{level:1})??!1,isHeading2:s.editor.isActive("heading",{level:2})??!1,isHeading3:s.editor.isActive("heading",{level:3})??!1,isHeading4:s.editor.isActive("heading",{level:4})??!1,isHeading5:s.editor.isActive("heading",{level:5})??!1,isHeading6:s.editor.isActive("heading",{level:6})??!1,isBulletList:s.editor.isActive("bulletList")??!1,isOrderedList:s.editor.isActive("orderedList")??!1,isCodeBlock:s.editor.isActive("codeBlock")??!1,isBlockquote:s.editor.isActive("blockquote")??!1,canUndo:s.editor.can().chain().undo().run()??!1,canRedo:s.editor.can().chain().redo().run()??!1})});return e.jsx(ne,{className:o,children:e.jsxs("div",{className:"flex flex-wrap flex-row justify-start items-center gap-1 w-full",children:[e.jsx(n,{variant:"secondary",onClick:()=>{t.chain().focus().toggleBold().run()},disabled:!a.canBold,className:"w-10 h-10"+a.isBold?"is-active":"",children:"Bold"}),e.jsx(n,{variant:"secondary",onClick:()=>t.chain().focus().toggleItalic().run(),disabled:!a.canItalic,className:"w-10 h-10"+a.isItalic?"is-active":"",children:"Italic"}),e.jsx(n,{variant:"secondary",onClick:()=>t.chain().focus().toggleStrike().run(),disabled:!a.canStrike,className:"w-10 h-10"+a.isStrike?"is-active":"",children:"Strike"}),e.jsx(n,{variant:"secondary",onClick:()=>t.chain().focus().toggleCode().run(),disabled:!a.canCode,className:"w-10 h-10"+a.isCode?"is-active":"",children:"Code"}),e.jsx(n,{variant:"secondary",onClick:()=>t.chain().focus().unsetAllMarks().run(),children:"Clear marks"}),e.jsx(n,{variant:"secondary",onClick:()=>t.chain().focus().clearNodes().run(),children:"Clear nodes"}),e.jsx(n,{variant:"secondary",onClick:()=>t.chain().focus().setParagraph().run(),className:"w-10 h-10"+a.isParagraph?"is-active":"",children:"Paragraph"}),e.jsx(n,{onClick:()=>t.chain().focus().toggleHeading({level:1}).run(),className:"w-10 h-10"+a.isHeading1?"is-active":"",children:"H1"}),e.jsx(n,{onClick:()=>t.chain().focus().toggleHeading({level:2}).run(),className:"w-10 h-10"+a.isHeading2?"is-active":"",children:"H2"}),e.jsx(n,{onClick:()=>t.chain().focus().toggleHeading({level:3}).run(),className:"w-10 h-10"+a.isHeading3?"is-active":"",children:"H3"}),e.jsx(n,{onClick:()=>t.chain().focus().toggleHeading({level:4}).run(),className:"w-10 h-10"+a.isHeading4?"is-active":"",children:"H4"}),e.jsx(n,{onClick:()=>t.chain().focus().toggleHeading({level:5}).run(),className:"w-10 h-10"+a.isHeading5?"is-active":"",children:"H5"}),e.jsx(n,{onClick:()=>t.chain().focus().toggleHeading({level:6}).run(),className:"w-10 h-10"+a.isHeading6?"is-active":"",children:"H6"}),e.jsx(n,{onClick:()=>t.chain().focus().toggleBulletList().run(),className:"w-10 h-10"+a.isBulletList?"is-active":"",children:"Bullet list"}),e.jsx(n,{onClick:()=>t.chain().focus().toggleOrderedList().run(),className:"w-10 h-10"+a.isOrderedList?"is-active":"",children:"Ordered list"}),e.jsx(n,{onClick:()=>t.chain().focus().toggleCodeBlock().run(),className:"w-10 h-10"+a.isCodeBlock?"is-active":"",children:"Code block"}),e.jsx(n,{onClick:()=>t.chain().focus().toggleBlockquote().run(),className:"w-10 h-10"+a.isBlockquote?"is-active":"",children:"Blockquote"}),e.jsx(n,{onClick:()=>t.chain().focus().setHorizontalRule().run(),children:"Horizontal rule"}),e.jsx(n,{onClick:()=>t.chain().focus().setHardBreak().run(),children:"Hard break"}),e.jsx(n,{onClick:()=>t.chain().focus().undo().run(),disabled:!a.canUndo,children:"Undo"}),e.jsx(n,{onClick:()=>t.chain().focus().redo().run(),disabled:!a.canRedo,children:"Redo"})]})})}const xe=({saving:t=!1,label:o="profile"})=>e.jsx(f,{variant:t?"info":"gray",active:!0,static:!t,children:t?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-5 h-5",variant:"ellipsis"},"ellipsis")," saving"]}):`Your ${o}`}),fe=({showEditBar:t,setShowEditBar:o})=>e.jsx(f,{variant:"gray",active:!0,static:!0,children:t?e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(A,{onPress:()=>o(!1),overwrittenChildren:"esc",children:"esc"})," "," ","cancel"]}):e.jsxs("div",{className:"flex items-center space-x-1 px-1",children:[e.jsx(A,{onPress:()=>o(!0),overwrittenChildren:"ctrl+space",children:"ctrl"})," +",e.jsx(A,{className:"mx-1",children:"space"})," "," show edit bar"]})}),es=({actions:t,onSave:o,...a})=>{const[s,L]=r.useState(a);r.useEffect(()=>{L(a)},[a._id,a.contributor,a.author,a.maintainer,a.title,a.description]);const V=s._id?`#${s._id.slice(-6)}`:"#0",g=(s.tags&&s.tags.length>0?s.tags[0]:void 0)||"improvement",p=s.sunshines>0,[N,U]=r.useState(null),[Y,P]=r.useState(!1),[v,q]=r.useState(null),[K,F]=r.useState(!1),[k,R]=r.useState(null),[G,_]=r.useState(!1),[y,J]=r.useState(null);r.useEffect(()=>{s.author&&typeof s.author=="string"?(P(!0),H.getUserById({userId:s.author}).then(i=>{i.data?.success&&i.data.data&&U(i.data.data)}).catch(i=>{console.error("Error fetching author:",i)}).finally(()=>{P(!1)})):U(null)},[s.author]),r.useEffect(()=>{s.contributor&&typeof s.contributor=="string"?(F(!0),H.getUserById({userId:s.contributor}).then(i=>{i.data?.success&&i.data.data&&q(i.data.data)}).catch(i=>{console.error("Error fetching contributor:",i)}).finally(()=>{F(!1)})):q(null)},[s.contributor]),r.useEffect(()=>{s.maintainer&&typeof s.maintainer=="string"?(_(!0),H.getUserById({userId:s.maintainer}).then(i=>{i.data?.success&&i.data.data&&R(i.data.data)}).catch(i=>{console.error("Error fetching maintainer:",i)}).finally(()=>{_(!1)})):R(null)},[s.maintainer]),r.useEffect(()=>{const i=me();if(i.email&&i.users&&i.role){const l=i.users.find(c=>c.role===i.role)||i.users[0];l&&l._id&&he(l._id.toString()).then(c=>{c&&J(c)}).catch(c=>{console.error("Error fetching current user:",c)})}},[]),r.useEffect(()=>{const i=async l=>{L(l.detail)};return window.addEventListener(O.ISSUE_UPDATE,i),()=>{window.removeEventListener(O.ISSUE_UPDATE,i)}},[s._id]);const Q=y&&s.author&&y._id===s.author,W=y?.role==="maintainer",d=Q||W,[m,D]=r.useState({title:s.title,description:s.description,technicalRequirements:"<p>Implement unified OAuth client library</p><p>Create consistent token storage mechanism</p><p>Design user permission management interface</p><p>Develop automated token refresh process</p><p>Ensure GDPR compliance for all data transfers</p>"});r.useEffect(()=>{D({title:s.title,description:s.description,technicalRequirements:m.technicalRequirements})},[s.title,s.description]);const[h,M]=r.useState(!1),[w,b]=r.useState(!1),[$,X]=r.useState(null);r.useEffect(()=>{h&&setTimeout(()=>{M(!1)},2e3)},[h]);const Z=()=>{alert("Heyya!")},C={onActivate:()=>{b(!w)},onCancel:()=>{b(!1)},onBlur:(i,l)=>{if(l!==null){const c=l.getHTML();if(m[i]!==c){const z={...m};z[i]=c,D(z),M(!0),o&&o({title:i==="title"?l.getText():void 0,description:i==="description"?l.getText():void 0,technicalRequirements:i==="technicalRequirements"?c:void 0})}}},onFocus:(i,l)=>{X(l)}},ee=e.jsxs("div",{className:"flex flex-col space-y-2 w-full",children:[e.jsxs(n,{onClick:()=>console.log("Liked"),variant:"secondary",size:"sm",className:"h-7 px-2 text-xs w-full",children:[j({iconType:"likes",className:"w-3 h-3 mr-0.5"}),"Like"]}),e.jsxs(n,{variant:"secondary",size:"sm",className:"h-7 px-2 text-xs w-full",children:[j({iconType:"likes",className:"w-3 h-3 mr-0.5"}),"Dislike"]}),e.jsxs(n,{variant:"primary",size:"sm",className:"h-7 px-2 text-xs w-full",children:[j({iconType:"vote-priority",className:"w-3 h-3 mr-0.5"}),"Fund"]})]}),S=" py-0 px-1 h-6 text-sm",B=t?t.map(i=>({...i,className:i.className?i.className+S:S})):[],x=d?{icon:"settings",children:j({iconType:"settings",className:"w-4 h-4"}),onClick:Z,className:S}:null;return e.jsxs(se,{className:`${h&&"cursor-progress"}`,children:[w&&$!==null&&e.jsx(ue,{editor:$,className:"fixed top-0 left-0 right-0 h-28 z-999"}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"w-16 overflow-hidden flex flex-col space-y-2 items-center",children:[e.jsx(te,{uri:s.uri,asNewTab:!1,children:e.jsx(f,{variant:"info",static:!0,children:e.jsxs("div",{className:"flex items-center space-x-1",children:[j("cascadefund"),e.jsx("span",{className:"text-xs font-medium",children:V})]})})}),!p&&ee]}),e.jsxs("div",{className:"flex-1 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(u,{openDelay:2e3,content:e.jsx("div",{className:"text-sm",children:d?"Title is editable for issue owners.":"Issue title"}),children:e.jsxs("h1",{className:"text-xl font-bold text-gray-500 dark:text-slate-100 flex space-x-1 items-center gap-1",children:[d?e.jsx(E,{id:"title",content:m.title||"No title",editable:!h,limit:100,className:"mt-0.5",...C}):e.jsx("div",{className:"mt-1",children:m.title||"No title"}),d?e.jsx(xe,{saving:h,label:"issue"}):e.jsx(f,{variant:"gray",static:!0,children:"Not editable"}),d&&e.jsx(fe,{showEditBar:w,setShowEditBar:b})]})}),s.solarForgeTxid&&e.jsx(u,{content:e.jsx("div",{className:"text-sm",children:"View the Solar Forge by this issue on the blockchain explorer"}),children:e.jsx("a",{href:`https://sepolia.basescan.org/tx/${s.solarForgeTxid}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-cyan-400 hover:text-cyan-300 transition-colors",children:e.jsx(T,{className:"w-4 h-4"})})}),e.jsx(f,{variant:p?"success":"gray",static:!0,children:p?"Shining":"Public Backlog"})]}),e.jsx(f,{variant:g==="bug"?"danger":g==="feature"?"blue":g==="improvement"?"success":g==="enhancement"?"warning":"info",static:!0,children:g})]}),e.jsx("div",{className:"text-slate-700 dark:text-slate-200 text-md mb-4 prose max-w-none",children:e.jsx(u,{openDelay:2e3,content:e.jsx("div",{className:"text-sm",children:d?"Description is editable for issue owners.":"Issue description"}),children:d?e.jsx(E,{id:"description",content:m.description||"No description",editable:!h,limit:500,...C}):e.jsx("p",{children:m.description||"No description"})})}),e.jsxs("div",{className:"mb-4 text-slate-600 dark:text-slate-400 text-sm",children:[e.jsx("h3",{className:"text-lg text-slate-700 dark:text-slate-300",children:"Technical Requirements"}),e.jsx(u,{openDelay:2e3,content:e.jsx("div",{className:"text-sm",children:d?"Technical requirements are editable for issue owners.":"Technical requirements"}),children:d?e.jsx(E,{id:"technicalRequirements",content:m.technicalRequirements,editable:!h,limit:1e3,...C}):e.jsx("div",{className:"prose max-w-none",dangerouslySetInnerHTML:{__html:m.technicalRequirements}})})]}),(v||k||N||s.createdTime)&&e.jsxs("div",{className:`flex items-center space-x-1 text-gray-500 gap-1 text-xs mb-2 ${v?"justify-between":"justify-end"}`,children:[v&&k&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"Contributor"}),K?e.jsx("span",{className:"text-xs text-gray-400",children:"Loading..."}):e.jsx(I,{src:v.src,uri:v.uri,className:"w-7! h-7!"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"Maintainer"}),G?e.jsx("span",{className:"text-xs text-gray-400",children:"Loading..."}):e.jsx(I,{src:k.src,uri:k.uri,className:"w-7! h-7!"})]})]}),N&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"By"}),Y?e.jsx("span",{className:"text-xs text-gray-400",children:"Loading..."}):e.jsx(I,{src:N.src,uri:N.uri,className:"w-7! h-7!"}),s.createdTime&&e.jsx(oe,{datetime:typeof s.createdTime=="number"?s.createdTime*1e3:s.createdTime})]})})]}),(s.stats||B.length>0||x||s.solarForgeTxid||p&&s.sunshines>0)&&e.jsxs(le,{className:"flex flex-row justify-between items-center mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[B.length>0&&e.jsx(ie,{className:"",actions:B}),x&&e.jsx(u,{openDelay:500,content:e.jsx("div",{className:"text-sm",children:"Edit the issue"}),children:e.jsx(n,{onClick:x.onClick,className:x.className,variant:x.variant,children:x.children})}),s.solarForgeTxid?e.jsx(u,{content:e.jsx("div",{className:"text-sm",children:"View solar forge transaction on blockchain explorer"}),children:e.jsxs("a",{href:`https://sepolia.basescan.org/tx/${s.solarForgeTxid}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-cyan-400 hover:text-cyan-300 transition-colors",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{children:"Solar Forge"})]})}):p&&s.sunshines>0?e.jsx(u,{content:e.jsx("div",{className:"text-sm",children:"Solar forge this issue to convert sunshines to stars"}),children:e.jsxs("span",{className:"text-sm text-slate-500 dark:text-slate-400",children:[e.jsx(T,{className:"w-4 h-4 inline mr-1"}),"Solar Forge"]})}):null]}),s.stats&&Object.values(s.stats).map((i,l)=>e.jsx(ce,{triggerClassName:"text-sm",iconType:re(i.type),hint:i.hint,fill:i.filled,children:i.children},l.toString()))]})]})]})]})};export{es as default};
