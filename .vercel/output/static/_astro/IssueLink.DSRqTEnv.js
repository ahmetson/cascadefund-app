import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as d}from"./index.DxhH1ShK.js";import{C as _}from"./Link.DQs8_5h1.js";import{g as p}from"./index.C9GdNTjf.js";import{T as S,g as B}from"./utils.6p6Hyl_a.js";import{B as v}from"./Badge.CwoN8wRJ.js";import{P as G,F as k}from"./PanelStat.CwJxTn_z.js";import{M as E}from"./MenuAvatar.Cp5B2elA.js";import{T as M}from"./timeago-react.CCkgRyVe.js";import{P as V}from"./PanelAction.7HK8ne8S.js";import{S as U}from"./index.D4qZ0oW6.js";import{R,T as $,a as z,b as L}from"./index.CCa9K2qb.js";import{N as j,a as D}from"./NumberFlow-client-48rw3j0J.DO-Ted3l.js";import{B as O}from"./Button.CnXYplS9.js";import{c as W}from"./utils.BnlJtBIq.js";import{C as y}from"./Tooltip.X-wb9Q3Q.js";import{P as Y,a as q,b as H,c as J,d as K,e as Q,f as X}from"./PopoverDescription.D_bkkxd4.js";import{P as Z}from"./PopoverTitle.CqQuFsbZ.js";import{g as F}from"./demo.DsLEr97b.js";import{e as ee}from"./issue.CNzGGm0q.js";import{g as P}from"./user.BVCe9jQZ.js";const se=(s,a)=>s==null?a:a==null?s:Math.max(s,a),I=new WeakMap,te={onUpdate(s,a,i){if(I.set(i,void 0),!i.computedTrend)return;const g=a.integer.concat(a.fraction).filter(r=>r.type==="integer"||r.type==="fraction"),x=s.integer.concat(s.fraction).filter(r=>r.type==="integer"||r.type==="fraction"),c=g.find(r=>!x.find(o=>o.pos===r.pos&&o.value===r.value)),n=x.find(r=>!g.find(o=>r.pos===o.pos&&r.value===o.value));I.set(i,se(c?.pos,n?.pos))},getDelta(s,a,i){const g=s-a,x=I.get(i.flow);if(!g&&x!=null&&x>=i.pos)return i.length*i.flow.computedTrend}},ae=({availableSunshines:s,currentSunshines:a,issueId:i,galaxyId:g,userId:x,onApply:c})=>{const[n,r]=d.useState(a),[o,N]=d.useState(!1),[f]=d.useState(a);d.useEffect(()=>{r(a)},[a]);const w=A=>{r(A[0])},T=()=>{N(!0),c(n),setTimeout(()=>{N(!1)},2e3)},m=n-f;let u=s-m;u>s&&(u=s),u<0&&(u=0);const t=n!==f,h=a+s,l=Math.floor(n/360),C=Math.floor(a/360),b=e.jsx(y,{content:e.jsxs("div",{className:"text-sm space-y-3",children:[e.jsxs("div",{className:"font-semibold",children:["Total sunshines: ",a]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-4xl",children:p({iconType:"star",className:"w-10 h-10 text-yellow-400 dark:text-yellow-500",fill:"currentColor"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:C}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Potential Stars"}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:["(",a," ÷ 360)"]})]})]})]}),openDelay:500,children:e.jsxs("div",{className:"flex items-center space-x-1 justify-center cursor-pointer hover:opacity-80 transition-opacity",children:[p({iconType:"sunshine",fill:"currentColor",className:"w-5 h-5 mt-0.5 mr-1"}),e.jsx(j,{value:a,locales:"en-US",format:{useGrouping:!0},className:"text-sm font-semibold"})]})});return e.jsxs(Y,{children:[e.jsx(q,{className:"hyperlink flex items-center justify-center shadow-none",children:b}),e.jsx(H,{children:e.jsx(J,{sideOffset:8,side:"bottom",className:"z-700!",children:e.jsxs(K,{className:"w-96 origin-[var(--transform-origin)] rounded-xs bg-[canvas] px-6 py-4 text-gray-900 shadow-sm shadow-gray-900 transition-[transform,scale,opacity] data-[ending-style]:scale-90 data-[ending-style]:opacity-0 data-[starting-style]:scale-90 data-[starting-style]:opacity-0",children:[e.jsx(Q,{className:"data-[side=bottom]:top-[-8px] data-[side=left]:right-[-13px] data-[side=left]:rotate-90 data-[side=right]:left-[-13px] data-[side=right]:-rotate-90 data-[side=top]:bottom-[-8px] data-[side=top]:rotate-180",children:p("arrow")}),e.jsxs(Z,{className:"text-gray-500 font-medium text-md flex items-center flex-row p-1 mb-4 gap-1",children:["Issue's Sunshines",e.jsx(v,{variant:"success",static:!0,children:e.jsxs(D,{children:[e.jsx(j,{value:a,locales:"en-US",format:{useGrouping:!1},className:"font-semibold text-sky-500 dark:text-sky-200"}),t&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",children:"→"}),e.jsx(j,{value:n,locales:"en-US",format:{useGrouping:!1},className:"text-xs text-slate-500 dark:text-slate-200"})]})]})})]}),e.jsxs(X,{className:"text-gray-600",children:[e.jsxs("div",{className:"flex flex-col items-center mb-6 mt-4",children:[e.jsx("div",{className:"text-6xl mb-2",children:p({iconType:"star",className:"w-16 h-16 text-yellow-400 dark:text-yellow-500",fill:"currentColor"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400 mb-1",children:e.jsx(j,{value:l,locales:"en-US",format:{useGrouping:!1}})}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Potential Stars"}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:["(",n," sunshines ÷ 360)"]})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs(R,{value:[n],onValueChange:w,max:h,min:0,step:1,className:"relative flex h-5 w-full touch-none select-none items-center",children:[e.jsxs($,{className:"relative h-[3px] grow rounded-full bg-zinc-300 dark:bg-zinc-800",children:[e.jsx(z,{className:"absolute h-full rounded-full bg-gradient-to-r from-yellow-400 to-orange-500"}),t&&e.jsx("div",{className:"absolute h-full border-l-2 border-dashed border-gray-400 opacity-50",style:{left:`${f/h*100}%`}})]}),e.jsx(L,{className:"relative hyperlink block h-5 w-5 rounded-[1rem] bg-white dark:bg-slate-300 dark:hover:bg-slate-200 shadow-md ring ring-black/10",children:e.jsx(j,{value:n,locales:"en-US",format:{useGrouping:!1},plugins:[te],className:"absolute left-1/2 -translate-x-1/2 text-xs text-gray-500 font-semibold"})})]})}),e.jsxs("div",{className:"mb-4 text-center",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Your Sunshines: "}),e.jsx(j,{value:s,locales:"en-US",format:{useGrouping:!1},className:"font-semibold"}),t&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs",children:"→"}),e.jsx(j,{value:u,locales:"en-US",format:{useGrouping:!1},className:"text-xs"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(O,{variant:"primary",onClick:T,disabled:o||!t||m>s,className:W("px-6",o&&"cursor-wait"),children:o?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-5 h-5",variant:"ellipsis"},"ellipsis")," saving..."]}):"Save"})})]})]})})})]})},Se=s=>{const[a,i]=d.useState(null),[g,x]=d.useState(!1),[c,n]=d.useState(null),[r,o]=d.useState(0),[,N]=d.useState(!1),f=s.sunshines>0,w=!!s.patchable&&!s.versionTag,T=!!s.versionTag,m=s.tags&&s.tags.length>0?s.tags[0]:void 0;d.useEffect(()=>{s.author&&typeof s.author=="string"&&(x(!0),P(s.author).then(t=>{t&&i(t)}).catch(t=>{console.error("Error fetching author:",t)}).finally(()=>{x(!1)}))},[s.author]),d.useEffect(()=>{if(!s.draggable){const t=F();if(t.email&&t.users&&t.role){const h=t.users.find(l=>l.role===t.role)||t.users[0];h&&h._id&&P(h._id.toString()).then(l=>{l&&(n(l),o(l.sunshines||0))}).catch(l=>{console.error("Error fetching current user:",l)})}}},[s.draggable]);const u=async t=>{if(!c||!s._id||!s.galaxy)return;const h=t-s.sunshines;if(!(h<=0)){N(!0);try{const l=F();if(!l.email){alert("Please log in to add sunshines");return}if(await ee({issueId:s._id,userId:c._id.toString(),email:l.email,sunshinesToAdd:h})){if(c._id){const b=await P(c._id.toString());b&&o(b.sunshines||0)}}else alert("Failed to update sunshines")}catch(l){console.error("Error updating sunshines:",l),alert("An error occurred while updating sunshines")}finally{N(!1)}}};return e.jsxs("div",{className:"flex flex-row gap-1 items-start w-full",children:[e.jsx("div",{className:"flex items-center space-x-3 mt-0.5",children:e.jsx(y,{content:e.jsxs("div",{className:"text-sm flex gap-1",children:["Got to see the  ",p({iconType:"arrow-right",className:"w-4 h-4 mt-0.5"}),e.jsx("p",{className:"flex-1 bg-slate-100/20 rounded-sm",children:s.title}),p({iconType:"arrow-left",className:"w-4 h-4 mt-0.5"}),"issue page"]}),children:e.jsx(_,{uri:`/issue?id=${s._id}&galaxy=${s.galaxy}`,asNewTab:!1,children:e.jsx(v,{variant:"info",static:!0,children:e.jsxs("div",{className:"flex items-center space-x-1",children:[p("ara"),e.jsx("span",{className:"text-xs font-medium underline",children:"..."})]})})})})}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1 ml-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg font-medium text-slate-700 dark:text-slate-300/80",children:s.title}),s.solarForgeTxid&&e.jsx(y,{content:e.jsx("div",{className:"text-sm",children:"View the Solar Forge by this issue on the blockchain explorer"}),children:e.jsx("a",{href:`https://sepolia.basescan.org/tx/${s.solarForgeTxid}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-cyan-400 hover:text-cyan-300 transition-colors",children:e.jsx(S,{className:"w-4 h-4"})})}),e.jsx(v,{variant:f?"success":"gray",static:!0,children:f?"Shining":"Public Backlog"}),T?e.jsx(y,{content:e.jsx("div",{className:"text-sm flex flex-col gap-2 p-2 max-w-xs",children:e.jsxs("div",{children:["Issue is patched. Patch completed ",String(s.patchCompleted),", patch reviewed: '",s.patchTested?"tested":"not tested","'. Its on the roadmap. In the ",e.jsx("span",{className:"font-semibold",children:s.versionTag})," version. Version next status: ",e.jsx("span",{className:"font-semibold",children:s.versionStatus})]})}),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"info",static:!0,children:s.versionTag}),e.jsx(v,{variant:s.versionStatus==="complete"?"blue":s.versionStatus==="testing"?"warning":s.versionStatus==="release"?"teal":s.versionStatus==="archived"?"green":"gray",static:!0,children:s.versionStatus})]})}):w&&e.jsx(y,{content:e.jsx("div",{className:"text-sm max-w-xs leading-snug",children:"This issue is patchable. Drag and drop into Patching hole."}),children:e.jsx(v,{variant:"orange",static:!0,className:"cursor-pointer select-none shadow-sm",children:e.jsxs("span",{className:"flex items-center gap-1",children:["Patchable ",p("info")]})})})]}),m&&e.jsx(v,{variant:m==="bug"?"danger":m==="feature"?"blue":m==="improvement"?"success":m==="enhancement"?"warning":"info",static:!0,children:m})]}),e.jsx("p",{className:"text-base text-slate-600 dark:text-slate-400",children:s.description}),(s.author||s.createdTime)&&e.jsxs("div",{className:"flex justify-end items-center space-x-1 text-slate-600 dark:text-slate-400 gap-1 text-xs",children:[s.author&&e.jsxs(e.Fragment,{children:["By ",g?e.jsx("div",{className:"w-7 h-7 flex items-center justify-center",children:e.jsx(U,{className:"w-7 h-7",variant:"ellipsis"})}):a?e.jsx(E,{user:a,className:"w-7! h-7!"}):null]}),s.createdTime&&e.jsx(M,{datetime:s.createdTime*1e3})]}),(s.stats||s.actions||s.sunshines>=0)&&e.jsxs(G,{className:"flex flex-row justify-between items-center mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.actions&&e.jsx(V,{className:"",actions:s.actions}),s.solarForgeTxid?e.jsx(y,{content:e.jsx("div",{className:"text-sm",children:"View solar forge transaction on blockchain explorer"}),children:e.jsxs("a",{href:`https://sepolia.basescan.org/tx/${s.solarForgeTxid}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-cyan-400 hover:text-cyan-300 transition-colors",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{children:"Solar Forge"})]})}):f&&s.sunshines>0?e.jsx(y,{content:e.jsx("div",{className:"text-sm",children:"Solar forge this issue to convert sunshines to stars"}),children:e.jsxs("span",{className:"text-sm text-slate-500 dark:text-slate-400",children:[e.jsx(S,{className:"w-4 h-4 inline mr-1"}),"Solar Forge"]})}):null]}),s.sunshines>=0&&(!s.draggable&&c?e.jsx(ae,{availableSunshines:r,currentSunshines:s.sunshines,issueId:s._id||"",galaxyId:s.galaxy,userId:c._id.toString(),onApply:u}):e.jsx(k,{triggerClassName:"text-sm cursor-pointer hover:opacity-80 transition-opacity",iconType:"sunshine",hint:e.jsxs("div",{className:"text-sm space-y-3",children:[e.jsxs("div",{className:"font-semibold",children:["Total sunshines: ",s.sunshines]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-4xl",children:p({iconType:"star",className:"w-10 h-10 text-yellow-400 dark:text-yellow-500",fill:"currentColor"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:Math.floor(s.sunshines/360)}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Potential Stars"}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:["(",s.sunshines," ÷ 360)"]})]})]})]}),fill:!0,children:s.sunshines})),s.users&&s.users.length>0&&e.jsx(k,{triggerClassName:"text-sm",iconType:"user",hint:"Contributors",fill:!0,children:s.users.length}),s.stats&&Object.values(s.stats).map(t=>e.jsx(k,{triggerClassName:"text-sm",iconType:B(t.type),hint:t.hint,fill:t.filled,children:t.children},t.type))]})]})]})};export{Se as I};
