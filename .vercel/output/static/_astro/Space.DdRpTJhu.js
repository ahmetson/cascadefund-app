import{j as l}from"./jsx-runtime.D_zvdyIk.js";import{r as c}from"./index.DxhH1ShK.js";import{D as b,H as T}from"./index.CeIpCxKj.js";import{S as p,U}from"./UserStar.BQbjVhp1.js";import P from"./ProjectGalaxy.D0oDzn0M.js";import{C as N}from"./DropTarget.BRYVv9tN.js";import{c as V}from"./utils.BnlJtBIq.js";import{u as L}from"./all-stars.DwU73iD6.js";import"./Link.DQs8_5h1.js";import"./ElectricBorder.DAWLx7iV.js";import"./Tooltip.X-wb9Q3Q.js";import"./slot.BJ0WR7bA.js";import"./index.CqUFkXl9.js";import"./proxy.DplwUDe6.js";import"./index.BMZ1dBRY.js";import"./NumberFlow-client-48rw3j0J.DO-Ted3l.js";import"./index.C9GdNTjf.js";import"./Button.CnXYplS9.js";import"./ripple.CF16UbCB.js";import"./eventTypes.CfSurkCl.js";import"./virtual.VUcB3V37.js";import"./client.B9YBqyHK.js";const M=({users:u,className:y="",projectGalaxies:D,galaxyId:R})=>{const[S,k]=c.useState({width:0,height:0}),[C,E]=c.useState(u),[v,j]=c.useState(!1);c.useEffect(()=>{S.width===0&&S.height===0&&k({width:window.innerWidth,height:window.innerHeight})},[S]),c.useEffect(()=>{const t=e=>{const{userData:n}=e.detail;E(i=>{const r=i.findIndex(a=>a.nickname===n.nickname);if(r>=0){const a=[...i];return a[r]=n,a}else return[...i,n]})};return window.addEventListener(p.USER_STAR_CREATED,t),()=>{window.removeEventListener(p.USER_STAR_CREATED,t)}},[]),c.useEffect(()=>{const t=e=>{const{userId:n,nickname:i,x:r,y:a}=e.detail;(n||i)&&(E(s=>{const d=s.findIndex(o=>n?o.userId===n:o.nickname===i);if(d>=0){const o=[...s];return o[d]={...o[d],x:r,y:a},o}return s}),R&&n&&L({galaxyId:R,userId:n,x:r,y:a}).catch(s=>console.error("Failed to persist user star position",s)))};return window.addEventListener(p.USER_STAR_MOVED,t),()=>{window.removeEventListener(p.USER_STAR_MOVED,t)}},[]),c.useEffect(()=>{E(u)},[u]);const A=(t,e)=>{const n=document.querySelector("#galaxy-space");if(!n)return null;const i=n.getBoundingClientRect(),r=e.getClientOffset();if(!r)return null;const g=window.getComputedStyle(n).transform;let s=1;if(g&&g!=="none"){const m=g.match(/matrix\(([^)]+)\)/);if(m){const f=m[1].split(",");s=parseFloat(f[0])||1}}const d=(r.x-i.left)/s,o=(r.y-i.top)/s,w={...t,x:d,y:o,draggable:t.draggable??!0};return E(m=>{const f=m.findIndex(h=>h.nickname===w.nickname),x=f>=0,I=x?(()=>{const h=[...m];return h[f]={...h[f],...w},h})():[...m,w],_=x?p.USER_STAR_MOVED:p.USER_STAR_CREATED;return window.dispatchEvent(new CustomEvent(_,{detail:x?{userId:t.userId,nickname:t.nickname,x:d,y:o}:{userData:w,x:d,y:o}})),I}),{x:d,y:o}};return l.jsxs(N,{id:"galaxy-space",accept:["user-star"],onDrop:A,className:V("absolute top-0 left-0 w-full h-full border-none",y,v&&"z-[9999]",!v&&"pointer-events-none"),innerClassName:"w-full h-full",roundedClassName:"rounded-none",onStateChange:({isOver:t,canDrop:e})=>j(t||e),children:[C.filter(t=>t.x!==void 0&&t.y!==void 0).map((t,e)=>l.jsx("div",{style:{pointerEvents:"auto"},children:l.jsx(U,{leaderboardPosition:e+1,x:t.x||0,y:t.y||0,userId:t.userId,src:t.src,alt:t.alt,nickname:t.nickname,sunshines:t.sunshines,stars:t.stars,role:t.role,funded:t.funded,received:t.received,issuesClosed:t.issuesClosed,issuesActive:t.issuesActive,walletAddress:t.walletAddress||"0x1027298987234987234987234987234987234987",githubUrl:t.githubUrl||"https://github.com/ara-foundation/app",linkedinUrl:t.linkedinUrl||"https://www.linkedin.com/in/ara-foundation/",tags:t.tags,draggable:t.draggable,animationDelay:e*.5})},`${t.nickname}-${e}`)),D&&D.map((t,e)=>l.jsx("div",{style:{pointerEvents:"auto"},children:l.jsx(P,{x:t.x,y:t.y,projectName:t.projectName,projectId:t.projectId,galaxyData:t.galaxyData,tags:t.tags||t.galaxyData?.tags,leaderboardPosition:t.leaderboardPosition})},`galaxy-${t.projectName}-${e}`))]})},at=u=>l.jsx(b,{backend:T,children:l.jsx(M,{...u})});export{at as default};
