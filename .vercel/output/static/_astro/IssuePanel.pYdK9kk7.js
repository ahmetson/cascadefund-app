import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.DxhH1ShK.js";import{B as ee}from"./Panel.n1yQPIfZ.js";import"./ripple.CF16UbCB.js";import"./accordion.C2pAN9g7.js";import{g as p}from"./index.C9GdNTjf.js";import{P as te}from"./PanelAction.7HK8ne8S.js";import{B as j}from"./Badge.CwoN8wRJ.js";import{C as se}from"./Link.DQs8_5h1.js";import{B as N}from"./Button.CnXYplS9.js";import{E as S}from"./Editable.CH1EzvTw.js";import{M as ie,Y as ae,E as re}from"./EditableBadge.BPr4OUwa.js";import{C as m}from"./Tooltip.X-wb9Q3Q.js";import{T as I,g as ne}from"./utils.6p6Hyl_a.js";import{P as oe,F as ce}from"./PanelStat.CwJxTn_z.js";import{M as k}from"./MenuAvatar.Cp5B2elA.js";import{T as le}from"./timeago-react.CCkgRyVe.js";import{a as C}from"./virtual.VUcB3V37.js";import{g as me}from"./demo.DsLEr97b.js";import{g as de}from"./user.BVCe9jQZ.js";import{I as V}from"./issue.CJErfNqu.js";import"./utils.BnlJtBIq.js";import"./eventTypes.CfSurkCl.js";import"./slot.BJ0WR7bA.js";import"./index.CqUFkXl9.js";import"./proxy.DplwUDe6.js";import"./use-controlled-state.pHAnEIiX.js";import"./index.BAmrU33k.js";import"./index.BMZ1dBRY.js";import"./index.DQANnUHg.js";import"./ElectricBorder.DAWLx7iV.js";import"./InfoPanel.D6XfqDVr.js";import"./accordion.LYJqygqr.js";import"./createLucideIcon.C1tpinp8.js";import"./index.D4qZ0oW6.js";import"./Kbd.C4zmJFw1.js";import"./NumberFlow-client-48rw3j0J.DO-Ted3l.js";import"./client.B9YBqyHK.js";const We=({actions:B,onSave:U,...c})=>{const[t,A]=i.useState(c);i.useEffect(()=>{A(c)},[c._id,c.contributor,c.author,c.maintainer,c.title,c.description]);const H=t._id?`#${t._id.slice(-6)}`:"#0",x=(t.tags&&t.tags.length>0?t.tags[0]:void 0)||"improvement",h=t.sunshines>0,[f,F]=i.useState(null),[Y,L]=i.useState(!1),[u,_]=i.useState(null),[O,D]=i.useState(!1),[g,P]=i.useState(null),[G,q]=i.useState(!1),[v,J]=i.useState(null);i.useEffect(()=>{t.author&&typeof t.author=="string"?(L(!0),C.getUserById({userId:t.author}).then(s=>{s.data?.success&&s.data.data&&F(s.data.data)}).catch(s=>{console.error("Error fetching author:",s)}).finally(()=>{L(!1)})):F(null)},[t.author]),i.useEffect(()=>{t.contributor&&typeof t.contributor=="string"?(D(!0),C.getUserById({userId:t.contributor}).then(s=>{s.data?.success&&s.data.data&&_(s.data.data)}).catch(s=>{console.error("Error fetching contributor:",s)}).finally(()=>{D(!1)})):_(null)},[t.contributor]),i.useEffect(()=>{t.maintainer&&typeof t.maintainer=="string"?(q(!0),C.getUserById({userId:t.maintainer}).then(s=>{s.data?.success&&s.data.data&&P(s.data.data)}).catch(s=>{console.error("Error fetching maintainer:",s)}).finally(()=>{q(!1)})):P(null)},[t.maintainer]),i.useEffect(()=>{const s=me();if(s.email&&s.users&&s.role){const a=s.users.find(r=>r.role===s.role)||s.users[0];a&&a._id&&de(a._id.toString()).then(r=>{r&&J(r)}).catch(r=>{console.error("Error fetching current user:",r)})}},[]),i.useEffect(()=>{const s=async a=>{A(a.detail)};return window.addEventListener(V.ISSUE_UPDATE,s),()=>{window.removeEventListener(V.ISSUE_UPDATE,s)}},[t._id]);const K=v&&t.author&&v._id===t.author,Q=v?.role==="maintainer",n=K||Q,[o,M]=i.useState({title:t.title,description:t.description,technicalRequirements:"<p>Implement unified OAuth client library</p><p>Create consistent token storage mechanism</p><p>Design user permission management interface</p><p>Develop automated token refresh process</p><p>Ensure GDPR compliance for all data transfers</p>"});i.useEffect(()=>{M({title:t.title,description:t.description,technicalRequirements:o.technicalRequirements})},[t.title,t.description]);const[l,R]=i.useState(!1),[y,b]=i.useState(!1),[$,W]=i.useState(null);i.useEffect(()=>{l&&setTimeout(()=>{R(!1)},2e3)},[l]);const X=()=>{alert("Heyya!")},w={onActivate:()=>{b(!y)},onCancel:()=>{b(!1)},onBlur:(s,a)=>{if(a!==null){const r=a.getHTML();if(o[s]!==r){const z={...o};z[s]=r,M(z),R(!0),U&&U({title:s==="title"?a.getText():void 0,description:s==="description"?a.getText():void 0,technicalRequirements:s==="technicalRequirements"?r:void 0})}}},onFocus:(s,a)=>{W(a)}},Z=e.jsxs("div",{className:"flex flex-col space-y-2 w-full",children:[e.jsxs(N,{onClick:()=>console.log("Liked"),variant:"secondary",size:"sm",className:"h-7 px-2 text-xs w-full",children:[p({iconType:"likes",className:"w-3 h-3 mr-0.5"}),"Like"]}),e.jsxs(N,{variant:"secondary",size:"sm",className:"h-7 px-2 text-xs w-full",children:[p({iconType:"likes",className:"w-3 h-3 mr-0.5"}),"Dislike"]}),e.jsxs(N,{variant:"primary",size:"sm",className:"h-7 px-2 text-xs w-full",children:[p({iconType:"vote-priority",className:"w-3 h-3 mr-0.5"}),"Fund"]})]}),E=" py-0 px-1 h-6 text-sm",T=B?B.map(s=>({...s,className:s.className?s.className+E:E})):[],d=n?{icon:"settings",children:p({iconType:"settings",className:"w-4 h-4"}),onClick:X,className:E}:null;return e.jsxs(ee,{className:`${l&&"cursor-progress"}`,children:[y&&$!==null&&e.jsx(ie,{editor:$,className:"fixed top-0 left-0 right-0 h-28 z-999"}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"w-16 overflow-hidden flex flex-col space-y-2 items-center",children:[e.jsx(se,{uri:t.uri,asNewTab:!1,children:e.jsx(j,{variant:"info",static:!0,children:e.jsxs("div",{className:"flex items-center space-x-1",children:[p("cascadefund"),e.jsx("span",{className:"text-xs font-medium",children:H})]})})}),!h&&Z]}),e.jsxs("div",{className:"flex-1 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(m,{openDelay:2e3,content:e.jsx("div",{className:"text-sm",children:n?"Title is editable for issue owners.":"Issue title"}),children:e.jsxs("h1",{className:"text-xl font-bold text-gray-500 dark:text-slate-100 flex space-x-1 items-center gap-1",children:[n?e.jsx(S,{id:"title",content:o.title||"No title",editable:!l,limit:100,className:"mt-0.5",...w}):e.jsx("div",{className:"mt-1",children:o.title||"No title"}),n?e.jsx(ae,{saving:l,label:"issue"}):e.jsx(j,{variant:"gray",static:!0,children:"Not editable"}),n&&e.jsx(re,{showEditBar:y,setShowEditBar:b})]})}),t.solarForgeTxid&&e.jsx(m,{content:e.jsx("div",{className:"text-sm",children:"View the Solar Forge by this issue on the blockchain explorer"}),children:e.jsx("a",{href:`https://sepolia.basescan.org/tx/${t.solarForgeTxid}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-cyan-400 hover:text-cyan-300 transition-colors",children:e.jsx(I,{className:"w-4 h-4"})})}),e.jsx(j,{variant:h?"success":"gray",static:!0,children:h?"Shining":"Public Backlog"})]}),e.jsx(j,{variant:x==="bug"?"danger":x==="feature"?"blue":x==="improvement"?"success":x==="enhancement"?"warning":"info",static:!0,children:x})]}),e.jsx("div",{className:"text-slate-700 dark:text-slate-200 text-md mb-4 prose max-w-none",children:e.jsx(m,{openDelay:2e3,content:e.jsx("div",{className:"text-sm",children:n?"Description is editable for issue owners.":"Issue description"}),children:n?e.jsx(S,{id:"description",content:o.description||"No description",editable:!l,limit:500,...w}):e.jsx("p",{children:o.description||"No description"})})}),e.jsxs("div",{className:"mb-4 text-slate-600 dark:text-slate-400 text-sm",children:[e.jsx("h3",{className:"text-lg text-slate-700 dark:text-slate-300",children:"Technical Requirements"}),e.jsx(m,{openDelay:2e3,content:e.jsx("div",{className:"text-sm",children:n?"Technical requirements are editable for issue owners.":"Technical requirements"}),children:n?e.jsx(S,{id:"technicalRequirements",content:o.technicalRequirements,editable:!l,limit:1e3,...w}):e.jsx("div",{className:"prose max-w-none",dangerouslySetInnerHTML:{__html:o.technicalRequirements}})})]}),(u||g||f||t.createdTime)&&e.jsxs("div",{className:`flex items-center space-x-1 text-gray-500 gap-1 text-xs mb-2 ${u?"justify-between":"justify-end"}`,children:[u&&g&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"Contributor"}),O?e.jsx("span",{className:"text-xs text-gray-400",children:"Loading..."}):e.jsx(k,{src:u.src,uri:u.uri,className:"w-7! h-7!"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"Maintainer"}),G?e.jsx("span",{className:"text-xs text-gray-400",children:"Loading..."}):e.jsx(k,{src:g.src,uri:g.uri,className:"w-7! h-7!"})]})]}),f&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"By"}),Y?e.jsx("span",{className:"text-xs text-gray-400",children:"Loading..."}):e.jsx(k,{src:f.src,uri:f.uri,className:"w-7! h-7!"}),t.createdTime&&e.jsx(le,{datetime:typeof t.createdTime=="number"?t.createdTime*1e3:t.createdTime})]})})]}),(t.stats||T.length>0||d||t.solarForgeTxid||h&&t.sunshines>0)&&e.jsxs(oe,{className:"flex flex-row justify-between items-center mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[T.length>0&&e.jsx(te,{className:"",actions:T}),d&&e.jsx(m,{openDelay:500,content:e.jsx("div",{className:"text-sm",children:"Edit the issue"}),children:e.jsx(N,{onClick:d.onClick,className:d.className,variant:d.variant,children:d.children})}),t.solarForgeTxid?e.jsx(m,{content:e.jsx("div",{className:"text-sm",children:"View solar forge transaction on blockchain explorer"}),children:e.jsxs("a",{href:`https://sepolia.basescan.org/tx/${t.solarForgeTxid}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-cyan-400 hover:text-cyan-300 transition-colors",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{children:"Solar Forge"})]})}):h&&t.sunshines>0?e.jsx(m,{content:e.jsx("div",{className:"text-sm",children:"Solar forge this issue to convert sunshines to stars"}),children:e.jsxs("span",{className:"text-sm text-slate-500 dark:text-slate-400",children:[e.jsx(I,{className:"w-4 h-4 inline mr-1"}),"Solar Forge"]})}):null]}),t.stats&&Object.values(t.stats).map((s,a)=>e.jsx(ce,{triggerClassName:"text-sm",iconType:ne(s.type),hint:s.hint,fill:s.filled,children:s.children},a.toString()))]})]})]})]})};export{We as default};
