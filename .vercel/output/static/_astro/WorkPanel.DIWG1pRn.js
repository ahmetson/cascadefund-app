import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as l}from"./index.DxhH1ShK.js";import{C as Y}from"./Tabs.uf9ot-DZ.js";import{F as K}from"./FilterableList.CFxci5EV.js";import{I as _}from"./IssueLink.zK6zjZ40.js";import{B as P}from"./Panel.n1yQPIfZ.js";import{I as E,a as s,b as C,i as q,c as z}from"./issue.CJErfNqu.js";import{u as J}from"./useDrag.C9I1mCaR.js";import{g as B}from"./index.B-oIZhPt.js";import{a as Q,d as X}from"./issue.CNzGGm0q.js";import{g as Z}from"./roadmap.oaZTwDY3.js";import{a as ee}from"./patch.CbMO86LR.js";import{C as U}from"./DropTarget.BpRrzabK.js";import{D as y,H as S}from"./index.CeIpCxKj.js";import{D as A,g as O}from"./demo.DsLEr97b.js";import{g as te}from"./user.BVCe9jQZ.js";import"./highlight.B9p-7OBg.js";import"./utils.BnlJtBIq.js";import"./index.CG_O7YBG.js";import"./proxy.D4YeN7SK.js";import"./slot.DPiB-jfz.js";import"./index.CqUFkXl9.js";import"./Button.BGGO0Gl0.js";import"./ripple.CLh-JuST.js";import"./ElectricBorder.DAWLx7iV.js";import"./eventTypes.CfSurkCl.js";import"./SearchBar.BmSZdKeL.js";import"./List.CgTKD_hI.js";import"./Badge.CwoN8wRJ.js";import"./NumberFlow-client-48rw3j0J.DO-Ted3l.js";import"./Link.DQs8_5h1.js";import"./utils.6p6Hyl_a.js";import"./createLucideIcon.C1tpinp8.js";import"./PanelStat.t9y2r0gi.js";import"./Tooltip.Cp89g2lg.js";import"./MenuAvatar.DNnCbCL7.js";import"./timeago-react.CCkgRyVe.js";import"./PanelAction.BT-fj3Wj.js";import"./index.D4qZ0oW6.js";import"./index.lB0MAAV6.js";import"./index.VlIKThXs.js";import"./index.DpebaNh_.js";import"./index.DXWCtkbr.js";import"./index.BI6QXNvC.js";import"./PopoverDescription.BzDXuJpa.js";import"./PopoverTitle.BejME8Dy.js";import"./virtual.VUcB3V37.js";import"./client.B9YBqyHK.js";import"./roadmap.DwIP75iC.js";const se=l.memo(t=>{const m=t.patchable?"patch":"issue",[{opacity:j},v]=J(()=>({type:m,item:{id:t._id,title:t.title},collect:g=>({opacity:g.isDragging()?.4:1})}),[t._id,t.title,m]),b=t.patchable?"border-amber-300/80 hover:border-amber-400 dark:border-amber-400/70 dark:hover:border-amber-300/90":"border-blue-100/50 hover:border-blue-200 dark:border-blue-500/50 dark:hover:border-blue-500/90",f=t.patchable?"bg-amber-50/50 dark:bg-amber-900/20":"bg-transparent";return e.jsx("div",{ref:v,"data-testid":t._id,style:{opacity:j},className:`cursor-move! border-1 ${b} ${f} transition-colors p-2 border-dashed rounded-md`,children:e.jsx(_,{...t,draggable:!0})})}),h=({tabType:t,draggable:m=!1,filterable:j=!1,description:v,galaxyId:b})=>{const[f,g]=l.useState([]),[T,w]=l.useState(!1),[a,x]=l.useState(!0),n=l.useRef(!1),p=l.useRef(!1),[I,F]=l.useState(new Map),D=l.useCallback(async()=>{if(n.current)try{x(!0);const c=(await Q(b,t)).filter(u=>!(u.listHistory||[]).includes(ee));g(c)}catch(r){console.error("Error fetching issues:",r)}finally{x(!1)}},[t,b]);l.useLayoutEffect(()=>{p.current=!1;const r=o=>{p.current=!0;const i=o,d=i.detail.tabType===t&&i.detail.galaxyId===b;n.current=d,w(d)},c=()=>{n.current&&D()},u=o=>{const d=o.detail;if(!d||!n.current)return;const R=(d.listHistory||[]).includes(t);if(t===s.SHINING||t===s.PUBLIC){c();return}g(R?k=>{const L=k.findIndex(H=>H._id===d._id);if(L>=0){const H=[...k];return H[L]=d,H}else return c(),k}:k=>k.filter(L=>L._id!==d._id))};window.addEventListener(E.ISSUES_TAB_CHANGED,r),window.addEventListener(E.ISSUE_CREATED,c),window.addEventListener(E.ISSUE_UNPATCHED,c),window.addEventListener(E.ISSUE_UPDATE,u),t===s.SHINING&&requestAnimationFrame(()=>{p.current||(n.current=!0,w(!0))});const N=setTimeout(()=>{!p.current&&t===s.SHINING&&(n.current=!0,w(!0))},100);return()=>{clearTimeout(N),window.removeEventListener(E.ISSUES_TAB_CHANGED,r),window.removeEventListener(E.ISSUE_CREATED,c),window.removeEventListener(E.ISSUE_UNPATCHED,c),window.removeEventListener(E.ISSUE_UPDATE,u)}},[t,b,D]),l.useEffect(()=>{T?D():(g([]),x(!1))},[T,D]);const M=[{id:"all",label:"All",sortIds:[{id:"priority",label:"Priority"},{id:"date",label:"Date"},{id:"title",label:"Title"}]},{id:C.BUG,label:"Bug",sortIds:[{id:"priority",label:"Priority"},{id:"date",label:"Date"},{id:"title",label:"Title"}]},{id:C.FEATURE,label:"Feature",sortIds:[{id:"priority",label:"Priority"},{id:"date",label:"Date"},{id:"title",label:"Title"}]},{id:C.IMPROVEMENT,label:"Improvement",sortIds:[{id:"priority",label:"Priority"},{id:"date",label:"Date"},{id:"title",label:"Title"}]},{id:C.ENHANCEMENT,label:"Enhancement",sortIds:[{id:"priority",label:"Priority"},{id:"date",label:"Date"},{id:"title",label:"Title"}]},{id:C.WISH,label:"Wish",sortIds:[{id:"priority",label:"Priority"},{id:"date",label:"Date"},{id:"title",label:"Title"}]},{id:C.CUSTOM,label:"Custom",sortIds:[{id:"priority",label:"Priority"},{id:"date",label:"Date"},{id:"title",label:"Title"}]}],V=(r,c)=>{console.log("Filter changed:",{filterId:r,sortId:c})};l.useEffect(()=>{const r=async()=>{const c=new Set;if(f.forEach(u=>{const o=(u.listHistory||[]).find(i=>i.startsWith("version-"));if(o){const i=o.replace("version-","");i&&!I.has(i)&&c.add(i)}}),c.size>0){const u=Array.from(c).map(async o=>{try{const i=await Z(o);if(i)return{versionId:o,version:i}}catch(i){console.error(`Error fetching version ${o}:`,i)}return null}),N=await Promise.all(u);F(o=>{const i=new Map(o);return N.forEach(d=>{d&&i.set(d.versionId,d.version)}),i})}};f.length>0&&r()},[f]);const W=l.useMemo(()=>f.map(r=>{const u=(r.listHistory||[]).find(N=>N.startsWith("version-"));if(u){const N=u.replace("version-",""),o=I.get(N);if(o){const i=o.patches.find(R=>R.id===r._id),d=i?.completed||!1,G=i?.tested||!1;return{...r,draggable:!1,patchable:!1,versionTag:o.tag,versionStatus:o.status,patchCompleted:d,patchTested:G}}}return{...r,draggable:m,patchable:q(r)}}),[m,f,I]),$=r=>r.versionTag?e.jsx(_,{...r}):t===s.CLOSED?e.jsx(_,{...r}):r.patchable||m?e.jsx(se,{...r,patchable:r.patchable,draggable:!0}):e.jsx(_,{...r});return a?e.jsx(P,{className:"max-w-6xl mx-auto max-h-[150vh] overflow-y-auto",children:e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Loading issues..."})})}):e.jsxs(P,{className:"max-w-6xl mx-auto max-h-[150vh] min-h-[50vh] overflow-y-auto",children:[e.jsx("div",{className:"mb-4",children:e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-200 text-center drop-shadow-lg",children:z[t]})}),e.jsxs("div",{className:"mb-4 space-y-2",children:[m&&e.jsxs("p",{className:"text-md text-gray-600 dark:text-gray-500 flex items-center gap-2",children:[B("info")," Issues are draggable. Your dragging will highlight the drop targets."]}),!m&&t===s.CLOSED&&e.jsxs("p",{className:"text-md mb-2 text-gray-600 dark:text-gray-500 flex items-center gap-2",children:[B("lock")," Issues are closed and will never be back."]}),!m&&t!==s.CLOSED&&e.jsxs("p",{className:"text-md mb-2 text-gray-600 dark:text-gray-500 flex items-center gap-2",children:[B("user")," Maintainer can move them."]}),v&&e.jsx("p",{className:"text-md text-gray-600 dark:text-gray-500",children:v})]}),e.jsx(K,{className:"mt-2",items:W,itemComponent:$,title:void 0,titleCenter:!1,searchPlaceholder:"Search issues...",searchableFields:["title","description"],filters:j?M:void 0,onFilterChange:V})]})},Xe=({galaxyId:t})=>{const[,m]=l.useState(null),[j,v]=l.useState(!1),[b,f]=l.useState(s.SHINING);l.useEffect(()=>{const a=async()=>{const n=O();if(n.email&&n.users&&n.role){const p=n.users.find(I=>I.role===n.role)||n.users[0];if(p&&p._id){const I=await te(p._id.toString());I&&(m(I),v(I.role==="maintainer"))}}};a();const x=()=>{a()};return window.addEventListener(A.ROLE_CHANGED,x),()=>{window.removeEventListener(A.ROLE_CHANGED,x)}},[]),l.useEffect(()=>{const a=setTimeout(()=>{g(b)},100);return()=>{clearTimeout(a)}},[b]);const g=a=>{window.dispatchEvent(new CustomEvent(E.ISSUES_TAB_CHANGED,{detail:{tabType:a,galaxyId:t}}))},T=async(a,x)=>{try{const n=O();if(!n.email){console.error("No demo email found");return}if(!await X({issueId:a,email:n.email,listHistory:[x]})){console.error("Failed to update issue");return}}catch(n){console.error("Error changing issue list:",n)}},w=j?[{label:e.jsx(e.Fragment,{children:e.jsx("span",{className:"text-amber-600 dark:text-amber-400 font-semibold",children:"Shining issues"})}),key:s.SHINING,content:e.jsx(y,{backend:S,children:e.jsx(h,{tabType:s.SHINING,draggable:!0,galaxyId:t})}),className:"bg-gradient-to-r from-amber-50 to-yellow-50 dark:from-amber-900/20 dark:to-yellow-900/20"},{label:e.jsx(e.Fragment,{children:"Public Backlog"}),key:s.PUBLIC,content:e.jsx(y,{backend:S,children:e.jsx(h,{tabType:s.PUBLIC,draggable:!0,galaxyId:t})})},{label:e.jsx(y,{backend:S,children:e.jsx(U,{id:s.INTERESTING,accept:["issue","patch"],onDrop:a=>T(a.id,s.INTERESTING),children:"Interesting Issues"})}),key:s.INTERESTING,content:e.jsx(y,{backend:S,children:e.jsx(h,{tabType:s.INTERESTING,draggable:!0,description:"Interesting issues for the maintainer. It could mean anything, but basically its worth maintainer's attention",galaxyId:t})}),className:" p-0!"},{label:e.jsx(y,{backend:S,children:e.jsx(U,{id:s.BORING,accept:["issue","patch"],onDrop:a=>T(a.id,s.BORING),children:"Boring Issues"})}),key:s.BORING,content:e.jsx(y,{backend:S,children:e.jsx(h,{tabType:s.BORING,draggable:!0,description:"Issues that are boring for the maintainer. It could be for any reason, but basically maintainer will not spend time on them.",galaxyId:t})})},{label:e.jsx(y,{backend:S,children:e.jsx(U,{id:s.CLOSED,accept:["issue","patch"],onDrop:a=>T(a.id,s.CLOSED),children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[B({iconType:"lock",className:"w-4 h-4"}),"Closed"]})})}),key:s.CLOSED,content:e.jsx(h,{tabType:s.CLOSED,galaxyId:t})}]:[{label:e.jsx(e.Fragment,{children:e.jsx("span",{className:"text-amber-600 dark:text-amber-400 font-semibold",children:"Shining issues"})}),key:s.SHINING,content:e.jsx(h,{tabType:s.SHINING,draggable:!1,galaxyId:t}),className:"bg-gradient-to-r from-amber-50 to-yellow-50 dark:from-amber-900/20 dark:to-yellow-900/20"},{label:e.jsx(e.Fragment,{children:"Public Backlog"}),key:s.PUBLIC,content:e.jsx(h,{tabType:s.PUBLIC,draggable:!1,galaxyId:t})},{label:e.jsx(e.Fragment,{children:"Interesting Issues"}),key:s.INTERESTING,content:e.jsx(h,{tabType:s.INTERESTING,draggable:!1,description:"Interesting issues for the maintainer. It could mean anything, but basically its worth maintainer's attention",galaxyId:t})},{label:e.jsx(e.Fragment,{children:"Boring Issues"}),key:s.BORING,content:e.jsx(h,{tabType:s.BORING,draggable:!1,description:"Issues that are boring for the maintainer. It could be for any reason, but basically maintainer will not spend time on them.",galaxyId:t})},{label:e.jsx(e.Fragment,{children:"Closed Issues"}),key:s.CLOSED,content:e.jsx(h,{tabType:s.CLOSED,galaxyId:t})}];return e.jsx(Y,{onTabChange:(a=>{f(a)}),activeTab:b,tabs:w})};export{Xe as default};
