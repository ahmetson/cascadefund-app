import{j as i}from"./jsx-runtime.D_zvdyIk.js";import{r as a}from"./index.DxhH1ShK.js";import{c as A}from"./utils.BnlJtBIq.js";import{m as H}from"./proxy.DplwUDe6.js";import{g as V}from"./index.C9GdNTjf.js";import{g as F}from"./demo.DsLEr97b.js";import{i as W,I as D,c as $}from"./issue.CJErfNqu.js";import{a as q}from"./patch.CbMO86LR.js";import{B as Y}from"./Button.CnXYplS9.js";import{C as G}from"./Tooltip.X-wb9Q3Q.js";import{C as K}from"./DropTarget.BRYVv9tN.js";import{D as X,H as J}from"./index.CeIpCxKj.js";import{a as Q,g as Z,p as O,b as ee}from"./issue.CNzGGm0q.js";import"./virtual.VUcB3V37.js";import"./client.B9YBqyHK.js";import"./ripple.CF16UbCB.js";import"./slot.BJ0WR7bA.js";import"./index.CqUFkXl9.js";import"./ElectricBorder.DAWLx7iV.js";import"./eventTypes.CfSurkCl.js";import"./index.BMZ1dBRY.js";function te({strokeColor:w="#737373",numberOfLines:g=50,numberOfDiscs:N=50,particleRGBColor:y=[255,255,255],className:T,children:z,...v}){const I=a.useRef(null),b=a.useRef(0),t=a.useRef({discs:[],lines:[],particles:[],clip:{},startDisc:{},endDisc:{},rect:{width:0,height:0},render:{width:0,height:0,dpi:1},particleArea:{},linesCanvas:null}),j=e=>e,M=e=>e===0?0:Math.pow(2,10*(e-1)),_=a.useCallback((e,r,c,p=null)=>{const n=r-e;return e+n*(p==="inExpo"?M:j)(c)},[]),E=a.useCallback(e=>{const{startDisc:r,endDisc:c}=t.current;e.x=_(r.x,c.x,e.p),e.y=_(r.y,c.y,e.p,"inExpo"),e.w=_(r.w,c.w,e.p),e.h=_(r.h,c.h,e.p)},[_]),s=a.useCallback(()=>{const e=I.current;if(!e)return;const r=e.getBoundingClientRect();t.current.rect={width:r.width,height:r.height},t.current.render={width:r.width,height:r.height,dpi:window.devicePixelRatio||1},e.width=t.current.render.width*t.current.render.dpi,e.height=t.current.render.height*t.current.render.dpi},[]),o=a.useCallback(()=>{const{width:e,height:r}=t.current.rect;if(e<=0||r<=0){t.current.discs=[];return}t.current.discs=[],t.current.startDisc={x:e*.5,y:r*.45,w:e*.75,h:r*.7},t.current.endDisc={x:e*.5,y:r*.95,w:0,h:0};let c=r;t.current.clip={};for(let l=0;l<N;l++){const h={p:l/N,x:0,y:0,w:0,h:0};E(h);const k=h.y+h.h;k<=c&&(t.current.clip={disc:{...h},i:l}),c=k,t.current.discs.push(h)}const p=new Path2D,n=t.current.clip.disc;p.ellipse(n.x,n.y,n.w,n.h,0,0,Math.PI*2),p.rect(n.x-n.w,0,n.w*2,n.y),t.current.clip.path=p},[N,E]),d=a.useCallback(()=>{const{width:e,height:r}=t.current.rect;if(e<=0||r<=0){t.current.linesCanvas=null;return}t.current.lines=[];const c=Math.PI*2/g;for(let l=0;l<g;l++)t.current.lines.push([]);t.current.discs.forEach(l=>{for(let x=0;x<g;x++){const h=x*c,k={x:l.x+Math.cos(h)*l.w,y:l.y+Math.sin(h)*l.h};t.current.lines[x].push(k)}});const p=document.createElement("canvas");p.width=e,p.height=r;const n=p.getContext("2d");n&&(t.current.lines.forEach(l=>{n.save();let x=!1;l.forEach((h,k)=>{if(k===0)return;const B=l[k-1];!x&&(n.isPointInPath(t.current.clip.path,h.x,h.y)||n.isPointInStroke(t.current.clip.path,h.x,h.y))?x=!0:x&&n.clip(t.current.clip.path),n.beginPath(),n.moveTo(B.x,B.y),n.lineTo(h.x,h.y),n.strokeStyle=w,n.lineWidth=2,n.stroke(),n.closePath()}),n.restore()}),t.current.linesCanvas=p)},[g,w]),m=a.useCallback((e=!1)=>{const r=t.current.particleArea.sx+t.current.particleArea.sw*Math.random(),p=t.current.particleArea.ex+t.current.particleArea.ew*Math.random()-r,n=e?t.current.particleArea.h*Math.random():t.current.particleArea.h,l=.5+Math.random()*4,x=.5+Math.random();return{x:r,sx:r,dx:p,y:n,vy:x,p:0,r:l,c:`rgba(${y[0]}, ${y[1]}, ${y[2]}, ${Math.random()})`}},[y]),u=a.useCallback(()=>{const{width:e,height:r}=t.current.rect;if(e<=0||r<=0){t.current.particles=[];return}t.current.particles=[];const c=t.current.clip.disc;t.current.particleArea={sw:c.w*.5,ew:c.w*2,h:r*.85},t.current.particleArea.sx=(e-t.current.particleArea.sw)/2,t.current.particleArea.ex=(e-t.current.particleArea.ew)/2;const p=100;for(let n=0;n<p;n++)t.current.particles.push(m(!0))},[m]),f=a.useCallback(e=>{e.strokeStyle=w,e.lineWidth=2;const r=t.current.startDisc;e.beginPath(),e.ellipse(r.x,r.y,r.w,r.h,0,0,Math.PI*2),e.stroke(),e.closePath(),t.current.discs.forEach((c,p)=>{p%5===0&&(c.w<t.current.clip.disc.w-5&&(e.save(),e.clip(t.current.clip.path)),e.beginPath(),e.ellipse(c.x,c.y,c.w,c.h,0,0,Math.PI*2),e.stroke(),e.closePath(),c.w<t.current.clip.disc.w-5&&e.restore())})},[w]),P=a.useCallback(e=>{const r=t.current.linesCanvas;r&&r.width>0&&r.height>0&&e.drawImage(r,0,0)},[]),C=a.useCallback(e=>{e.save(),e.clip(t.current.clip.path),t.current.particles.forEach(r=>{e.fillStyle=r.c,e.beginPath(),e.rect(r.x,r.y,r.r,r.r),e.closePath(),e.fill()}),e.restore()},[]),R=a.useCallback(()=>{t.current.discs.forEach(e=>{e.p=(e.p+.001)%1,E(e)})},[E]),U=a.useCallback(()=>{t.current.particles.forEach((e,r)=>{e.p=1-e.y/t.current.particleArea.h,e.x=e.sx+e.dx*e.p,e.y-=e.vy,e.y<0&&(t.current.particles[r]=m())})},[m]),S=a.useCallback(()=>{const e=I.current;if(!e)return;const r=e.getContext("2d");if(r){if(e.width<=0||e.height<=0){b.current=requestAnimationFrame(S);return}r.clearRect(0,0,e.width,e.height),r.save(),r.scale(t.current.render.dpi,t.current.render.dpi),R(),U(),f(r),P(r),C(r),r.restore(),b.current=requestAnimationFrame(S)}},[R,U,f,P,C]),L=a.useCallback(()=>{s(),o(),d(),u()},[s,o,d,u]);return a.useEffect(()=>{if(!I.current)return;L(),S();const r=()=>{s(),o(),d(),u()};return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r),cancelAnimationFrame(b.current)}},[L,S,s,o,d,u]),i.jsxs("div",{"data-slot":"hole-background",className:A("relative size-full overflow-hidden",'before:content-[""] before:absolute before:top-1/2 before:left-1/2 before:block before:size-[140%] dark:before:[background:radial-gradient(ellipse_at_50%_55%,transparent_10%,black_50%)] before:[background:radial-gradient(ellipse_at_50%_55%,transparent_10%,white_50%)] before:[transform:translate3d(-50%,-50%,0)]','after:content-[""] after:absolute after:z-[5] after:top-1/2 after:left-1/2 after:block after:size-full after:[background:radial-gradient(ellipse_at_50%_75%,#a900ff_20%,transparent_75%)] after:[transform:translate3d(-50%,-50%,0)] after:mix-blend-overlay',T),...v,children:[i.jsx("div",{"aria-hidden":!0,className:A("absolute inset-0 z-0 pointer-events-none","[background-size:20px_20px]","[background-image:linear-gradient(to_right,#e4e4e7_1px,transparent_1px),linear-gradient(to_bottom,#e4e4e7_1px,transparent_1px)]","dark:[background-image:linear-gradient(to_right,#262626_1px,transparent_1px),linear-gradient(to_bottom,#262626_1px,transparent_1px)]","opacity-50 dark:opacity-40","[mask-image:radial-gradient(ellipse_at_center,transparent_10%,black_80%)]")}),i.jsx("div",{"aria-hidden":!0,className:A("absolute inset-0 z-[1] pointer-events-none","[background-size:20px_20px]","[background-image:linear-gradient(to_right,#e4e4e7_1px,transparent_1px),linear-gradient(to_bottom,#e4e4e7_1px,transparent_1px)]","dark:[background-image:linear-gradient(to_right,#262626_1px,transparent_1px),linear-gradient(to_bottom,#262626_1px,transparent_1px)]","opacity-65 dark:opacity-55","mix-blend-multiply dark:mix-blend-screen"),style:{transform:"perspective(900px) rotateX(72deg) scale(1.05)",transformOrigin:"50% 40%",maskImage:"radial-gradient(ellipse at 50% 55%, black 35%, transparent 75%)",WebkitMaskImage:"radial-gradient(ellipse at 50% 55%, black 35%, transparent 75%)",filter:"blur(0.6px)"}}),z,i.jsx("canvas",{ref:I,className:"absolute inset-0 block size-full dark:opacity-20 opacity-10"}),i.jsx(H.div,{className:A("absolute top-[-71.5%] left-1/2 z-[3] w-[30%] h-[140%] rounded-b-full blur-3xl opacity-75 dark:mix-blend-plus-lighter mix-blend-plus-darker [transform:translate3d(-50%,0,0)] [background-position:0%_100%] [background-size:100%_200%]","dark:[background:linear-gradient(20deg,#00f8f1,#ffbd1e20_16.5%,#fe848f_33%,#fe848f20_49.5%,#00f8f1_66%,#00f8f160_85.5%,#ffbd1e_100%)_0_100%_/_100%_200%] [background:linear-gradient(20deg,#00f8f1,#ffbd1e40_16.5%,#fe848f_33%,#fe848f40_49.5%,#00f8f1_66%,#00f8f180_85.5%,#ffbd1e_100%)_0_100%_/_100%_200%]"),animate:{backgroundPosition:"0% 300%"},transition:{duration:5,ease:"linear",repeat:1/0}}),i.jsx("div",{className:"absolute top-0 left-0 z-[7] size-full dark:[background:repeating-linear-gradient(transparent,transparent_1px,white_1px,white_2px)] mix-blend-overlay opacity-50"})]})}const re=()=>{const[w,g]=a.useState([]),[N,y]=a.useState(!1),[T,z]=a.useState(""),[v,I]=a.useState(void 0),b=a.useRef(""),t=a.useRef(void 0),j=a.useCallback(async(s,o)=>{const d=s||t.current,m=o||b.current;if(!(!d||!m))try{const u=await Q(m,d),f=u.filter(C=>C.listHistory?.includes(q)),P=u.some(C=>W(C));y(f.length>0||P),g(f)}catch(u){console.error("Error fetching patched issues:",u)}},[]);a.useLayoutEffect(()=>{const s=async d=>{const m=d,u=m.detail.tabType,f=m.detail.galaxyId;t.current=u,b.current=f,I(u),b.current!==f&&z(f),await j(u,f)},o=async()=>{await j(t.current,b.current)};return window.addEventListener(D.ISSUES_TAB_CHANGED,s),window.addEventListener(D.ISSUE_UPDATE,o),requestAnimationFrame(()=>{}),()=>{window.removeEventListener(D.ISSUES_TAB_CHANGED,s),window.removeEventListener(D.ISSUE_UPDATE,o)}},[j]),a.useEffect(()=>{b.current=T},[T]),a.useEffect(()=>{t.current=v},[v]);const M=a.useCallback(async s=>{const o=F();if(!o.email){console.error("No email found in demo");return}try{const d=await Z(s.id);if(!d){console.error("Issue not found");return}if(await O({issueId:s.id,email:o.email})){const u={...d,originalListTitle:"Unknown"};g(f=>f.some(P=>P._id===s.id)?f:[...f,u])}}catch(d){console.error("Error patching issue:",d)}},[]),_=a.useCallback(async s=>{const o=F();if(!o.email){console.error("No email found in demo");return}try{await ee({issueId:s._id,email:o.email})&&g(m=>m.filter(u=>u._id!==s._id))}catch(d){console.error("Error unpatching issue:",d)}},[]),E=(s,o=58)=>s.length<=o?s:s.substring(0,o)+"...";return i.jsx(H.div,{className:A("fixed right-4 top-1/2 -translate-y-1/2 z-20 w-80","pointer-events-auto",N?"visible":"invisible"),children:i.jsx("div",{className:"relative h-full min-h-[400px]",children:i.jsxs(te,{className:"w-full h-[400px]",children:[i.jsxs("div",{className:"absolute top-16 left-1/2 -translate-x-1/2 z-30 flex flex-col items-center gap-2",children:[i.jsx("h2",{className:"w-[300px] text-center text-2xl font-semibold text-slate-700 dark:text-slate-200 shadow-2xl",children:v?$[v]:"Issues"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("h2",{className:"text-xl font-semibold text-slate-700 dark:text-slate-200 shadow-2xl",children:"Patcher"}),i.jsx(G,{content:"Issues with contributors and maintainers can be converted into patches here.",children:V({iconType:"info",className:"w-6 h-6 text-slate-600 dark:text-slate-300",fill:"none"})})]})]}),i.jsx("div",{className:"absolute top-30 left-1/2 -translate-x-1/2 z-30 flex items-center justify-center w-36 h-48 rounded-full shadow-lg overflow-hidden",children:i.jsx(K,{id:"patcher-drop",accept:["patch"],onDrop:M,className:"w-full h-full",roundedClassName:"rounded-full",innerClassName:"rounded-full"})}),i.jsxs("div",{className:"absolute bottom-0 left-0 right-0 z-30 p-4 space-y-2 max-h-[200px] overflow-y-auto",children:[i.jsx("div",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Patches"}),w.length===0?i.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 text-center py-4",children:"No patches yet. Drag patchable issues here."}):w.map(s=>i.jsxs("div",{className:"flex items-center justify-between gap-2 p-2 bg-slate-100/50 dark:bg-slate-800/50 rounded-md border border-slate-200 dark:border-slate-700",children:[i.jsx("span",{className:"text-xs text-slate-700 dark:text-slate-300 flex-1 truncate",children:E(s.title)}),i.jsx(Y,{variant:"secondary",className:"h-6 px-2 text-xs",onClick:()=>_(s),children:"Cancel"})]},s._id))]})]})})})},Ie=({})=>i.jsx(X,{backend:J,children:i.jsx(re,{})});export{Ie as default};
