import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as a}from"./index.DxhH1ShK.js";import{B as j}from"./Button.BGGO0Gl0.js";import{S as H,a as m}from"./ScrollStack.BC0PwliQ.js";import{B as z}from"./Badge.CwoN8wRJ.js";import{R as _,T as P,a as q,b as K}from"./index.lB0MAAV6.js";import{b as d,I as O}from"./issue.CJErfNqu.js";import{g as S}from"./demo.DsLEr97b.js";import{c as W}from"./issue.CNzGGm0q.js";import{g as G}from"./user.BVCe9jQZ.js";import{N as E}from"./NumberFlow-client-48rw3j0J.DO-Ted3l.js";import{c as T}from"./utils.BnlJtBIq.js";import{D as V}from"./DemoAuthPanel.FY41zhzw.js";import"./ripple.CLh-JuST.js";import"./slot.DPiB-jfz.js";import"./index.CqUFkXl9.js";import"./proxy.D4YeN7SK.js";import"./ElectricBorder.DAWLx7iV.js";import"./eventTypes.CfSurkCl.js";import"./index.VlIKThXs.js";import"./index.DpebaNh_.js";import"./index.DXWCtkbr.js";import"./index.BI6QXNvC.js";import"./virtual.VUcB3V37.js";import"./client.B9YBqyHK.js";const Y=({galaxyId:g,onSuccess:p,onCancel:i})=>{const[n,k]=a.useState(""),[b,C]=a.useState(""),[c,I]=a.useState([]),[f,A]=a.useState(0),[v,L]=a.useState(0),[w,h]=a.useState(!1),[D,R]=a.useState(!0),[y,U]=a.useState(0),u=a.useRef(null),o=a.useRef([]),F=a.useRef(null);a.useEffect(()=>{(async()=>{try{const s=S();if(s.email&&s.users){const r=s.users.find(l=>l.role==="user")||s.users[0];if(r&&r._id){const l=await G(r._id.toString());l&&L(l.sunshines||0)}}}catch(s){console.error("Error fetching user sunshines:",s)}finally{R(!1)}})()},[]);const M=e=>{I(s=>s.includes(e)?s.filter(r=>r!==e):[...s,e])},x=a.useCallback(()=>{if(o.current.length===0||!u.current)return;const e=Math.min(y+1,o.current.length-1),s=o.current[e];if(s&&u.current){const r=u.current.querySelector(".scroll-stack-inner");if(r){const l=s.offsetTop-r.offsetTop;r.scrollTo({top:l-100,behavior:"smooth"}),U(e)}}},[y]);a.useEffect(()=>{const e=s=>{s.target instanceof HTMLTextAreaElement&&s.key==="Enter"&&s.shiftKey||(s.key==="Enter"||s.key==="Tab")&&(s.key==="Tab"&&!(s.target instanceof HTMLInputElement||s.target instanceof HTMLTextAreaElement)&&s.preventDefault(),s.key==="Enter"&&(s.target instanceof HTMLInputElement||s.target instanceof HTMLTextAreaElement)&&(s.preventDefault(),x()))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[x]),a.useEffect(()=>{const e=u.current?.querySelector(".scroll-stack-inner");if(!e)return;const s=()=>{};let r;const l=()=>{r=requestAnimationFrame(l)};return e.addEventListener("scroll",()=>{r||(r=requestAnimationFrame(l))}),()=>{r&&cancelAnimationFrame(r),e.removeEventListener("scroll",s)}},[]);const B=async()=>{if(!n.trim()||!b.trim()||c.length===0){alert("Please fill in all required fields (title, description, and at least one tag)");return}h(!0);try{const e=S();if(!e.email||!e.users){alert("Please log in to create an issue"),h(!1);return}const s=e.users.find(l=>l.role==="user")||e.users[0];if(!s||!s._id){alert("User not found"),h(!1);return}await W({galaxyId:g,userId:s._id.toString(),email:e.email,title:n.trim(),description:b.trim(),tags:c,sunshines:f})?p?.():alert("Failed to create issue")}catch(e){console.error("Error creating issue:",e),alert("An error occurred while creating the issue")}finally{h(!1)}},N=[{value:d.BUG,label:"Bug"},{value:d.FEATURE,label:"Feature"},{value:d.IMPROVEMENT,label:"Improvement"},{value:d.ENHANCEMENT,label:"Enhancement"},{value:d.WISH,label:"Wish"},{value:d.CUSTOM,label:"Custom"}];return t.jsxs("div",{className:"fixed inset-0 z-50 pointer-events-none",children:[i&&t.jsx("button",{onClick:i,className:"fixed top-16 right-16 z-50 pointer-events-auto w-10 h-10 rounded-sm bg-white/90 dark:bg-slate-950/95 backdrop-blur-md border border-slate-200/50 dark:border-slate-800/50 shadow-lg flex items-center justify-center text-slate-500 hover:text-slate-700 dark:hover:text-slate-200 transition-all hover:scale-110",children:"âœ•"}),t.jsx("div",{ref:u,className:"absolute bottom-0 left-0 right-0 h-[80vh] pointer-events-auto",children:t.jsxs(H,{useWindowScroll:!1,className:"h-full",children:[t.jsx(m,{itemClassName:"bg-white/5 dark:bg-slate-900/10 backdrop-blur-md border border-white/10 dark:border-slate-700/20 transition-all duration-300",children:t.jsxs("div",{ref:e=>{o.current[0]=e},className:"space-y-4",children:[t.jsx("label",{className:"block text-lg font-semibold text-slate-700 dark:text-slate-300",children:"Issue Title *"}),t.jsx("input",{ref:F,type:"text",value:n,onChange:e=>k(e.target.value),onKeyDown:e=>{e.key==="Enter"&&(e.preventDefault(),x())},placeholder:"Enter a clear, descriptive title...",className:"w-full text-lg px-3 py-2 border border-gray-300/50 dark:border-slate-700/50 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/30 dark:bg-slate-900/40 backdrop-blur-md"})]})}),t.jsx(m,{itemClassName:"bg-white/5 dark:bg-slate-900/10 backdrop-blur-md border border-white/10 dark:border-slate-700/20 transition-all duration-300",children:t.jsxs("div",{ref:e=>{o.current[1]=e},className:"space-y-4",children:[t.jsx("label",{className:"block text-lg font-semibold text-slate-700 dark:text-slate-300",children:"Description *"}),t.jsx("textarea",{value:b,onChange:e=>C(e.target.value),onKeyDown:e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),x())},placeholder:"Describe the issue in detail...",rows:6,className:"w-full px-3 py-2 border border-gray-300/50 dark:border-slate-700/50 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-cascade-blue focus:border-cascade-blue bg-white/30 dark:bg-slate-900/40 backdrop-blur-md resize-none"})]})}),t.jsx(m,{itemClassName:"bg-white/5 dark:bg-slate-900/10 backdrop-blur-md border border-white/10 dark:border-slate-700/20 transition-all duration-300",children:t.jsxs("div",{ref:e=>{o.current[2]=e},className:"space-y-4",children:[t.jsx("label",{className:"block text-lg font-semibold text-slate-700 dark:text-slate-300",children:"Tags * (Select at least one)"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(e=>t.jsx("button",{onClick:()=>M(e.value),className:T("px-4 py-2 rounded-lg transition-all backdrop-blur-sm",c.includes(e.value)?"bg-blue-500/90 text-white":"bg-slate-200/80 dark:bg-slate-800/80 text-slate-700 dark:text-slate-200 hover:bg-slate-300/90 dark:hover:bg-slate-700/90"),children:e.label},e.value))}),c.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:c.map(e=>t.jsx(z,{variant:"info",children:N.find(s=>s.value===e)?.label},e))})]})}),t.jsx(m,{itemClassName:"bg-white/5 dark:bg-slate-900/10 backdrop-blur-md border border-white/10 dark:border-slate-700/20 transition-all duration-300",children:t.jsx("div",{ref:e=>{o.current[4]=e},className:"space-y-6",children:t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"Allocate Sunshines (Optional)"}),D?t.jsx("p",{className:"text-slate-500",children:"Loading..."}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm text-slate-600 dark:text-slate-400",children:[t.jsx("span",{children:"Available Sunshines:"}),t.jsx("span",{className:"font-semibold",children:t.jsx(E,{value:v,locales:"en-US",format:{useGrouping:!0}})})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm text-slate-600 dark:text-slate-400",children:[t.jsx("span",{children:"Allocating:"}),t.jsx("span",{className:"font-semibold text-blue-600 dark:text-blue-400",children:t.jsx(E,{value:f,locales:"en-US",format:{useGrouping:!0}})})]}),t.jsxs(_,{value:[f],onValueChange:e=>A(e[0]),max:v,min:0,step:1,disabled:v===0,className:"relative flex h-5 w-full touch-none select-none items-center",children:[t.jsx(P,{className:"relative h-2 grow rounded-full bg-slate-200/80 dark:bg-slate-800/80 backdrop-blur-sm",children:t.jsx(q,{className:"absolute h-full rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 transition-all duration-100"})}),t.jsx(K,{className:"relative block h-5 w-5 rounded-full bg-yellow-400 dark:bg-yellow-500 shadow-md ring-2 ring-yellow-300 dark:ring-yellow-600 transition-all focus:outline-none focus:ring-2 focus:ring-yellow-500"})]}),t.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:f>0?"Issue will be added to Shining Issues":"Issue will be added to Public Backlog"})]})]})})}),t.jsx(m,{itemClassName:"bg-white/5 dark:bg-slate-900/10 backdrop-blur-md border border-white/10 dark:border-slate-700/20 transition-all duration-300",children:t.jsxs("div",{ref:e=>{o.current[5]=e},className:"flex flex-col items-center gap-4",children:[t.jsx(j,{variant:"primary",size:"lg",onClick:B,disabled:w||!n.trim()||!b.trim()||c.length===0,className:"w-full max-w-md backdrop-blur-sm",children:w?"Creating Issue...":"Create Issue"}),i&&t.jsx(j,{variant:"secondary",size:"md",onClick:i,disabled:w,className:"backdrop-blur-sm",children:"Cancel"})]})})]})})]})},ve=({galaxyId:g,onIssueCreated:p})=>{const[i,n]=a.useState(!1),k=()=>{n(!1),setTimeout(()=>{p?.(),window.dispatchEvent(new CustomEvent(O.ISSUE_CREATED))},500)};return t.jsxs(t.Fragment,{children:[t.jsx(V,{children:t.jsx("div",{className:T("fixed bottom-4 right-1/2 translate-x-1/2 z-40","backdrop-blur-md bg-white/90 dark:bg-slate-900/90","border border-slate-200/50 dark:border-slate-700/50","rounded-lg shadow-lg","transition-all duration-300","hover:shadow-xl hover:scale-105"),children:t.jsxs(j,{variant:"primary",outline:!0,size:"lg",onClick:()=>n(!0),className:"px-6 py-3 flex items-center gap-2",children:[t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),t.jsx("span",{children:"Create Issue"})]})})}),i&&t.jsx(Y,{galaxyId:g,onSuccess:k,onCancel:()=>n(!1)})]})};export{ve as default};
