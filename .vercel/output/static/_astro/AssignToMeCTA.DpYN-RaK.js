import{j as r}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.DxhH1ShK.js";import{B as k}from"./Button.BGGO0Gl0.js";import{C}from"./Tooltip.Cp89g2lg.js";import{M as S}from"./MenuAvatar.DNnCbCL7.js";import{D as U}from"./DemoAuthPanel.FY41zhzw.js";import{g as m}from"./demo.DsLEr97b.js";import{g as p}from"./user.BVCe9jQZ.js";import{g as L,u as A,s as N}from"./issue.CNzGGm0q.js";import{c as I}from"./utils.BnlJtBIq.js";import{I as x}from"./issue.CJErfNqu.js";import"./ripple.CLh-JuST.js";import"./slot.DPiB-jfz.js";import"./index.CqUFkXl9.js";import"./proxy.D4YeN7SK.js";import"./ElectricBorder.DAWLx7iV.js";import"./eventTypes.CfSurkCl.js";import"./index.CG_O7YBG.js";import"./Link.DQs8_5h1.js";import"./NumberFlow-client-48rw3j0J.DO-Ted3l.js";import"./index.B-oIZhPt.js";import"./virtual.VUcB3V37.js";import"./client.B9YBqyHK.js";const et=({issueId:n})=>{const[b,y]=s.useState(!1),[c,a]=s.useState(!1),[u,j]=s.useState(null),[l,f]=s.useState(null),[d,g]=s.useState(null),[E,h]=s.useState(!1);s.useEffect(()=>{(async()=>{const t=await L(n);t&&f(t)})()},[n]),s.useEffect(()=>{(async()=>{const t=m();if(t.email&&t.users&&t.role){const o=t.users.find(i=>i.role===t.role)||t.users[0];if(o&&o._id){const i=await p(o._id.toString());i&&(j(i),y(i.role==="maintainer"))}}})()},[]),s.useEffect(()=>{l?.contributor&&typeof l.contributor=="string"?(h(!0),p(l.contributor).then(e=>{e&&g(e)}).catch(e=>{console.error("Error fetching contributor:",e)}).finally(()=>{h(!1)})):g(null)},[l?.contributor]),s.useEffect(()=>{const e=t=>{const o=t;o.detail&&o.detail._id===n&&f(o.detail)};return window.addEventListener(x.ISSUE_UPDATE,e),()=>{window.removeEventListener(x.ISSUE_UPDATE,e)}},[n]);const v=async()=>{if(!u||!u._id){alert("User not found");return}const e=m();if(!e.email){alert("Please log in to assign contributor");return}a(!0);try{await N({issueId:n,userId:u._id.toString(),email:e.email})||alert("Failed to assign contributor")}catch(t){console.error("Error assigning contributor:",t),alert("An error occurred while assigning contributor")}finally{a(!1)}},w=async()=>{const e=m();if(!e.email){alert("Please log in to unset contributor");return}a(!0);try{await A({issueId:n,email:e.email})||alert("Failed to unset contributor")}catch(t){console.error("Error unsetting contributor:",t),alert("An error occurred while unsetting contributor")}finally{a(!1)}};return b?r.jsx(U,{children:r.jsx("div",{className:I("fixed bottom-4 right-1/2 translate-x-1/2 z-40","backdrop-blur-md bg-white/90 dark:bg-slate-900/90","border border-slate-200/50 dark:border-slate-700/50","rounded-lg shadow-lg","transition-all duration-300","hover:shadow-xl hover:scale-105"),children:d?r.jsxs("div",{className:"flex items-center gap-2 px-4 py-3",children:[r.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Contributor"}),E?r.jsx("span",{className:"text-xs text-gray-400",children:"Loading..."}):r.jsx(S,{src:d.src,uri:d.uri,className:"w-6! h-6!"}),r.jsx(C,{openDelay:500,content:r.jsx("div",{className:"text-sm",children:"Cancel the contributor"}),children:r.jsx("button",{onClick:w,disabled:c,className:"w-5 h-5 flex items-center justify-center rounded hover:bg-slate-200 dark:hover:bg-slate-700 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition-colors disabled:opacity-50","aria-label":"Cancel the contributor",children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]}):r.jsxs(k,{variant:"primary",outline:!0,size:"lg",onClick:v,disabled:c,className:"px-6 py-3 flex items-center gap-2",children:[r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),r.jsx("span",{children:c?"Assigning...":"Assign To Me"})]})})}):null};export{et as default};
