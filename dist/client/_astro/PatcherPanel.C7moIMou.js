import{j as n}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.DxhH1ShK.js";import{c as k,t as q}from"./utils.Lr0IsqiS.js";import{m as $}from"./proxy.D4YeN7SK.js";import{g as W}from"./icon.DFuhwfpy.js";import{a as V,P as D}from"./patch.CbMO86LR.js";import{C as B}from"./Tooltip.BWGh4r1w.js";import{D as Y,H as K}from"./index.CeIpCxKj.js";import{N as U}from"./NumberFlow-client-48rw3j0J.DO-Ted3l.js";import{C as X}from"./DropTarget.DZsHsBzm.js";import{g as J}from"./demo.CHhf2w8G.js";import{a as Q,g as Z,d as O}from"./issue.Cu6yhr5C.js";import{r as G}from"./roadmap.Cq_m8jGZ.js";import{u as ee}from"./useDrag.C9I1mCaR.js";import"./clsx.B-dksMZM.js";import"./index.C2SuE_cr.js";import"./index.CqUFkXl9.js";import"./slot.Dc8ja7ZA.js";import"./index.CG_O7YBG.js";import"./ElectricBorder.BANsXwQj.js";import"./Button.CuXyr_i0.js";import"./ripple.MQee5g1d.js";import"./eventTypes.j192VUKf.js";import"./virtual.VUcB3V37.js";import"./client.B9YBqyHK.js";import"./issue.CJErfNqu.js";import"./star.J0JRTi5O.js";import"./roadmap.DwIP75iC.js";function te({strokeColor:f="#737373",numberOfLines:m=50,numberOfDiscs:y=50,particleRGBColor:b=[255,255,255],className:E,children:h,...z}){const x=i.useRef(null),s=i.useRef(0),t=i.useRef({discs:[],lines:[],particles:[],clip:{},startDisc:{},endDisc:{},rect:{width:0,height:0},render:{width:0,height:0,dpi:1},particleArea:{},linesCanvas:null}),u=e=>e,C=e=>e===0?0:Math.pow(2,10*(e-1)),w=i.useCallback((e,r,o,l=null)=>{const a=r-e;return e+a*(l==="inExpo"?C:u)(o)},[]),_=i.useCallback(e=>{const{startDisc:r,endDisc:o}=t.current;e.x=w(r.x,o.x,e.p),e.y=w(r.y,o.y,e.p,"inExpo"),e.w=w(r.w,o.w,e.p),e.h=w(r.h,o.h,e.p)},[w]),P=i.useCallback(()=>{const e=x.current;if(!e)return;const r=e.getBoundingClientRect();t.current.rect={width:r.width,height:r.height},t.current.render={width:r.width,height:r.height,dpi:window.devicePixelRatio||1},e.width=t.current.render.width*t.current.render.dpi,e.height=t.current.render.height*t.current.render.dpi},[]),v=i.useCallback(()=>{const{width:e,height:r}=t.current.rect;if(e<=0||r<=0){t.current.discs=[];return}t.current.discs=[],t.current.startDisc={x:e*.5,y:r*.95,w:0,h:0},t.current.endDisc={x:e*.5,y:r*.45,w:e*.75,h:r*.7};let o=r;t.current.clip={};for(let c=0;c<y;c++){const d={p:c/y,x:0,y:0,w:0,h:0};_(d);const g=d.y+d.h;g<=o&&(t.current.clip={disc:{...d},i:c}),o=g,t.current.discs.push(d)}const l=new Path2D,a=t.current.clip.disc;l.ellipse(a.x,a.y,a.w,a.h,0,0,Math.PI*2),l.rect(a.x-a.w,0,a.w*2,a.y),t.current.clip.path=l},[y,_]),I=i.useCallback(()=>{const{width:e,height:r}=t.current.rect;if(e<=0||r<=0){t.current.linesCanvas=null;return}t.current.lines=[];const o=Math.PI*2/m;for(let c=0;c<m;c++)t.current.lines.push([]);t.current.discs.forEach(c=>{for(let p=0;p<m;p++){const d=p*o,g={x:c.x+Math.cos(d)*c.w,y:c.y+Math.sin(d)*c.h};t.current.lines[p].push(g)}});const l=document.createElement("canvas");l.width=e,l.height=r;const a=l.getContext("2d");a&&(t.current.lines.forEach(c=>{a.save();let p=!1;c.forEach((d,g)=>{if(g===0)return;const F=c[g-1];!p&&(a.isPointInPath(t.current.clip.path,d.x,d.y)||a.isPointInStroke(t.current.clip.path,d.x,d.y))?p=!0:p&&a.clip(t.current.clip.path),a.beginPath(),a.moveTo(F.x,F.y),a.lineTo(d.x,d.y),a.strokeStyle=f,a.lineWidth=2,a.stroke(),a.closePath()}),a.restore()}),t.current.linesCanvas=l)},[m,f]),N=i.useCallback((e=!1)=>{const r=t.current.particleArea.sx+t.current.particleArea.sw*Math.random(),l=t.current.particleArea.ex+t.current.particleArea.ew*Math.random()-r,a=e?t.current.particleArea.h*Math.random():0,c=.5+Math.random()*4,p=.5+Math.random();return{x:r,sx:r,dx:l,y:a,vy:p,p:0,r:c,c:`rgba(${b[0]}, ${b[1]}, ${b[2]}, ${Math.random()})`}},[b]),j=i.useCallback(()=>{const{width:e,height:r}=t.current.rect;if(e<=0||r<=0){t.current.particles=[];return}t.current.particles=[];const o=t.current.clip.disc;t.current.particleArea={sw:o.w*.5,ew:o.w*2,h:r*.85},t.current.particleArea.sx=(e-t.current.particleArea.sw)/2,t.current.particleArea.ex=(e-t.current.particleArea.ew)/2;const l=100;for(let a=0;a<l;a++)t.current.particles.push(N(!0))},[N]),M=i.useCallback(e=>{e.strokeStyle=f,e.lineWidth=2;const r=t.current.endDisc;e.beginPath(),e.ellipse(r.x,r.y,r.w,r.h,0,0,Math.PI*2),e.stroke(),e.closePath(),t.current.discs.forEach((o,l)=>{l%5===0&&(o.w<t.current.clip.disc.w-5&&(e.save(),e.clip(t.current.clip.path)),e.beginPath(),e.ellipse(o.x,o.y,o.w,o.h,0,0,Math.PI*2),e.stroke(),e.closePath(),o.w<t.current.clip.disc.w-5&&e.restore())})},[f]),H=i.useCallback(e=>{const r=t.current.linesCanvas;r&&r.width>0&&r.height>0&&e.drawImage(r,0,0)},[]),R=i.useCallback(e=>{e.save(),e.clip(t.current.clip.path),t.current.particles.forEach(r=>{e.fillStyle=r.c,e.beginPath(),e.rect(r.x,r.y,r.r,r.r),e.closePath(),e.fill()}),e.restore()},[]),T=i.useCallback(()=>{t.current.discs.forEach(e=>{e.p=(e.p-.001+1)%1,_(e)})},[_]),L=i.useCallback(()=>{t.current.particles.forEach((e,r)=>{e.p=1-e.y/t.current.particleArea.h,e.x=e.sx+e.dx*e.p,e.y+=e.vy,e.y>t.current.particleArea.h&&(t.current.particles[r]=N())})},[N]),A=i.useCallback(()=>{const e=x.current;if(!e)return;const r=e.getContext("2d");if(r){if(e.width<=0||e.height<=0){s.current=requestAnimationFrame(A);return}r.clearRect(0,0,e.width,e.height),r.save(),r.scale(t.current.render.dpi,t.current.render.dpi),T(),L(),M(r),H(r),R(r),r.restore(),s.current=requestAnimationFrame(A)}},[T,L,M,H,R]),S=i.useCallback(()=>{P(),v(),I(),j()},[P,v,I,j]);return i.useEffect(()=>{if(!x.current)return;S(),A();const r=()=>{P(),v(),I(),j()};return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r),cancelAnimationFrame(s.current)}},[S,A,P,v,I,j]),n.jsxs("div",{"data-slot":"reversed-hole-background",className:k("relative size-full overflow-hidden",'before:content-[""] before:absolute before:top-1/2 before:left-1/2 before:block before:size-[140%] dark:before:[background:radial-gradient(ellipse_at_50%_45%,transparent_10%,black_50%)] before:[background:radial-gradient(ellipse_at_50%_45%,transparent_10%,white_50%)] before:[transform:translate3d(-50%,-50%,0)]','after:content-[""] after:absolute after:z-[5] after:top-1/2 after:left-1/2 after:block after:size-full after:[background:radial-gradient(ellipse_at_50%_25%,#a900ff_20%,transparent_75%)] after:[transform:translate3d(-50%,-50%,0)] after:mix-blend-overlay',E),...z,children:[n.jsx("div",{"aria-hidden":!0,className:k("absolute inset-0 z-0 pointer-events-none","[background-size:20px_20px]","[background-image:linear-gradient(to_right,#e4e4e7_1px,transparent_1px),linear-gradient(to_bottom,#e4e4e7_1px,transparent_1px)]","dark:[background-image:linear-gradient(to_right,#262626_1px,transparent_1px),linear-gradient(to_bottom,#262626_1px,transparent_1px)]","opacity-50 dark:opacity-40","[mask-image:radial-gradient(ellipse_at_center,transparent_10%,black_80%)]")}),n.jsx("div",{"aria-hidden":!0,className:k("absolute inset-0 z-[1] pointer-events-none","[background-size:20px_20px]","[background-image:linear-gradient(to_right,#e4e4e7_1px,transparent_1px),linear-gradient(to_bottom,#e4e4e7_1px,transparent_1px)]","dark:[background-image:linear-gradient(to_right,#262626_1px,transparent_1px),linear-gradient(to_bottom,#262626_1px,transparent_1px)]","opacity-65 dark:opacity-55","mix-blend-multiply dark:mix-blend-screen"),style:{transform:"perspective(900px) rotateX(-72deg) scale(1.05)",transformOrigin:"50% 60%",maskImage:"radial-gradient(ellipse at 50% 45%, black 35%, transparent 75%)",WebkitMaskImage:"radial-gradient(ellipse at 50% 45%, black 35%, transparent 75%)",filter:"blur(0.6px)"}}),h,n.jsx("canvas",{ref:x,className:"absolute inset-0 block size-full dark:opacity-20 opacity-10"}),n.jsx($.div,{className:k("absolute top-[-71.5%] left-1/2 z-[3] w-[30%] h-[140%] rounded-b-full blur-3xl opacity-75 dark:mix-blend-plus-lighter mix-blend-plus-darker [transform:translate3d(-50%,0,0)] [background-position:0%_100%] [background-size:100%_200%]","dark:[background:linear-gradient(20deg,#00f8f1,#ffbd1e20_16.5%,#fe848f_33%,#fe848f20_49.5%,#00f8f1_66%,#00f8f160_85.5%,#ffbd1e_100%)_0_100%_/_100%_200%] [background:linear-gradient(20deg,#00f8f1,#ffbd1e40_16.5%,#fe848f_33%,#fe848f40_49.5%,#00f8f1_66%,#00f8f180_85.5%,#ffbd1e_100%)_0_100%_/_100%_200%]"),animate:{backgroundPosition:"0% 300%"},transition:{duration:5,ease:"linear",repeat:1/0}}),n.jsx("div",{className:"absolute top-0 left-0 z-[7] size-full dark:[background:repeating-linear-gradient(transparent,transparent_1px,white_1px,white_2px)] mix-blend-overlay opacity-50"})]})}const Ae=({galaxyId:f})=>{const[m,y]=i.useState([]),[b,E]=i.useState(!0),h=i.useCallback(async()=>{if(f)try{E(!0);const t=(await Q(f)).filter(u=>u.listHistory?.includes(V));y(t)}catch(s){console.error("Error fetching patched issues:",s)}finally{E(!1)}},[f]);i.useEffect(()=>{h()},[h]),i.useEffect(()=>{const s=()=>{h()},t=u=>{h()};return window.addEventListener(D.PATCH_CREATED,s),window.addEventListener(D.PATCH_REMOVED,t),()=>{window.removeEventListener(D.PATCH_CREATED,s),window.removeEventListener(D.PATCH_REMOVED,t)}},[h]);const z=i.useCallback(async s=>{const t=J();if(!t.email){console.error("No email found in demo");return}try{const u=await Z(s.id);if(!u){console.error("Issue not found");return}const _=[...(u.listHistory||[]).filter(v=>!v.startsWith("version-")),V];if(!await O({issueId:s.id,email:t.email,listHistory:_})){console.error("Failed to update issue");return}await G({patchId:s.id,versionId:s.versionId}),h()}catch(u){console.error("Error handling patch drop:",u)}},[h]),x=i.memo(({issue:s})=>{const[{opacity:t},u]=ee(()=>({type:"issue",item:{id:s._id,title:s.title,sunshines:s.sunshines},collect:C=>({opacity:C.isDragging()?.4:1})}),[s._id,s.title,s.sunshines]);return n.jsxs("div",{ref:u,"data-testid":s._id,style:{opacity:t},className:k("cursor-move border-1 border-amber-300/80 hover:border-amber-400","dark:border-amber-400/70 dark:hover:border-amber-300/90","bg-amber-50/50 dark:bg-amber-900/20","transition-colors p-2 border-dashed rounded-md","flex items-center justify-between gap-2"),children:[n.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300 flex-1 truncate",children:q(s.title)}),n.jsxs("div",{className:"flex items-center gap-1 text-amber-600 dark:text-amber-400",children:[W({iconType:"sunshine",className:"w-4 h-4",fill:"currentColor"}),n.jsx("span",{className:"text-xs font-semibold",children:n.jsx(U,{value:s.sunshines||0,locales:"en-US",format:{useGrouping:!1}})})]})]})});return x.displayName="MinimalDraggableIssue",n.jsx(Y,{backend:K,children:n.jsx($.div,{className:k("fixed right-4 top-1/2 -translate-y-1/2 z-20 w-80","pointer-events-auto","visible"),children:n.jsx("div",{className:"relative h-full min-h-[400px]",children:n.jsxs(te,{className:"w-full h-[400px]",children:[n.jsxs("div",{className:"absolute top-16 left-1/2 -translate-x-1/2 z-30 flex flex-col items-center gap-2",children:[n.jsx("h2",{className:"w-[300px] text-center text-2xl font-semibold text-slate-700 dark:text-slate-200 shadow-2xl",children:"Patcher"}),n.jsx(B,{content:"Issues with 'patcher' in listHistory can be dragged to roadmap patches.",children:W({iconType:"info",className:"w-6 h-6 text-slate-600 dark:text-slate-300",fill:"none"})})]}),n.jsx("div",{className:"absolute top-30 left-1/2 -translate-x-1/2 z-30 flex items-center justify-center w-36 h-48 rounded-full shadow-lg overflow-hidden",children:n.jsx(X,{id:"patcher-patch-drop",accept:["patch"],onDrop:z,className:"w-full h-full",roundedClassName:"rounded-full",innerClassName:"rounded-full"})}),n.jsxs("div",{className:"absolute bottom-0 left-0 right-0 z-30 p-4 space-y-2 max-h-[200px] overflow-x-hidden overflow-y-auto",children:[n.jsx("div",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Patchable Issues"}),b?n.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 text-center py-4",children:"Loading..."}):m.length===0?n.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 text-center py-4",children:"No patchable issues found."}):m.map(s=>n.jsx(x,{issue:s},s._id))]})]})})})})};export{Ae as default};
