import{j as i}from"./jsx-runtime.D_zvdyIk.js";import{r as a}from"./index.DxhH1ShK.js";import{c as S}from"./utils.Lr0IsqiS.js";import{m as F}from"./proxy.D4YeN7SK.js";import{g as H}from"./icon.DFuhwfpy.js";import{a as V}from"./auth.C6MmFFld.js";import{i as W,I as D,c as $}from"./issue.CJErfNqu.js";import{a as q}from"./patch.CbMO86LR.js";import{B as Y}from"./Button.CuXyr_i0.js";import{C as G}from"./Tooltip.BWGh4r1w.js";import{C as K}from"./DropTarget.DZsHsBzm.js";import{D as X,H as J}from"./index.CeIpCxKj.js";import{a as Q,g as Z,p as O,b as ee}from"./issue.Cu6yhr5C.js";import"./clsx.B-dksMZM.js";import"./virtual.VUcB3V37.js";import"./client.B9YBqyHK.js";import"./ripple.MQee5g1d.js";import"./slot.Dc8ja7ZA.js";import"./ElectricBorder.BANsXwQj.js";import"./eventTypes.j192VUKf.js";import"./index.C2SuE_cr.js";import"./index.CqUFkXl9.js";import"./index.CG_O7YBG.js";import"./star.J0JRTi5O.js";function te({strokeColor:b="#737373",numberOfLines:w=50,numberOfDiscs:_=50,particleRGBColor:v=[255,255,255],className:M,children:T,...R}){const g=a.useRef(null),j=a.useRef(0),t=a.useRef({discs:[],lines:[],particles:[],clip:{},startDisc:{},endDisc:{},rect:{width:0,height:0},render:{width:0,height:0,dpi:1},particleArea:{},linesCanvas:null}),I=e=>e,A=e=>e===0?0:Math.pow(2,10*(e-1)),k=a.useCallback((e,r,c,u=null)=>{const s=r-e;return e+s*(u==="inExpo"?A:I)(c)},[]),E=a.useCallback(e=>{const{startDisc:r,endDisc:c}=t.current;e.x=k(r.x,c.x,e.p),e.y=k(r.y,c.y,e.p,"inExpo"),e.w=k(r.w,c.w,e.p),e.h=k(r.h,c.h,e.p)},[k]),P=a.useCallback(()=>{const e=g.current;if(!e)return;const r=e.getBoundingClientRect();t.current.rect={width:r.width,height:r.height},t.current.render={width:r.width,height:r.height,dpi:window.devicePixelRatio||1},e.width=t.current.render.width*t.current.render.dpi,e.height=t.current.render.height*t.current.render.dpi},[]),n=a.useCallback(()=>{const{width:e,height:r}=t.current.rect;if(e<=0||r<=0){t.current.discs=[];return}t.current.discs=[],t.current.startDisc={x:e*.5,y:r*.45,w:e*.75,h:r*.7},t.current.endDisc={x:e*.5,y:r*.95,w:0,h:0};let c=r;t.current.clip={};for(let l=0;l<_;l++){const h={p:l/_,x:0,y:0,w:0,h:0};E(h);const y=h.y+h.h;y<=c&&(t.current.clip={disc:{...h},i:l}),c=y,t.current.discs.push(h)}const u=new Path2D,s=t.current.clip.disc;u.ellipse(s.x,s.y,s.w,s.h,0,0,Math.PI*2),u.rect(s.x-s.w,0,s.w*2,s.y),t.current.clip.path=u},[_,E]),o=a.useCallback(()=>{const{width:e,height:r}=t.current.rect;if(e<=0||r<=0){t.current.linesCanvas=null;return}t.current.lines=[];const c=Math.PI*2/w;for(let l=0;l<w;l++)t.current.lines.push([]);t.current.discs.forEach(l=>{for(let x=0;x<w;x++){const h=x*c,y={x:l.x+Math.cos(h)*l.w,y:l.y+Math.sin(h)*l.h};t.current.lines[x].push(y)}});const u=document.createElement("canvas");u.width=e,u.height=r;const s=u.getContext("2d");s&&(t.current.lines.forEach(l=>{s.save();let x=!1;l.forEach((h,y)=>{if(y===0)return;const B=l[y-1];!x&&(s.isPointInPath(t.current.clip.path,h.x,h.y)||s.isPointInStroke(t.current.clip.path,h.x,h.y))?x=!0:x&&s.clip(t.current.clip.path),s.beginPath(),s.moveTo(B.x,B.y),s.lineTo(h.x,h.y),s.strokeStyle=b,s.lineWidth=2,s.stroke(),s.closePath()}),s.restore()}),t.current.linesCanvas=u)},[w,b]),d=a.useCallback((e=!1)=>{const r=t.current.particleArea.sx+t.current.particleArea.sw*Math.random(),u=t.current.particleArea.ex+t.current.particleArea.ew*Math.random()-r,s=e?t.current.particleArea.h*Math.random():t.current.particleArea.h,l=.5+Math.random()*4,x=.5+Math.random();return{x:r,sx:r,dx:u,y:s,vy:x,p:0,r:l,c:`rgba(${v[0]}, ${v[1]}, ${v[2]}, ${Math.random()})`}},[v]),m=a.useCallback(()=>{const{width:e,height:r}=t.current.rect;if(e<=0||r<=0){t.current.particles=[];return}t.current.particles=[];const c=t.current.clip.disc;t.current.particleArea={sw:c.w*.5,ew:c.w*2,h:r*.85},t.current.particleArea.sx=(e-t.current.particleArea.sw)/2,t.current.particleArea.ex=(e-t.current.particleArea.ew)/2;const u=100;for(let s=0;s<u;s++)t.current.particles.push(d(!0))},[d]),p=a.useCallback(e=>{e.strokeStyle=b,e.lineWidth=2;const r=t.current.startDisc;e.beginPath(),e.ellipse(r.x,r.y,r.w,r.h,0,0,Math.PI*2),e.stroke(),e.closePath(),t.current.discs.forEach((c,u)=>{u%5===0&&(c.w<t.current.clip.disc.w-5&&(e.save(),e.clip(t.current.clip.path)),e.beginPath(),e.ellipse(c.x,c.y,c.w,c.h,0,0,Math.PI*2),e.stroke(),e.closePath(),c.w<t.current.clip.disc.w-5&&e.restore())})},[b]),f=a.useCallback(e=>{const r=t.current.linesCanvas;r&&r.width>0&&r.height>0&&e.drawImage(r,0,0)},[]),C=a.useCallback(e=>{e.save(),e.clip(t.current.clip.path),t.current.particles.forEach(r=>{e.fillStyle=r.c,e.beginPath(),e.rect(r.x,r.y,r.r,r.r),e.closePath(),e.fill()}),e.restore()},[]),N=a.useCallback(()=>{t.current.discs.forEach(e=>{e.p=(e.p+.001)%1,E(e)})},[E]),U=a.useCallback(()=>{t.current.particles.forEach((e,r)=>{e.p=1-e.y/t.current.particleArea.h,e.x=e.sx+e.dx*e.p,e.y-=e.vy,e.y<0&&(t.current.particles[r]=d())})},[d]),z=a.useCallback(()=>{const e=g.current;if(!e)return;const r=e.getContext("2d");if(r){if(e.width<=0||e.height<=0){j.current=requestAnimationFrame(z);return}r.clearRect(0,0,e.width,e.height),r.save(),r.scale(t.current.render.dpi,t.current.render.dpi),N(),U(),p(r),f(r),C(r),r.restore(),j.current=requestAnimationFrame(z)}},[N,U,p,f,C]),L=a.useCallback(()=>{P(),n(),o(),m()},[P,n,o,m]);return a.useEffect(()=>{if(!g.current)return;L(),z();const r=()=>{P(),n(),o(),m()};return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r),cancelAnimationFrame(j.current)}},[L,z,P,n,o,m]),i.jsxs("div",{"data-slot":"hole-background",className:S("relative size-full overflow-hidden",'before:content-[""] before:absolute before:top-1/2 before:left-1/2 before:block before:size-[140%] dark:before:[background:radial-gradient(ellipse_at_50%_55%,transparent_10%,black_50%)] before:[background:radial-gradient(ellipse_at_50%_55%,transparent_10%,white_50%)] before:[transform:translate3d(-50%,-50%,0)]','after:content-[""] after:absolute after:z-[5] after:top-1/2 after:left-1/2 after:block after:size-full after:[background:radial-gradient(ellipse_at_50%_75%,#a900ff_20%,transparent_75%)] after:[transform:translate3d(-50%,-50%,0)] after:mix-blend-overlay',M),...R,children:[i.jsx("div",{"aria-hidden":!0,className:S("absolute inset-0 z-0 pointer-events-none","[background-size:20px_20px]","[background-image:linear-gradient(to_right,#e4e4e7_1px,transparent_1px),linear-gradient(to_bottom,#e4e4e7_1px,transparent_1px)]","dark:[background-image:linear-gradient(to_right,#262626_1px,transparent_1px),linear-gradient(to_bottom,#262626_1px,transparent_1px)]","opacity-50 dark:opacity-40","[mask-image:radial-gradient(ellipse_at_center,transparent_10%,black_80%)]")}),i.jsx("div",{"aria-hidden":!0,className:S("absolute inset-0 z-[1] pointer-events-none","[background-size:20px_20px]","[background-image:linear-gradient(to_right,#e4e4e7_1px,transparent_1px),linear-gradient(to_bottom,#e4e4e7_1px,transparent_1px)]","dark:[background-image:linear-gradient(to_right,#262626_1px,transparent_1px),linear-gradient(to_bottom,#262626_1px,transparent_1px)]","opacity-65 dark:opacity-55","mix-blend-multiply dark:mix-blend-screen"),style:{transform:"perspective(900px) rotateX(72deg) scale(1.05)",transformOrigin:"50% 40%",maskImage:"radial-gradient(ellipse at 50% 55%, black 35%, transparent 75%)",WebkitMaskImage:"radial-gradient(ellipse at 50% 55%, black 35%, transparent 75%)",filter:"blur(0.6px)"}}),T,i.jsx("canvas",{ref:g,className:"absolute inset-0 block size-full dark:opacity-20 opacity-10"}),i.jsx(F.div,{className:S("absolute top-[-71.5%] left-1/2 z-[3] w-[30%] h-[140%] rounded-b-full blur-3xl opacity-75 dark:mix-blend-plus-lighter mix-blend-plus-darker [transform:translate3d(-50%,0,0)] [background-position:0%_100%] [background-size:100%_200%]","dark:[background:linear-gradient(20deg,#00f8f1,#ffbd1e20_16.5%,#fe848f_33%,#fe848f20_49.5%,#00f8f1_66%,#00f8f160_85.5%,#ffbd1e_100%)_0_100%_/_100%_200%] [background:linear-gradient(20deg,#00f8f1,#ffbd1e40_16.5%,#fe848f_33%,#fe848f40_49.5%,#00f8f1_66%,#00f8f180_85.5%,#ffbd1e_100%)_0_100%_/_100%_200%]"),animate:{backgroundPosition:"0% 300%"},transition:{duration:5,ease:"linear",repeat:1/0}}),i.jsx("div",{className:"absolute top-0 left-0 z-[7] size-full dark:[background:repeating-linear-gradient(transparent,transparent_1px,white_1px,white_2px)] mix-blend-overlay opacity-50"})]})}const re=()=>{const{data:b}=V.useSession(),[w,_]=a.useState([]),[v,M]=a.useState(!1),[T,R]=a.useState(""),[g,j]=a.useState(void 0),t=a.useRef(""),I=a.useRef(void 0),A=a.useCallback(async(n,o)=>{const d=n||I.current,m=o||t.current;if(!(!d||!m))try{const p=await Q(m,d),f=p.filter(N=>N.listHistory?.includes(q)),C=p.some(N=>W(N));M(f.length>0||C),_(f)}catch(p){console.error("Error fetching patched issues:",p)}},[]);a.useLayoutEffect(()=>{const n=async d=>{const m=d,p=m.detail.tabType,f=m.detail.galaxyId;I.current=p,t.current=f,j(p),t.current!==f&&R(f),await A(p,f)},o=async()=>{await A(I.current,t.current)};return window.addEventListener(D.ISSUES_TAB_CHANGED,n),window.addEventListener(D.ISSUE_UPDATE,o),requestAnimationFrame(()=>{}),()=>{window.removeEventListener(D.ISSUES_TAB_CHANGED,n),window.removeEventListener(D.ISSUE_UPDATE,o)}},[A]),a.useEffect(()=>{t.current=T},[T]),a.useEffect(()=>{I.current=g},[g]);const k=a.useCallback(async n=>{const o=b?.user;if(!o?.email){console.error("No authenticated user found");return}try{const d=await Z(n.id);if(!d){console.error("Issue not found");return}if(await O({issueId:n.id,email:o.email})){const p={...d,originalListTitle:"Unknown"};_(f=>f.some(C=>C._id===n.id)?f:[...f,p])}}catch(d){console.error("Error patching issue:",d)}},[b]),E=a.useCallback(async n=>{const o=b?.user;if(!o?.email){console.error("No authenticated user found");return}try{await ee({issueId:n._id,email:o.email})&&_(m=>m.filter(p=>p._id!==n._id))}catch(d){console.error("Error unpatching issue:",d)}},[b]),P=(n,o=58)=>n.length<=o?n:n.substring(0,o)+"...";return i.jsx(F.div,{className:S("fixed right-4 top-1/2 -translate-y-1/2 z-20 w-80","pointer-events-auto",v?"visible":"invisible"),children:i.jsx("div",{className:"relative h-full min-h-[400px]",children:i.jsxs(te,{className:"w-full h-[400px]",children:[i.jsxs("div",{className:"absolute top-16 left-1/2 -translate-x-1/2 z-30 flex flex-col items-center gap-2",children:[i.jsx("h2",{className:"w-[300px] text-center text-2xl font-semibold text-slate-700 dark:text-slate-200 shadow-2xl",children:g?$[g]:"Issues"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("h2",{className:"text-xl font-semibold text-slate-700 dark:text-slate-200 shadow-2xl",children:"Patcher"}),i.jsx(G,{content:"Issues with contributors and maintainers can be converted into patches here.",children:H({iconType:"info",className:"w-6 h-6 text-slate-600 dark:text-slate-300",fill:"none"})})]})]}),i.jsx("div",{className:"absolute top-30 left-1/2 -translate-x-1/2 z-30 flex items-center justify-center w-36 h-48 rounded-full shadow-lg overflow-hidden",children:i.jsx(K,{id:"patcher-drop",accept:["patch"],onDrop:k,className:"w-full h-full",roundedClassName:"rounded-full",innerClassName:"rounded-full"})}),i.jsxs("div",{className:"absolute bottom-0 left-0 right-0 z-30 p-4 space-y-2 max-h-[200px] overflow-y-auto",children:[i.jsx("div",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Patches"}),w.length===0?i.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 text-center py-4",children:"No patches yet. Drag patchable issues here."}):w.map(n=>i.jsxs("div",{className:"flex items-center justify-between gap-2 p-2 bg-slate-100/50 dark:bg-slate-800/50 rounded-md border border-slate-200 dark:border-slate-700",children:[i.jsx("span",{className:"text-xs text-slate-700 dark:text-slate-300 flex-1 truncate",children:P(n.title)}),i.jsx(Y,{variant:"secondary",className:"h-6 px-2 text-xs",onClick:()=>E(n),children:"Cancel"})]},n._id))]})]})})})},Ce=({})=>i.jsx(X,{backend:J,children:i.jsx(re,{})});export{Ce as default};
