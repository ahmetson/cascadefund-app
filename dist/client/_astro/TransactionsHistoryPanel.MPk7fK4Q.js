import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as d}from"./index.DxhH1ShK.js";import{P as v}from"./PageLikePanel.Dipvl2FS.js";import{B as u}from"./Button.BK-c6KtM.js";import{g as c}from"./icon.Df9DBUhx.js";import{C as p}from"./Tooltip.CRI7KqtE.js";import{L as R}from"./List.CgTKD_hI.js";import{A as f}from"./AuthStar.nxAGzTTY.js";import{B as S}from"./Badge.CwoN8wRJ.js";import{N as m}from"./NumberFlow-client-48rw3j0J.DO-Ted3l.js";import{P as T,a as D,b as F,c as P,d as H,e as I}from"./PopoverArrow.BaWnEbH-.js";import{P as C}from"./PopoverDescription.C4Eu5Fxu.js";import{T as E}from"./timeago-react.CCkgRyVe.js";import{C as N}from"./Link.BGo-y1Vn.js";import z from"./BackButton.-3dQrQte.js";import{a as O}from"./virtual.VUcB3V37.js";import{ObjectId as W}from"mongodb";import{g as k}from"./utils.BnlJtBIq.js";import{P as G}from"./PopoverTitle.CfIfYysC.js";import"./Panel.BFyw-rTz.js";import"./ripple.8VKTSqqU.js";import"./slot.RkfkL2mj.js";import"./proxy.D4YeN7SK.js";import"./accordion.Dr61eiHV.js";import"./accordion.CpVAuD1l.js";import"./useControlledState.CmDsCfE3.js";import"./index.DpQ8kv17.js";import"./index.C2SuE_cr.js";import"./index.CqUFkXl9.js";import"./index.Du2_2VfY.js";import"./index.CG_O7YBG.js";import"./createLucideIcon.C1tpinp8.js";import"./PanelAction.a_cGOObt.js";import"./ElectricBorder.DAWLx7iV.js";import"./browse-tracker.1pHqLWse.js";import"./client.B9YBqyHK.js";const J=({defaultShowCascaded:t=!1,showCascaded:i,onToggle:a})=>e.jsx("div",{className:"mb-4",children:e.jsx(u,{variant:"secondary",size:"sm",onClick:()=>a(!i),className:"w-full sm:w-auto",children:i?"show user donations":"show cascading donations"})}),K=({nickname:t,icon:i,isMaintainer:a,amount:o,sunshines:r,stars:n,receivers:l})=>e.jsx("div",{children:e.jsxs("div",{className:"flex items-center justify-between gap-2 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(f,{src:i,nickname:t,sunshines:r,stars:n,isMaintainer:a,className:"flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(S,{variant:a?"blue":"gray",static:!0,children:a?"Maintainer":"Donator"}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600 dark:text-gray-400",children:[c({iconType:"star",className:"w-3 h-3"}),e.jsx(m,{value:n,locales:"en-US",format:{style:"decimal",maximumFractionDigits:2}})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(m,{value:o,locales:"en-US",format:{style:"currency",currency:"USD",maximumFractionDigits:2},className:"text-sm font-medium text-gray-800 dark:text-gray-400"}),l&&l.length>0&&e.jsx(A,{receivers:l})]})]})}),A=({receivers:t=[]})=>e.jsxs(T,{children:[e.jsx(D,{className:"hyperlink flex items-center justify-center shadow-none",children:e.jsx(p,{content:e.jsx("div",{className:"text-sm",children:"View receivers"}),children:e.jsxs(u,{variant:"secondary",size:"sm",className:"flex items-center gap-1 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600",children:[c({iconType:"arrow-to-br-corner",className:"w-4 h-4"}),c({iconType:"multiple-users",className:"w-4 h-4"})]})})}),e.jsx(F,{children:e.jsx(P,{sideOffset:8,side:"bottom",className:"z-999!",children:e.jsxs(H,{className:"w-80 origin-[var(--transform-origin)] rounded-xs bg-[canvas] px-6 py-4 text-gray-900 shadow-sm shadow-gray-900 dark:text-slate-300 dark:shadow-slate-300 transition-[transform,scale,opacity] data-[ending-style]:scale-90 data-[ending-style]:opacity-0 data-[starting-style]:scale-90 data-[starting-style]:opacity-0",children:[e.jsx(I,{className:"data-[side=bottom]:top-[-8px] data-[side=left]:right-[-13px] data-[side=left]:rotate-90 data-[side=right]:left-[-13px] data-[side=right]:-rotate-90 data-[side=top]:bottom-[-8px] data-[side=top]:rotate-180"}),e.jsx(C,{className:"text-gray-600 dark:text-slate-400 text-sm mb-3",children:"Donation Receivers"}),e.jsx(R,{contentHeight:"h-64",children:t.length>0?t.map((i,a)=>e.jsx(K,{...i},a)):e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:"No receivers"})})]})})})]});let y=null;const w="Ara";async function $(){throw new Error("MONGODB_URI environment variable is not set")}async function V(){return y||(y=(await $()).db(w),console.log(`ðŸ“Š Database name: ${w}`),console.log("ðŸ”Œ Connection status: Disconnected")),y}async function q(t){return(await V()).collection(t)}function Q(t){return t?{_id:t._id?.toString(),sunshines:t.sunshines,stars:t.stars,balance:t.balance,demoPrivateKey:t.demoPrivateKey,userId:t.userId}:null}async function X(t){try{const i=await q("stars"),a=typeof t=="string"?new W(t):t,o=await i.findOne({_id:a});return Q(o)}catch(i){return console.error("Error getting star by id:",i),null}}const M=[[{nickname:"Emma Davis",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:450,sunshines:450,stars:1.25,receivers:[{nickname:"John Smith",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!0,amount:200,sunshines:200,stars:.56,receivers:[{nickname:"Alice Brown",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:100,sunshines:100,stars:.28}]},{nickname:"Robert Wilson",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:150,sunshines:150,stars:.42}]},{nickname:"Lisa Anderson",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!0,amount:500,sunshines:500,stars:1.39,receivers:[{nickname:"David Lee",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:300,sunshines:300,stars:.83}]},{nickname:"Chris Taylor",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:300,sunshines:300,stars:.83}],[{nickname:"Mark Thompson",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!0,amount:1500,sunshines:1500,stars:4.17,receivers:[{nickname:"Jennifer White",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:750,sunshines:750,stars:2.08},{nickname:"Kevin Martinez",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!0,amount:500,sunshines:500,stars:1.39,receivers:[{nickname:"Sophia Garcia",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:250,sunshines:250,stars:.69}]}]},{nickname:"Amanda Johnson",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:1e3,sunshines:1e3,stars:2.78}],[{nickname:"Oliver Martinez",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!0,amount:800,sunshines:800,stars:2.22,receivers:[{nickname:"Nina Patel",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:400,sunshines:400,stars:1.11}]},{nickname:"Ryan Cooper",icon:"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",isMaintainer:!1,amount:600,sunshines:600,stars:1.67}]];async function Y(t){try{const i=await O.getDonationsByGalaxyId({galaxyId:t});if(!i.data?.success||!i.data.data)return[];const a=i.data.data,o=[];for(const r of a){const n=await X(r.userId);if(!n)continue;const l=Math.floor(Math.random()*M.length),h=M[l],x={...r,amount:r.spendUsdAmount,date:r.createdAt?r.createdAt*1e3:Date.now(),blockchainTx:r.initiateTxId,user:{nickname:n.nickname||"Unknown",icon:n.src,sunshines:n.sunshines||0,stars:n.stars||0,isMaintainer:n.role==="maintainer"},receivers:h};o.push(x)}return o}catch(i){return console.error("Error getting donations:",i),[]}}const Le=({galaxyId:t,defaultShowCascaded:i=!1})=>{const[a,o]=d.useState(i),[r,n]=d.useState([]),[l,h]=d.useState(!0),[x,L]=d.useState(new Set),[g,U]=d.useState(new Set);d.useEffect(()=>{t&&(async()=>{h(!0);try{const j=await Y(t);n(j)}catch(j){console.error("Error fetching donations:",j)}finally{h(!1)}})()},[t]);const _=s=>{L(new Set([...x,s])),alert("We sent email to the user notifying your feedback")},B=s=>{U(new Set([...g,s]))},b=a?r.filter(s=>s.maintainer):r;return l?e.jsx(v,{title:"Donation History",children:e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading donations..."})}):e.jsxs(v,{title:"Donation History",children:[e.jsx(J,{defaultShowCascaded:i,showCascaded:a,onToggle:o}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-2 text-sm font-medium text-gray-600",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-600",children:"#"}),"ID"]})}),e.jsx("th",{className:"text-left py-3 px-2 text-sm font-medium text-gray-600 text-blue-600",children:"Proof"}),e.jsx("th",{className:"text-left py-3 px-2 text-sm font-medium text-gray-600 text-blue-600",children:"Amount"}),e.jsx("th",{className:"text-left py-3 px-2 text-sm font-medium text-gray-600",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-2 text-sm font-medium text-gray-600",children:"User"}),!a&&e.jsx("th",{className:"text-left py-3 px-2 text-sm font-medium text-gray-600",children:"Memo"}),a&&e.jsx("th",{className:"text-left py-3 px-2 text-sm font-medium text-gray-600",children:"Cascade"})]})}),e.jsx("tbody",{children:b.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-8 text-center text-gray-500",children:"No donations found"})}):b.map(s=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50 dark:hover:bg-teal-900/40",children:[e.jsx("td",{className:"py-4 px-2",children:e.jsx("div",{className:"flex items-center gap-1 text-sm text-gray-800 dark:text-gray-400 pl-3",children:s._id?s._id.substring(0,8):"N/A"})}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(N,{uri:k(s.initiateTxId),asNewTab:!0,className:"text-blue-600 hover:underline dark:text-blue-400 dark:hover:text-blue-300",children:"Deposit Tx"}),e.jsx("span",{className:"text-gray-400 dark:text-gray-600",children:"|"}),e.jsx(N,{uri:k(s.hyperpayTxId),asNewTab:!0,className:"text-blue-600 hover:underline dark:text-blue-400 dark:hover:text-blue-300",children:"Hyperpay Tx"})]})}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{content:e.jsx("div",{className:"text-sm",children:a&&s.maintainer?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"Maintainer who shared his donations with you"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:s.maintainer.icon||"https://api.backdropbuild.com/storage/v1/object/public/avatars/9nFM8HasgS.jpeg",alt:s.maintainer.nickname,className:"w-12 h-12 rounded-full"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:s.maintainer.nickname}),e.jsx("span",{className:"text-xs bg-blue-500 text-white px-1.5 py-0.5 rounded",children:"Maintainer"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[c({iconType:"sunshine",className:"w-4 h-4"}),e.jsx(m,{value:s.maintainer.sunshines,locales:"en-US",format:{style:"decimal",maximumFractionDigits:0},className:"text-xs"}),c({iconType:"star",className:"w-4 h-4"}),e.jsx(m,{value:s.maintainer.stars,locales:"en-US",format:{style:"decimal",maximumFractionDigits:2},className:"text-xs"})]})]})]})]}):"Amount user donated"}),children:e.jsx(m,{value:s.amount,locales:"en-US",format:{style:"currency",currency:"USD",maximumFractionDigits:2},className:"text-sm font-medium text-gray-800 dark:text-gray-400"})}),!a&&e.jsx(A,{receivers:s.receivers})]})}),e.jsx("td",{className:"py-4 px-2",children:e.jsx(E,{datetime:s.date,className:"text-sm text-gray-800 dark:text-gray-400"})}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{content:e.jsxs("div",{className:"text-sm",children:["Who donated",e.jsx("div",{className:"mt-2",children:e.jsx(f,{src:s.user.icon,nickname:s.user.nickname,sunshines:s.user.sunshines,stars:s.user.stars,role:s.user.isMaintainer?"maintainer":"user"})})]}),children:e.jsx(f,{src:s.user.icon,nickname:s.user.nickname,sunshines:s.user.sunshines,stars:s.user.stars,role:s.user.isMaintainer?"maintainer":"user"})}),e.jsx(p,{content:e.jsxs("div",{className:"text-sm",children:["Received ",s.user.sunshines," sunshines. ",c({iconType:"star",className:"w-4 h-4 inline"})," 1 = 360 sunshines"]}),children:e.jsxs("div",{className:"flex items-center gap-1",children:[c({iconType:"sunshine",className:"w-4 h-4"}),e.jsx(m,{value:s.user.sunshines,locales:"en-US",format:{style:"decimal",maximumFractionDigits:0},className:"text-sm text-gray-800 dark:text-gray-400"}),e.jsx("span",{className:"text-gray-500",children:"+"})]})})]})}),!a&&e.jsx("td",{className:"py-4 px-2",children:s.memo?e.jsxs(T,{children:[e.jsx(D,{className:"hyperlink flex items-center justify-center shadow-none",children:e.jsxs("div",{className:"text-sm text-gray-800 dark:text-gray-400 italic max-w-xs truncate",children:['"',s.memo.substring(0,64),s.memo.length>64?"...":"",'"']})}),e.jsx(F,{children:e.jsx(P,{sideOffset:8,side:"bottom",className:"z-999!",children:e.jsxs(H,{className:"w-96 origin-[var(--transform-origin)] rounded-xs bg-[canvas] px-6 py-4 text-gray-900 shadow-sm shadow-gray-900 dark:text-slate-300 dark:shadow-slate-300 transition-[transform,scale,opacity] data-[ending-style]:scale-90 data-[ending-style]:opacity-0 data-[starting-style]:scale-90 data-[starting-style]:opacity-0",children:[e.jsx(I,{className:"data-[side=bottom]:top-[-8px] data-[side=left]:right-[-13px] data-[side=left]:rotate-90 data-[side=right]:left-[-13px] data-[side=right]:-rotate-90 data-[side=top]:bottom-[-8px] data-[side=top]:rotate-180"}),e.jsx(G,{className:"text-gray-500 dark:text-gray-400 font-medium text-md mb-2",children:"Memo"}),e.jsx(C,{className:"text-gray-600 dark:text-slate-400 text-sm mb-4",children:s.memo}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:"secondary",size:"sm",onClick:()=>B(s._id||s.initiateTxId),disabled:g.has(s._id||s.initiateTxId),children:g.has(s._id||s.initiateTxId)?"Completed":"Complete"}),e.jsxs(u,{variant:"primary",size:"sm",onClick:()=>_(s._id||s.initiateTxId),disabled:x.has(s._id||s.initiateTxId),className:"flex items-center gap-1",children:[c({iconType:"likes",className:"w-4 h-4"}),x.has(s._id||s.initiateTxId)?"Liked":"Like"]})]})]})})})]}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),a&&e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{}),e.jsx(p,{content:e.jsxs("div",{className:"text-sm",children:["Shared at the ",s.cascadeLevel||3," level"]}),children:e.jsx(S,{variant:"info",static:!0,children:e.jsx(m,{value:s.cascadeLevel||3,locales:"en-US",format:{style:"decimal",maximumFractionDigits:0}})})})]})})]},s._id||s.initiateTxId))})]})})]})};export{Le as default};
