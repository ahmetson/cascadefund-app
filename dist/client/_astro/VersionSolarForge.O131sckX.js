import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as l,R as z}from"./index.DxhH1ShK.js";import{P as M}from"./PageLikePanel.guWiuL_Q.js";import{C as H}from"./Link.k33VB9n9.js";import{B as Y}from"./Button.CuXyr_i0.js";import{g as v}from"./icon.DFuhwfpy.js";import{N as u}from"./NumberFlow-client-48rw3j0J.DO-Ted3l.js";import{R as T}from"./roadmap.DwIP75iC.js";import{s as $}from"./all-stars.DwU73iD6.js";import{g as q}from"./star.J0JRTi5O.js";import{g as J}from"./auth.C6MmFFld.js";import{A as D}from"./AuthStar.Dmg28nm4.js";import{c as k}from"./utils.Lr0IsqiS.js";import{c as V}from"./confetti.module.Cx83yTHA.js";import"./Panel.BDrWh8LJ.js";import"./eventTypes.j192VUKf.js";import"./ripple.MQee5g1d.js";import"./slot.Dc8ja7ZA.js";import"./proxy.D4YeN7SK.js";import"./accordion.CkcBKuZR.js";import"./accordion.Du3ry5_a.js";import"./use-controlled-state.CxrLW6JS.js";import"./index.TaQMmt2C.js";import"./index.C2SuE_cr.js";import"./index.CqUFkXl9.js";import"./index.pjxe1RjL.js";import"./index.CG_O7YBG.js";import"./createLucideIcon.C1tpinp8.js";import"./PanelAction.DEFdBo1-.js";import"./ElectricBorder.BANsXwQj.js";import"./clsx.B-dksMZM.js";import"./virtual.VUcB3V37.js";import"./client.B9YBqyHK.js";import"./Tooltip.BWGh4r1w.js";const Re=()=>{const[j,y]=l.useState(!1),[S,U]=l.useState(!1),[E,F]=l.useState(""),[G,P]=l.useState(""),[i,I]=l.useState(null),[p,R]=l.useState([]),[h,f]=l.useState("loading"),[C,N]=l.useState(-1),n=z.useRef([]);if(l.useEffect(()=>{const t=async r=>{const o=r,{versionId:d,tag:w,galaxyId:m}=o.detail;n.current.forEach(a=>clearTimeout(a)),n.current=[],I(null),R([]),N(-1),U(!1),f("loading"),F(w),P(m),y(!0);try{const a=await $(d);I(a);const L=a.users.map(async x=>{const c=await q(x.id);if(!c)return null;let g;return c.userId&&(g=await J(c.userId)),{...c,earnedStars:x.stars,roles:x.roles,authUser:g}}),b=(await Promise.all(L)).filter(x=>x!==null);R(b);const _=setTimeout(()=>{f("users"),N(0)},2e3);n.current.push(_),b.forEach((x,c)=>{const g=setTimeout(()=>{if(N(c),c===b.length-1){const B=setTimeout(()=>{f("topUser");const O=setTimeout(()=>{f("complete")},2e3);n.current.push(O)},1e3);n.current.push(B)}},1e3*(c+1));n.current.push(g)}),f("summary")}catch(a){console.error("Error in solar forge:",a),y(!1)}};return window.addEventListener(T.VERSION_RELEASED,t),()=>{window.removeEventListener(T.VERSION_RELEASED,t),n.current.forEach(r=>clearTimeout(r)),n.current=[]}},[]),l.useEffect(()=>{if(j&&!S){let t=function(m,a){return Math.random()*(a-m)+m};U(!0);const r=3e3,o=Date.now()+r,d={startVelocity:30,spread:360,ticks:60,zIndex:9999},w=setInterval(function(){const m=o-Date.now();if(m<=0){clearInterval(w);return}const a=50*(m/r);V({...d,particleCount:a,origin:{x:t(.1,.3),y:Math.random()-.2}}),V({...d,particleCount:a,origin:{x:t(.7,.9),y:Math.random()-.2}})},250)}},[j,S]),!j)return null;const s=p.length>0?p[0]:null,A=`/project?galaxy=${G}`;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 left-0 w-full h-full bg-black/50 backdrop-blur-sm z-[100]",onClick:()=>{h==="complete"&&y(!1)}}),e.jsx("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[101] flex items-center justify-center w-full max-w-2xl px-4",children:e.jsx(M,{title:"Version Released!",titleCenter:!0,children:e.jsxs("div",{className:"space-y-6",children:[i&&h!=="loading"&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"text-xl font-bold text-slate-700 dark:text-slate-300",children:["Resolved"," ",e.jsx(u,{value:i.totalIssues,locales:"en-US",format:{useGrouping:!1},className:"inline-block"})," ","issues"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-6",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Users"}),e.jsx(u,{value:p.length,locales:"en-US",format:{useGrouping:!1},className:"text-xl font-semibold text-slate-700 dark:text-slate-300"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400 flex items-center gap-1",children:[v({iconType:"sunshine",className:"w-4 h-4"}),"Sunshines"]}),e.jsx(u,{value:i.totalSunshines,locales:"en-US",format:{useGrouping:!0},className:"text-xl font-semibold text-amber-600 dark:text-amber-400"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400 flex items-center gap-1",children:[v({iconType:"star",className:"w-4 h-4"}),"Stars"]}),e.jsx(u,{value:i.totalStars,locales:"en-US",format:{useGrouping:!1,minimumFractionDigits:1,maximumFractionDigits:6},className:"text-xl font-semibold text-yellow-600 dark:text-yellow-400"})]})]})]}),i&&p.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-700 dark:text-slate-300 text-center",children:"Stars Distributed"}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:p.map((t,r)=>e.jsxs("div",{className:k("flex items-center justify-between p-3 rounded-lg border transition-all duration-500",r<=C?"opacity-100 translate-x-0 border-slate-200 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-800/50":"opacity-0 -translate-x-4 pointer-events-none"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{star:t,src:t.authUser?.image,nickname:t.authUser?.name||t.authUser?.username||t.authUser?.email?.split("@")[0]||"Unknown"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-800 dark:text-slate-200",children:t.authUser?.name||t.authUser?.username||t.authUser?.email?.split("@")[0]||"Unknown"}),e.jsx("div",{className:"flex gap-1 mt-1",children:t.roles.map((o,d)=>e.jsx("span",{className:k("text-xs px-2 py-0.5 rounded",o==="author"&&"bg-blue-500 text-white",o==="contributor"&&"bg-purple-500 text-white",o==="maintainer"&&"bg-green-500 text-white"),children:o},d))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[v({iconType:"star",className:"w-5 h-5 text-yellow-500 dark:text-yellow-400"}),e.jsx(u,{value:t.earnedStars,locales:"en-US",format:{useGrouping:!1,minimumFractionDigits:1,maximumFractionDigits:6},className:"text-lg font-semibold text-yellow-600 dark:text-yellow-400"})]})]},t._id))})]}),i&&s&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-700 dark:text-slate-300",children:"Top Receiver"}),e.jsxs("div",{className:"flex flex-col items-center p-6 rounded-lg border-2 border-yellow-400 dark:border-yellow-500 bg-yellow-50/50 dark:bg-yellow-900/20",children:[e.jsx(D,{star:s,src:s.authUser?.image,nickname:s.authUser?.name||s.authUser?.username||s.authUser?.email?.split("@")[0]||"Unknown"}),e.jsx("div",{className:"mt-4 font-bold text-xl text-slate-800 dark:text-slate-200",children:s.authUser?.name||s.authUser?.username||s.authUser?.email?.split("@")[0]||"Unknown"}),e.jsx("div",{className:"flex gap-2 mt-2",children:s.roles.map((t,r)=>e.jsx("span",{className:k("text-sm px-3 py-1 rounded font-semibold",t==="author"&&"bg-blue-500 text-white",t==="contributor"&&"bg-purple-500 text-white",t==="maintainer"&&"bg-green-500 text-white"),children:t},r))}),e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[v({iconType:"star",className:"w-6 h-6 text-yellow-500 dark:text-yellow-400"}),e.jsx(u,{value:s.earnedStars,locales:"en-US",format:{useGrouping:!1,minimumFractionDigits:1,maximumFractionDigits:6},className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400"})]})]})]}),i&&h==="complete"&&e.jsx("div",{className:"flex justify-center",children:e.jsx(H,{uri:A,children:e.jsx(Y,{variant:"primary",size:"lg",children:"Put star in Galaxy"})})}),(!i||h==="loading")&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-lg text-slate-600 dark:text-slate-400",children:i?"Loading results...":"Processing solar forge..."}),E&&e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-500 mt-2",children:["Version: ",E]})]})]})})})]})};export{Re as default};
