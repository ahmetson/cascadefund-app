import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.DxhH1ShK.js";import{A as G}from"./AuthStar.nxAGzTTY.js";import{B as L}from"./Button.BK-c6KtM.js";import{a as P}from"./auth.C6MmFFld.js";import{a as Y,u as V}from"./star.J0JRTi5O.js";import{b as _}from"./index.kRI0wtIn.js";import{c as u}from"./utils.BnlJtBIq.js";import{g as B}from"./icon.Df9DBUhx.js";import{I as C}from"./Input.BhPYPo8a.js";import{L as I}from"./Label.C_pE6Uy6.js";import{P as q}from"./PageLikePanel.Dipvl2FS.js";import{C as J}from"./Link.BGo-y1Vn.js";import{N as K}from"./NumberFlow-client-48rw3j0J.DO-Ted3l.js";import{c as z}from"./confetti.module.Cx83yTHA.js";import{P as O,a as Q,b as X,c as Z,d as $,e as ee}from"./PopoverArrow.BaWnEbH-.js";import"./Tooltip.CRI7KqtE.js";import"./index.C2SuE_cr.js";import"./index.CqUFkXl9.js";import"./slot.RkfkL2mj.js";import"./proxy.D4YeN7SK.js";import"./index.CG_O7YBG.js";import"./ripple.8VKTSqqU.js";import"./ElectricBorder.DAWLx7iV.js";import"./virtual.VUcB3V37.js";import"./client.B9YBqyHK.js";import"./Panel.BFyw-rTz.js";import"./accordion.Dr61eiHV.js";import"./accordion.CpVAuD1l.js";import"./useControlledState.CmDsCfE3.js";import"./index.DpQ8kv17.js";import"./index.Du2_2VfY.js";import"./createLucideIcon.C1tpinp8.js";import"./PanelAction.a_cGOObt.js";const M=({isOpen:l,sunshines:r,onClose:N})=>{const[p,k]=s.useState(!1),[o,f]=s.useState(!1),[i,x]=s.useState(!1),[a,c]=s.useState(!1),[T,g]=s.useState(!1);return s.useEffect(()=>{if(l&&!p){let b=function(n,d){return Math.random()*(d-n)+n};k(!0);const w=3e3,h=Date.now()+w,v={startVelocity:30,spread:360,ticks:60,zIndex:9999},y=setInterval(function(){const n=h-Date.now();if(n<=0){clearInterval(y);return}const d=50*(n/w);z({...v,particleCount:d,origin:{x:b(.1,.3),y:Math.random()-.2}}),z({...v,particleCount:d,origin:{x:b(.7,.9),y:Math.random()-.2}})},250)}},[l,p]),s.useEffect(()=>{l&&(f(!1),x(!1),c(!1),g(!1),setTimeout(()=>f(!0),300),setTimeout(()=>x(!0),800),setTimeout(()=>c(!0),1500),setTimeout(()=>g(!0),2200))},[l]),l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 left-0 w-full h-full bg-black/50 backdrop-blur-sm z-[100]",onClick:N}),e.jsx("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[101] flex items-center justify-center w-full max-w-2xl px-4",children:e.jsx(q,{title:"Welcome to Ara!",titleCenter:!0,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:u("flex items-center justify-center gap-2 transition-all duration-500",o?"opacity-100 translate-y-0":"opacity-0 -translate-y-4"),children:[B({iconType:"sunshine",className:"w-12 h-12 text-yellow-500 dark:text-yellow-400"}),e.jsx("div",{className:"text-4xl font-bold text-slate-800 dark:text-slate-200",children:e.jsx(K,{value:r,locales:"en-US",format:{style:"decimal",maximumFractionDigits:0}})})]}),i&&e.jsx("div",{className:u("text-slate-600 dark:text-slate-400 text-center transition-all duration-500",i?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:e.jsxs("p",{className:"text-lg",children:["You've received ",e.jsxs("span",{className:"font-semibold text-yellow-600 dark:text-yellow-400",children:[r," sunshines"]})," to begin creating your community"]})}),a&&e.jsx("div",{className:u("text-center transition-all duration-700",a?"opacity-100 scale-100":"opacity-0 scale-95"),children:e.jsx("p",{className:"text-xl font-semibold text-slate-800 dark:text-slate-200",children:"Begin creating your community"})}),T&&e.jsx("div",{className:u("flex justify-center items-center transition-all duration-500",T?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:e.jsx(J,{uri:"/all-stars",children:e.jsx(L,{variant:"primary",size:"md",className:"min-w-[200px]",children:"Browse All-Stars"})})})]})})})]}):null},E=100,Le=({className:l})=>{const{data:r,isPending:N}=P.useSession(),[p,k]=s.useState(!1),[o,f]=s.useState(!1),[i,x]=s.useState(!1),[a,c]=s.useState(null),[T,g]=s.useState(!1),[b,w]=s.useState(!1),[h,v]=s.useState(""),[y,n]=s.useState(""),[d,A]=s.useState(""),[F,U]=s.useState("");s.useEffect(()=>{const t=async()=>{const m=r?.user;if(m?.id){g(!0);try{const S=await Y(m.id);S!==null&&c(S)}catch(S){console.error("Error fetching or updating star:",S),c(null)}finally{g(!1)}}else c(null)};!N&&r?.user?t():r?.user||c(null)},[r,N,b]),s.useEffect(()=>{const t=async()=>{g(!0);let S={success:!1};try{S=await V(a._id,E)}catch(D){console.error("Error fetching or updating star:",D)}finally{if(S.success){const D={...a,sunshines:E};c(D),w(!0)}g(!1)}},m=a?.sunshines!==void 0&&a.sunshines>0;a!==null&&m===!1&&t()},[a,r]);const R=async()=>{try{k(!0);const t=await P.signIn.social({provider:"github"});t.error&&(console.error("Sign-in error:",t.error),alert("Failed to sign in. Please try again."))}catch(t){console.error("Sign-in error:",t),alert("An error occurred during sign-in. Please try again.")}finally{k(!1)}},W=async()=>{if(!h||!y){alert("Please enter both email and password");return}try{f(!0);const t=await P.signIn.email({email:h,password:y});t.error?(console.error("Email sign-in error:",t.error),alert(t.error.message||"Failed to sign in. Please check your credentials.")):(v(""),n(""),A(""),U(""),x(!1))}catch(t){console.error("Email sign-in error:",t),alert("An error occurred during sign-in. Please try again.")}finally{f(!1)}},H=async()=>{if(!h||!y){alert("Please enter both email and password");return}try{f(!0);const t={email:h,password:y};F.trim()&&(t.name=F.trim()),d.trim()&&(t.username=d.trim());const m=await P.signUp.email(t);m.error?(console.error("Email sign-up error:",m.error),alert(m.error.message||"Failed to sign up. Please try again.")):(v(""),n(""),A(""),U(""),x(!1))}catch(t){console.error("Email sign-up error:",t),alert("An error occurred during sign-up. Please try again.")}finally{f(!1)}};if(N)return e.jsx("div",{className:u("flex items-center gap-2",l),children:e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-200 dark:bg-slate-700 animate-pulse"})});const j=r?.user;return j?e.jsxs(e.Fragment,{children:[e.jsx(G,{star:a||void 0,src:j.image,email:j.email,nickname:j.name||j.username||j.email?.split("@")[0]||"User",className:"w-8 h-8"}),e.jsx(M,{isOpen:b,sunshines:E,onClose:()=>w(!1)})]}):e.jsxs(e.Fragment,{children:[e.jsxs(O,{children:[e.jsx(Q,{className:u("hyperlink flex items-center justify-center shadow-none","px-3 py-1.5 text-sm font-medium rounded-md","bg-indigo-600 hover:bg-indigo-700 text-white","disabled:opacity-50 disabled:cursor-not-allowed","transition-colors",l),disabled:p,children:p?"Signing in...":"Login"}),e.jsx(X,{children:e.jsx(Z,{sideOffset:8,side:"bottom",align:"end",className:"z-700!",children:e.jsxs($,{className:"w-64 origin-[var(--transform-origin)] rounded-xs bg-[canvas] px-6 py-4 text-gray-900 shadow-sm shadow-gray-900 transition-[transform,scale,opacity] data-[ending-style]:scale-90 data-[ending-style]:opacity-0 data-[starting-style]:scale-90 data-[starting-style]:opacity-0",children:[e.jsx(ee,{className:"data-[side=bottom]:top-[-8px] data-[side=left]:right-[-13px] data-[side=left]:rotate-90 data-[side=right]:left-[-13px] data-[side=right]:-rotate-90 data-[side=top]:bottom-[-8px] data-[side=top]:rotate-180",children:B("arrow")}),!j&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 border-b border-slate-200 dark:border-slate-700 pb-2",children:[e.jsx("button",{type:"button",onClick:()=>x(!1),className:u("flex-1 py-1 text-sm font-medium transition-colors",i?"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-300":"text-slate-900 dark:text-slate-100 border-b-2 border-slate-900 dark:border-slate-100"),children:"Sign In"}),e.jsx("button",{type:"button",onClick:()=>x(!0),className:u("flex-1 py-1 text-sm font-medium transition-colors",i?"text-slate-900 dark:text-slate-100 border-b-2 border-slate-900 dark:border-slate-100":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-300"),children:"Sign Up"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Email"}),e.jsx(C,{id:"email",type:"email",value:h,onChange:t=>v(t.target.value),placeholder:"your@email.com",disabled:o,className:"w-full mt-1"})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Password"}),e.jsx(C,{id:"password",type:"password",value:y,onChange:t=>n(t.target.value),placeholder:"••••••••",disabled:o,className:"w-full mt-1"})]}),i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(I,{children:"Nickname (optional)"}),e.jsx(C,{id:"nickname",type:"text",value:d,onChange:t=>A(t.target.value),placeholder:"username",disabled:o,className:"w-full mt-1"})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Display Name (optional)"}),e.jsx(C,{id:"displayName",type:"text",value:F,onChange:t=>U(t.target.value),placeholder:"Your Name",disabled:o,className:"w-full mt-1"})]})]}),e.jsx(L,{variant:"primary",size:"sm",disabled:o,onClick:()=>{i?H():W()},className:"w-full",children:o?i?"Signing up...":"Signing in...":i?"Sign Up":"Sign In"})]}),e.jsxs("div",{className:"flex items-center gap-2 py-2",children:[e.jsx("hr",{className:"flex-1 border-slate-200 dark:border-slate-700"}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"OR"}),e.jsx("hr",{className:"flex-1 border-slate-200 dark:border-slate-700"})]}),e.jsxs(L,{variant:"secondary",size:"sm",onClick:R,disabled:p,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),p?"Signing in...":"Login with GitHub"]})]})]})})})]}),e.jsx(M,{isOpen:b,sunshines:E,onClose:()=>w(!1)})]})};export{Le as default};
