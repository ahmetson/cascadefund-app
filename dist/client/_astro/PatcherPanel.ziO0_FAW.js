import{j as s}from"./jsx-runtime.D_zvdyIk.js";import{r as n}from"./index.DxhH1ShK.js";import{c as P,t as q}from"./utils.BnlJtBIq.js";import{m as $}from"./proxy.D4YeN7SK.js";import{g as W}from"./icon.Df9DBUhx.js";import{a as V,P as D}from"./patch.CbMO86LR.js";import{C as B}from"./Tooltip.CRI7KqtE.js";import{D as Y,H as K}from"./index.CeIpCxKj.js";import{N as U}from"./NumberFlow-client-48rw3j0J.DO-Ted3l.js";import{C as X}from"./DropTarget.Dj7XGDX6.js";import{a as J}from"./auth.C6MmFFld.js";import{a as Q,g as Z,d as O}from"./issue.Cu6yhr5C.js";import{r as G}from"./roadmap.Cq_m8jGZ.js";import{u as ee}from"./useDrag.C9I1mCaR.js";import"./index.C2SuE_cr.js";import"./index.CqUFkXl9.js";import"./slot.RkfkL2mj.js";import"./index.CG_O7YBG.js";import"./ElectricBorder.DAWLx7iV.js";import"./Button.BK-c6KtM.js";import"./ripple.8VKTSqqU.js";import"./virtual.VUcB3V37.js";import"./client.B9YBqyHK.js";import"./issue.CJErfNqu.js";import"./star.J0JRTi5O.js";import"./roadmap.DwIP75iC.js";function te({strokeColor:f="#737373",numberOfLines:x=50,numberOfDiscs:b=50,particleRGBColor:w=[255,255,255],className:z,children:I,...h}){const _=n.useRef(null),v=n.useRef(0),e=n.useRef({discs:[],lines:[],particles:[],clip:{},startDisc:{},endDisc:{},rect:{width:0,height:0},render:{width:0,height:0,dpi:1},particleArea:{},linesCanvas:null}),d=t=>t,u=t=>t===0?0:Math.pow(2,10*(t-1)),m=n.useCallback((t,r,i,c=null)=>{const a=r-t;return t+a*(c==="inExpo"?u:d)(i)},[]),E=n.useCallback(t=>{const{startDisc:r,endDisc:i}=e.current;t.x=m(r.x,i.x,t.p),t.y=m(r.y,i.y,t.p,"inExpo"),t.w=m(r.w,i.w,t.p),t.h=m(r.h,i.h,t.p)},[m]),k=n.useCallback(()=>{const t=_.current;if(!t)return;const r=t.getBoundingClientRect();e.current.rect={width:r.width,height:r.height},e.current.render={width:r.width,height:r.height,dpi:window.devicePixelRatio||1},t.width=e.current.render.width*e.current.render.dpi,t.height=e.current.render.height*e.current.render.dpi},[]),C=n.useCallback(()=>{const{width:t,height:r}=e.current.rect;if(t<=0||r<=0){e.current.discs=[];return}e.current.discs=[],e.current.startDisc={x:t*.5,y:r*.95,w:0,h:0},e.current.endDisc={x:t*.5,y:r*.45,w:t*.75,h:r*.7};let i=r;e.current.clip={};for(let o=0;o<b;o++){const l={p:o/b,x:0,y:0,w:0,h:0};E(l);const g=l.y+l.h;g<=i&&(e.current.clip={disc:{...l},i:o}),i=g,e.current.discs.push(l)}const c=new Path2D,a=e.current.clip.disc;c.ellipse(a.x,a.y,a.w,a.h,0,0,Math.PI*2),c.rect(a.x-a.w,0,a.w*2,a.y),e.current.clip.path=c},[b,E]),y=n.useCallback(()=>{const{width:t,height:r}=e.current.rect;if(t<=0||r<=0){e.current.linesCanvas=null;return}e.current.lines=[];const i=Math.PI*2/x;for(let o=0;o<x;o++)e.current.lines.push([]);e.current.discs.forEach(o=>{for(let p=0;p<x;p++){const l=p*i,g={x:o.x+Math.cos(l)*o.w,y:o.y+Math.sin(l)*o.h};e.current.lines[p].push(g)}});const c=document.createElement("canvas");c.width=t,c.height=r;const a=c.getContext("2d");a&&(e.current.lines.forEach(o=>{a.save();let p=!1;o.forEach((l,g)=>{if(g===0)return;const F=o[g-1];!p&&(a.isPointInPath(e.current.clip.path,l.x,l.y)||a.isPointInStroke(e.current.clip.path,l.x,l.y))?p=!0:p&&a.clip(e.current.clip.path),a.beginPath(),a.moveTo(F.x,F.y),a.lineTo(l.x,l.y),a.strokeStyle=f,a.lineWidth=2,a.stroke(),a.closePath()}),a.restore()}),e.current.linesCanvas=c)},[x,f]),N=n.useCallback((t=!1)=>{const r=e.current.particleArea.sx+e.current.particleArea.sw*Math.random(),c=e.current.particleArea.ex+e.current.particleArea.ew*Math.random()-r,a=t?e.current.particleArea.h*Math.random():0,o=.5+Math.random()*4,p=.5+Math.random();return{x:r,sx:r,dx:c,y:a,vy:p,p:0,r:o,c:`rgba(${w[0]}, ${w[1]}, ${w[2]}, ${Math.random()})`}},[w]),j=n.useCallback(()=>{const{width:t,height:r}=e.current.rect;if(t<=0||r<=0){e.current.particles=[];return}e.current.particles=[];const i=e.current.clip.disc;e.current.particleArea={sw:i.w*.5,ew:i.w*2,h:r*.85},e.current.particleArea.sx=(t-e.current.particleArea.sw)/2,e.current.particleArea.ex=(t-e.current.particleArea.ew)/2;const c=100;for(let a=0;a<c;a++)e.current.particles.push(N(!0))},[N]),M=n.useCallback(t=>{t.strokeStyle=f,t.lineWidth=2;const r=e.current.endDisc;t.beginPath(),t.ellipse(r.x,r.y,r.w,r.h,0,0,Math.PI*2),t.stroke(),t.closePath(),e.current.discs.forEach((i,c)=>{c%5===0&&(i.w<e.current.clip.disc.w-5&&(t.save(),t.clip(e.current.clip.path)),t.beginPath(),t.ellipse(i.x,i.y,i.w,i.h,0,0,Math.PI*2),t.stroke(),t.closePath(),i.w<e.current.clip.disc.w-5&&t.restore())})},[f]),H=n.useCallback(t=>{const r=e.current.linesCanvas;r&&r.width>0&&r.height>0&&t.drawImage(r,0,0)},[]),R=n.useCallback(t=>{t.save(),t.clip(e.current.clip.path),e.current.particles.forEach(r=>{t.fillStyle=r.c,t.beginPath(),t.rect(r.x,r.y,r.r,r.r),t.closePath(),t.fill()}),t.restore()},[]),T=n.useCallback(()=>{e.current.discs.forEach(t=>{t.p=(t.p-.001+1)%1,E(t)})},[E]),L=n.useCallback(()=>{e.current.particles.forEach((t,r)=>{t.p=1-t.y/e.current.particleArea.h,t.x=t.sx+t.dx*t.p,t.y+=t.vy,t.y>e.current.particleArea.h&&(e.current.particles[r]=N())})},[N]),A=n.useCallback(()=>{const t=_.current;if(!t)return;const r=t.getContext("2d");if(r){if(t.width<=0||t.height<=0){v.current=requestAnimationFrame(A);return}r.clearRect(0,0,t.width,t.height),r.save(),r.scale(e.current.render.dpi,e.current.render.dpi),T(),L(),M(r),H(r),R(r),r.restore(),v.current=requestAnimationFrame(A)}},[T,L,M,H,R]),S=n.useCallback(()=>{k(),C(),y(),j()},[k,C,y,j]);return n.useEffect(()=>{if(!_.current)return;S(),A();const r=()=>{k(),C(),y(),j()};return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r),cancelAnimationFrame(v.current)}},[S,A,k,C,y,j]),s.jsxs("div",{"data-slot":"reversed-hole-background",className:P("relative size-full overflow-hidden",'before:content-[""] before:absolute before:top-1/2 before:left-1/2 before:block before:size-[140%] dark:before:[background:radial-gradient(ellipse_at_50%_45%,transparent_10%,black_50%)] before:[background:radial-gradient(ellipse_at_50%_45%,transparent_10%,white_50%)] before:[transform:translate3d(-50%,-50%,0)]','after:content-[""] after:absolute after:z-[5] after:top-1/2 after:left-1/2 after:block after:size-full after:[background:radial-gradient(ellipse_at_50%_25%,#a900ff_20%,transparent_75%)] after:[transform:translate3d(-50%,-50%,0)] after:mix-blend-overlay',z),...h,children:[s.jsx("div",{"aria-hidden":!0,className:P("absolute inset-0 z-0 pointer-events-none","[background-size:20px_20px]","[background-image:linear-gradient(to_right,#e4e4e7_1px,transparent_1px),linear-gradient(to_bottom,#e4e4e7_1px,transparent_1px)]","dark:[background-image:linear-gradient(to_right,#262626_1px,transparent_1px),linear-gradient(to_bottom,#262626_1px,transparent_1px)]","opacity-50 dark:opacity-40","[mask-image:radial-gradient(ellipse_at_center,transparent_10%,black_80%)]")}),s.jsx("div",{"aria-hidden":!0,className:P("absolute inset-0 z-[1] pointer-events-none","[background-size:20px_20px]","[background-image:linear-gradient(to_right,#e4e4e7_1px,transparent_1px),linear-gradient(to_bottom,#e4e4e7_1px,transparent_1px)]","dark:[background-image:linear-gradient(to_right,#262626_1px,transparent_1px),linear-gradient(to_bottom,#262626_1px,transparent_1px)]","opacity-65 dark:opacity-55","mix-blend-multiply dark:mix-blend-screen"),style:{transform:"perspective(900px) rotateX(-72deg) scale(1.05)",transformOrigin:"50% 60%",maskImage:"radial-gradient(ellipse at 50% 45%, black 35%, transparent 75%)",WebkitMaskImage:"radial-gradient(ellipse at 50% 45%, black 35%, transparent 75%)",filter:"blur(0.6px)"}}),I,s.jsx("canvas",{ref:_,className:"absolute inset-0 block size-full dark:opacity-20 opacity-10"}),s.jsx($.div,{className:P("absolute top-[-71.5%] left-1/2 z-[3] w-[30%] h-[140%] rounded-b-full blur-3xl opacity-75 dark:mix-blend-plus-lighter mix-blend-plus-darker [transform:translate3d(-50%,0,0)] [background-position:0%_100%] [background-size:100%_200%]","dark:[background:linear-gradient(20deg,#00f8f1,#ffbd1e20_16.5%,#fe848f_33%,#fe848f20_49.5%,#00f8f1_66%,#00f8f160_85.5%,#ffbd1e_100%)_0_100%_/_100%_200%] [background:linear-gradient(20deg,#00f8f1,#ffbd1e40_16.5%,#fe848f_33%,#fe848f40_49.5%,#00f8f1_66%,#00f8f180_85.5%,#ffbd1e_100%)_0_100%_/_100%_200%]"),animate:{backgroundPosition:"0% 300%"},transition:{duration:5,ease:"linear",repeat:1/0}}),s.jsx("div",{className:"absolute top-0 left-0 z-[7] size-full dark:[background:repeating-linear-gradient(transparent,transparent_1px,white_1px,white_2px)] mix-blend-overlay opacity-50"})]})}const Ne=({galaxyId:f})=>{const{data:x}=J.useSession(),[b,w]=n.useState([]),[z,I]=n.useState(!0),h=n.useCallback(async()=>{if(f)try{I(!0);const d=(await Q(f)).filter(u=>u.listHistory?.includes(V));w(d)}catch(e){console.error("Error fetching patched issues:",e)}finally{I(!1)}},[f]);n.useEffect(()=>{h()},[h]),n.useEffect(()=>{const e=()=>{h()},d=u=>{h()};return window.addEventListener(D.PATCH_CREATED,e),window.addEventListener(D.PATCH_REMOVED,d),()=>{window.removeEventListener(D.PATCH_CREATED,e),window.removeEventListener(D.PATCH_REMOVED,d)}},[h]);const _=n.useCallback(async e=>{const d=x?.user?.email;if(!d){console.error("No email found in session");return}try{const u=await Z(e.id);if(!u){console.error("Issue not found");return}const k=[...(u.listHistory||[]).filter(y=>!y.startsWith("version-")),V];if(!await O({issueId:e.id,email:d,listHistory:k})){console.error("Failed to update issue");return}await G({patchId:e.id,versionId:e.versionId}),h()}catch(u){console.error("Error handling patch drop:",u)}},[h,x]),v=n.memo(({issue:e})=>{const[{opacity:d},u]=ee(()=>({type:"issue",item:{id:e._id,title:e.title,sunshines:e.sunshines},collect:m=>({opacity:m.isDragging()?.4:1})}),[e._id,e.title,e.sunshines]);return s.jsxs("div",{ref:u,"data-testid":e._id,style:{opacity:d},className:P("cursor-move border-1 border-amber-300/80 hover:border-amber-400","dark:border-amber-400/70 dark:hover:border-amber-300/90","bg-amber-50/50 dark:bg-amber-900/20","transition-colors p-2 border-dashed rounded-md","flex items-center justify-between gap-2"),children:[s.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300 flex-1 truncate",children:q(e.title)}),s.jsxs("div",{className:"flex items-center gap-1 text-amber-600 dark:text-amber-400",children:[W({iconType:"sunshine",className:"w-4 h-4",fill:"currentColor"}),s.jsx("span",{className:"text-xs font-semibold",children:s.jsx(U,{value:e.sunshines||0,locales:"en-US",format:{useGrouping:!1}})})]})]})});return v.displayName="MinimalDraggableIssue",s.jsx(Y,{backend:K,children:s.jsx($.div,{className:P("fixed right-4 top-1/2 -translate-y-1/2 z-20 w-80","pointer-events-auto","visible"),children:s.jsx("div",{className:"relative h-full min-h-[400px]",children:s.jsxs(te,{className:"w-full h-[400px]",children:[s.jsxs("div",{className:"absolute top-16 left-1/2 -translate-x-1/2 z-30 flex flex-col items-center gap-2",children:[s.jsx("h2",{className:"w-[300px] text-center text-2xl font-semibold text-slate-700 dark:text-slate-200 shadow-2xl",children:"Patcher"}),s.jsx(B,{content:"Issues with 'patcher' in listHistory can be dragged to roadmap patches.",children:W({iconType:"info",className:"w-6 h-6 text-slate-600 dark:text-slate-300",fill:"none"})})]}),s.jsx("div",{className:"absolute top-30 left-1/2 -translate-x-1/2 z-30 flex items-center justify-center w-36 h-48 rounded-full shadow-lg overflow-hidden",children:s.jsx(X,{id:"patcher-patch-drop",accept:["patch"],onDrop:_,className:"w-full h-full",roundedClassName:"rounded-full",innerClassName:"rounded-full"})}),s.jsxs("div",{className:"absolute bottom-0 left-0 right-0 z-30 p-4 space-y-2 max-h-[200px] overflow-x-hidden overflow-y-auto",children:[s.jsx("div",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Patchable Issues"}),z?s.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 text-center py-4",children:"Loading..."}):b.length===0?s.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 text-center py-4",children:"No patchable issues found."}):b.map(e=>s.jsx(v,{issue:e},e._id))]})]})})})})};export{Ne as default};
