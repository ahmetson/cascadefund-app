import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as a}from"./index.DxhH1ShK.js";import{C as Q}from"./ControlPanel.Ck-8xG2n.js";import{g as X}from"./icon.Df9DBUhx.js";import{C as Z}from"./Tooltip.CRI7KqtE.js";import{B as h}from"./Button.BK-c6KtM.js";import{S as $,a as m}from"./ScrollStack.BC0PwliQ.js";import{B as z}from"./Badge.CwoN8wRJ.js";import{a as M}from"./auth.C6MmFFld.js";import{a as P}from"./virtual.VUcB3V37.js";import{B as ee}from"./blog.BdlOHMLX.js";import{a as _}from"./star.J0JRTi5O.js";import{c as te}from"./utils.BnlJtBIq.js";import"./Panel.BFyw-rTz.js";import"./ripple.8VKTSqqU.js";import"./slot.RkfkL2mj.js";import"./proxy.D4YeN7SK.js";import"./index.C2SuE_cr.js";import"./index.CqUFkXl9.js";import"./index.CG_O7YBG.js";import"./ElectricBorder.DAWLx7iV.js";import"./client.B9YBqyHK.js";function R(o){const s=new CustomEvent(ee.BLOG_CREATED,{detail:o});window.dispatchEvent(s)}async function re(o){try{const s=await P.getBlog({blogId:o});return s.data?.success&&s.data.blog?s.data.blog:null}catch(s){return console.error("Error getting blog:",s),null}}async function se(o){try{const s=await P.getBlogsByAuthor({authorId:o});return s.data?.success&&s.data.blogs?s.data.blogs:[]}catch(s){return console.error("Error getting blogs by author:",s),[]}}async function ae(o){try{const s=await P.createBlog(o);if(s.data?.success){if(s.data.blogId){const d=await re(s.data.blogId);if(d)return R(d),d}const u=await se(o.starId),l=u.find(d=>d.title===o.title&&d.author===o.starId)||u[0];if(l)return R(l),l}return null}catch(s){return console.error("Error creating blog:",s),null}}const oe=["open-source","web3","blockchain","frontend","backend","fullstack","mobile","desktop","library","framework","tool","other"],ne=({authorId:o,onSuccess:s,onCancel:u})=>{const[l,d]=a.useState(""),[g,N]=a.useState(""),[b,x]=a.useState(""),[i,k]=a.useState([]),[C,p]=a.useState(""),[n,w]=a.useState([]),[y,D]=a.useState(""),[S,U]=a.useState([]),[E,F]=a.useState(!1),[T,j]=a.useState(!1),[L,H]=a.useState(0),v=a.useRef(null),c=a.useRef([]),K=a.useRef(null),{data:q,isPending:G}=M.useSession(),A=()=>{const e=C.trim();e&&!i.includes(e)&&(k([...i,e]),p(""))},Y=e=>{k(i.filter(r=>r!==e))},O=()=>{const e=y.trim();e&&!n.includes(e)&&(w([...n,e]),D(""))},W=e=>{w(n.filter(r=>r!==e))},J=e=>{U(r=>r.includes(e)?r.filter(f=>f!==e):[...r,e])},B=a.useCallback(()=>{if(c.current.length===0||!v.current)return;const e=Math.min(L+1,c.current.length-1),r=c.current[e];if(r&&v.current){const f=v.current.querySelector(".scroll-stack-inner");if(f){const I=r.offsetTop-f.offsetTop;f.scrollTo({top:I-100,behavior:"smooth"}),H(e)}}},[L]);a.useEffect(()=>{const e=r=>{r.target instanceof HTMLTextAreaElement&&r.key==="Enter"&&r.shiftKey||(r.key==="Enter"||r.key==="Tab")&&(r.key==="Tab"&&!(r.target instanceof HTMLInputElement||r.target instanceof HTMLTextAreaElement)&&r.preventDefault(),r.key==="Enter"&&(r.target instanceof HTMLInputElement||r.target instanceof HTMLTextAreaElement)&&(r.preventDefault(),B()))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[B]);const V=async()=>{if(!l.trim()||!b.trim()||i.length===0){alert("Please fill in all required fields (title, content, and at least one tag)");return}if(G){alert("Please wait while we verify your authentication");return}const e=q?.user;if(!e?.id||!e?.email){alert("Please log in to create a blog post");return}j(!0);try{const r=await _(e.id);if(!r||!r._id){alert("User profile not found. Please ensure your account is set up correctly."),j(!1);return}const f=String(r._id),I=String(o);if(f!==I){alert("You can only create blog posts for your own account"),j(!1);return}await ae({starId:f,title:l.trim(),content:b.trim(),description:g.trim()||void 0,tags:i,projects:n.length>0?n:void 0,projectTypes:S.length>0?S:void 0,draft:E})?s?.():alert("Failed to create blog post")}catch(r){console.error("Error creating blog:",r),alert("An error occurred while creating the blog post")}finally{j(!1)}};return t.jsxs("div",{className:"fixed inset-0 z-50 pointer-events-none",children:[u&&t.jsx("button",{onClick:u,className:"fixed top-16 right-16 z-50 pointer-events-auto w-10 h-10 rounded-sm bg-white/90 dark:bg-slate-950/95 backdrop-blur-md border border-slate-200/50 dark:border-slate-800/50 shadow-lg flex items-center justify-center text-slate-500 hover:text-slate-700 dark:hover:text-slate-200 transition-all hover:scale-110",children:"✕"}),t.jsx("div",{ref:v,className:"absolute bottom-0 left-0 right-0 h-[80vh] pointer-events-auto",children:t.jsxs($,{useWindowScroll:!1,className:"h-full",children:[t.jsx(m,{itemClassName:"bg-white/5 dark:bg-slate-900/10 backdrop-blur-md border border-white/10 dark:border-slate-700/20 transition-all duration-300",children:t.jsxs("div",{ref:e=>{c.current[0]=e},className:"space-y-4",children:[t.jsx("label",{className:"block text-lg font-semibold text-slate-700 dark:text-slate-300",children:"Blog Title *"}),t.jsx("input",{ref:K,type:"text",value:l,onChange:e=>d(e.target.value),onKeyDown:e=>{e.key==="Enter"&&(e.preventDefault(),B())},placeholder:"Enter a clear, descriptive title...",className:"w-full text-lg px-3 py-2 border border-gray-300/50 dark:border-slate-700/50 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/30 dark:bg-slate-900/40 backdrop-blur-md"})]})}),t.jsx(m,{itemClassName:"bg-white/5 dark:bg-slate-900/10 backdrop-blur-md border border-white/10 dark:border-slate-700/20 transition-all duration-300",children:t.jsxs("div",{ref:e=>{c.current[1]=e},className:"space-y-4",children:[t.jsx("label",{className:"block text-lg font-semibold text-slate-700 dark:text-slate-300",children:"Description (Optional)"}),t.jsx("textarea",{value:g,onChange:e=>N(e.target.value),placeholder:"A brief description of your blog post...",rows:3,className:"w-full px-3 py-2 border border-gray-300/50 dark:border-slate-700/50 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/30 dark:bg-slate-900/40 backdrop-blur-md resize-none"})]})}),t.jsx(m,{itemClassName:"bg-white/5 dark:bg-slate-900/10 backdrop-blur-md border border-white/10 dark:border-slate-700/20 transition-all duration-300",children:t.jsxs("div",{ref:e=>{c.current[2]=e},className:"space-y-4",children:[t.jsx("label",{className:"block text-lg font-semibold text-slate-700 dark:text-slate-300",children:"Content * (Markdown supported)"}),t.jsx("textarea",{value:b,onChange:e=>x(e.target.value),placeholder:"Write your blog post content in Markdown...",rows:10,className:"w-full px-3 py-2 border border-gray-300/50 dark:border-slate-700/50 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/30 dark:bg-slate-900/40 backdrop-blur-md resize-none font-mono text-sm"})]})}),t.jsx(m,{itemClassName:"bg-white/5 dark:bg-slate-900/10 backdrop-blur-md border border-white/10 dark:border-slate-700/20 transition-all duration-300",children:t.jsxs("div",{ref:e=>{c.current[3]=e},className:"space-y-4",children:[t.jsx("label",{className:"block text-lg font-semibold text-slate-700 dark:text-slate-300",children:"Tags * (At least one required)"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:C,onChange:e=>p(e.target.value),onKeyDown:e=>{e.key==="Enter"&&(e.preventDefault(),A())},placeholder:"Enter a tag and press Enter...",className:"flex-1 px-3 py-2 border border-gray-300/50 dark:border-slate-700/50 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white/30 dark:bg-slate-900/40 backdrop-blur-md"}),t.jsx(h,{onClick:A,variant:"secondary",size:"md",children:"Add"})]}),i.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(e=>t.jsxs(z,{variant:"info",className:"cursor-pointer",onClick:()=>Y(e),children:[e," ×"]},e))})]})}),t.jsx(m,{itemClassName:"bg-white/5 dark:bg-slate-900/10 backdrop-blur-md border border-white/10 dark:border-slate-700/20 transition-all duration-300",children:t.jsxs("div",{ref:e=>{c.current[4]=e},className:"space-y-4",children:[t.jsx("label",{className:"block text-lg font-semibold text-slate-700 dark:text-slate-300",children:"Linked Projects (Optional) - Galaxy IDs"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:y,onChange:e=>D(e.target.value),onKeyDown:e=>{e.key==="Enter"&&(e.preventDefault(),O())},placeholder:"Enter a galaxy/project ID...",className:"flex-1 px-3 py-2 border border-gray-300/50 dark:border-slate-700/50 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white/30 dark:bg-slate-900/40 backdrop-blur-md"}),t.jsx(h,{onClick:O,variant:"secondary",size:"md",children:"Add"})]}),n.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(e=>t.jsxs(z,{variant:"gray",className:"cursor-pointer",onClick:()=>W(e),children:[e," ×"]},e))})]})}),t.jsx(m,{itemClassName:"bg-white/5 dark:bg-slate-900/10 backdrop-blur-md border border-white/10 dark:border-slate-700/20 transition-all duration-300",children:t.jsxs("div",{ref:e=>{c.current[5]=e},className:"space-y-4",children:[t.jsx("label",{className:"block text-lg font-semibold text-slate-700 dark:text-slate-300",children:"Project Types (Optional)"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:oe.map(e=>t.jsx("button",{onClick:()=>J(e),className:te("px-4 py-2 rounded-lg transition-all backdrop-blur-sm",S.includes(e)?"bg-purple-500/90 text-white":"bg-slate-200/80 dark:bg-slate-800/80 text-slate-700 dark:text-slate-200 hover:bg-slate-300/90 dark:hover:bg-slate-700/90"),children:e},e))})]})}),t.jsx(m,{itemClassName:"bg-white/5 dark:bg-slate-900/10 backdrop-blur-md border border-white/10 dark:border-slate-700/20 transition-all duration-300",children:t.jsxs("div",{ref:e=>{c.current[7]=e},className:"space-y-4",children:[t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:E,onChange:e=>F(e.target.checked),className:"w-5 h-5 rounded border-gray-300 dark:border-slate-700 text-blue-600 focus:ring-blue-500"}),t.jsx("span",{className:"text-lg font-semibold text-slate-700 dark:text-slate-300",children:"Save as Draft"})]}),t.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Draft posts are only visible to you"})]})}),t.jsx(m,{itemClassName:"bg-white/5 dark:bg-slate-900/10 backdrop-blur-md border border-white/10 dark:border-slate-700/20 transition-all duration-300",children:t.jsxs("div",{ref:e=>{c.current[7]=e},className:"flex flex-col items-center gap-4",children:[t.jsx(h,{variant:"primary",size:"lg",onClick:V,disabled:T||!l.trim()||!b.trim()||i.length===0,className:"w-full max-w-md backdrop-blur-sm",children:T?"Creating Blog Post...":E?"Save as Draft":"Publish Blog Post"}),u&&t.jsx(h,{variant:"secondary",size:"md",onClick:u,disabled:T,className:"backdrop-blur-sm",children:"Cancel"})]})})]})})]})},Ie=({authorId:o,onBlogCreated:s})=>{const[u,l]=a.useState(!1),[d,g]=a.useState(!1),[N,b]=a.useState(!0),{data:x,isPending:i}=M.useSession();a.useEffect(()=>{(async()=>{if(i){b(!0);return}const p=x?.user;if(!p?.id){g(!1),b(!1);return}try{const n=await _(p.id);if(n&&n._id){const w=String(n._id),y=String(o);g(w===y)}else g(!1)}catch(n){console.error("Error checking ownership:",n),g(!1)}finally{b(!1)}})()},[x,o,i]);const k=()=>{l(!1),setTimeout(()=>{s?.(),window.dispatchEvent(new CustomEvent("blog-created"))},500)};return N||!d?null:t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 z-10",children:t.jsx("div",{className:"relative",children:t.jsx(Q,{className:"p-3 overflow-visible",children:t.jsx("div",{className:"flex items-center gap-3",children:t.jsx(Z,{content:"Create a new blog post to share your thoughts and experiences",children:t.jsxs(h,{onClick:()=>l(!0),variant:"primary",outline:!0,focus:!1,className:"flex items-center gap-2",children:[X({iconType:"new-file",className:"w-4 h-4"}),t.jsx("span",{children:"New Blog Post"})]})})})})})}),u&&t.jsx(ne,{authorId:o,onSuccess:k,onCancel:()=>l(!1)})]})};export{Ie as default};
